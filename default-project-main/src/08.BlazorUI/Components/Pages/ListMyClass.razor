@page "/MyClass"
@using System.Globalization
@using MyApp.BlazorUI.Services
@using MyApp.Shared.DTOs
@using System.Net.Http.Headers
@using Blazored.LocalStorage

@inject NavigationManagerExt Navigation

@inject IAuthService AuthService
@inject IMyClassService MyClassService

<PageTitle>My Class</PageTitle>

<MudContainer>
    @if (_itemList is null)
    {
        <MudProgressCircular Indeterminate="true" Color="Color.Primary" />
    }
    else if (_itemList.Count == 0)
    {
        <MudText Class="mt-10" Typo="Typo.h2" Align="Align.Center">
            Belum ada kelas yang kamu ikuti.
        </MudText>
    }
    else
    {
        <MudDivider></MudDivider>
        @foreach (var item in _itemList)
        {
            <MudGrid Class="my-3">
                <MudItem xs="12" sm="4" md="3" lg="2">
                    <MudImage Src="@item.ImageUrl"
                              Alt="@item.CourseName"
                              Class="rounded-lg w-full"
                              Style="object-fit: cover; max-height: 150px;" />
                </MudItem>

                <MudItem xs="12" sm="8" md="9" lg="10">
                    <MudStack Spacing="1" Class="ml-lg-10 mt-lg-5">
                        <MudText Typo="Typo.h4" Style="font-weight: 400; color: #828282">@item.CategoryName</MudText>
                        <MudText Typo="Typo.h2">@item.CourseName</MudText>
                        <MudText Typo="Typo.h3" Color="Color.Primary" Style="font-size: 20px">
                            Jadwal : @item.Date.ToString("D", new CultureInfo("id-ID"))
                        </MudText>
                    </MudStack>
                </MudItem>
            </MudGrid>
            <MudDivider></MudDivider>
        }
    }
</MudContainer>

@code {
    private List<MyClassDto> _itemList = new();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender)
        {
            return;
        }
        var auth = await AuthService.GetAuthAsync();
        if (auth == null)
        {
            Navigation.GoToLogin(); // User belum login, arahkan user ke login page
            return;
        }
        _itemList = await MyClassService.GetOwnMyClasses(auth); //Dapatkan MyClass
        StateHasChanged();
    }
}
    