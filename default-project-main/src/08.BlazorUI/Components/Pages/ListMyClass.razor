@page "/MyClass"
@using System.Globalization
@using MyApp.BlazorUI.Services
@using MyApp.Shared.DTOs
@using System.Net.Http.Headers
@using Blazored.LocalStorage

@inject NavigationManagerExt Navigation

@inject IAuthService AuthService
@inject IMyClassService MyClassService

<PageTitle>My Class</PageTitle>
@* <Routes @rendermode="new InteractiveServerRenderMode(prerender: false)" /> *@

<MudContainer>
    @if (_itemList is null)
    {
        <MudProgressCircular Indeterminate="true" Color="Color.Primary" />
    }
    else if (_itemList.Count == 0)
    {
        <MudText Class="mt-10" Typo="Typo.h6" Align="Align.Center">
            Belum ada kelas yang kamu ikuti.
        </MudText>
    }
    else
    {
        <MudDivider></MudDivider>
        @foreach (var item in _itemList)
        {
            <MudStack Class="ma-4" Row="true" AlignItems="AlignItems.Center">
                <MudImage Src="@item.ImageUrl" Style="width=200px; height=133px" />
                <MudContainer Class="ml-4">
                    <MudText Style="color: #828282">@item.CategoryName</MudText>
                    <MudText Style="color: #333333"><b>@item.CourseName</b></MudText>
                    <MudText Color="Color.Primary">
                        Jadwal: @item.Date.ToString("d MMMM yyyy", new CultureInfo("id-ID"))
                    </MudText>
                </MudContainer>
            </MudStack>
            <MudDivider></MudDivider>
        }
    }
</MudContainer>

@code {
    private List<MyClassDto> _itemList = new();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender)
        {
            return;
        }
        var auth = await AuthService.GetAccessTokenAsync();
        if (auth == null)
        {
            Navigation.GoToLogin(); // User belum login, arahkan user ke login page
            return;
        }
        _itemList = await MyClassService.GetOwnMyClasses(auth); //Dapatkan MyClass
        StateHasChanged();
    }
}
    