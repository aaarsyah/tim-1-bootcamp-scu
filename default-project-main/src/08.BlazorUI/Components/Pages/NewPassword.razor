@page "/new-password"
@using System.Text.RegularExpressions
@using System.ComponentModel.DataAnnotations

@inject NavigationManagerExt Navigation;

<PageTitle>New Password</PageTitle>

        <MudPaper Class="pa-0 mx-auto mt-12" MaxWidth="800px" Elevation="0">
        <MudForm @ref="form">

        <MudText Typo="Typo.h5" Class="mb-4">Buat Password</MudText>
                              
                    <MudTextField T="string" 
                        Label="Password Baru" 
                        @bind-Value="_registerModel.Password"
                        HelperText="Choose a strong password" 
                        Variant="Variant.Outlined"
                        @ref="pwField1"
                        InputType="InputType.Password"
                        Validation="@(new Func<string, IEnumerable<string>>(PasswordStrength))" 
                        Required="true"
                        RequiredError="Password Haurs Diisi!"/>


                    <MudTextField T="string"
                            Label="Konfirmasi Password Baru" 
                            Variant="Variant.Outlined"
                            @bind-Value="_registerModel.ConfirmPassword"
                            HelperText="Repeat the password" 
                            InputType="InputType.Password"
                            Validation="@(new Func<string, string>(PasswordMatch))"/>


                    <!--Button Batal -->
                    <MudStack Direction="Row" Spacing="5" Row="true" class="mt-4">
                    <MudButton OnClick="Navigation.GoToForgotPass" Variant="Variant.Outlined" Color="Color.Primary" Style="width: 140px; height: 43px; border-radius: 8px">
                            Batal
                    </MudButton>
                

                    <!--Button Konfirmasi -->
                    <MudButton OnClick="OnConfirm" Variant="Variant.Filled" Color="Color.Primary" Style="width: 140px; height: 43px; border-radius: 8px">
                            Kirim
                    </MudButton>
                    </MudStack>

            </MudForm>   
        </MudPaper>


@code {
    MudTextField<string> pwField1;
    MudForm form;

    private RegisterModel _registerModel = new();
    public class RegisterModel
    {
        public string Password { get; set; }
        public string ConfirmPassword { get; set; }
    }

    private IEnumerable<string> PasswordStrength(string pw)
    {
        if (string.IsNullOrWhiteSpace(pw))
        {
            yield return "Password Harus Diisi!";
            yield break;
        }
        if (pw.Length < 8)
            yield return "Password must be at least of length 8";
        if (!Regex.IsMatch(pw, @"[A-Z]"))
            yield return "Password must contain at least one capital letter";
        if (!Regex.IsMatch(pw, @"[a-z]"))
            yield return "Password must contain at least one lowercase letter";
        if (!Regex.IsMatch(pw, @"[0-9]"))
            yield return "Password must contain at least one digit";
    }

    private string PasswordMatch(string arg)
    {
        if (pwField1.Value != arg)
            return "Password tidak sesuai";
        return null;
    }
    private async Task OnConfirm()
    {
        await form.Validate();
        if (form.IsValid)
        {
            Navigation.GoToLogin();
        }
    }
}