’r
[D:\BootcampProject\default-project-main\src\04.Application\Validators\CategoryValidators.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 

Validators !
{ 
public		 

class		 &
CreateCategoryDtoValidator		 +
:		, -
AbstractValidator		. ?
<		? @
CreateCategoryDto		@ Q
>		Q R
{

 
public &
CreateCategoryDtoValidator )
() *
)* +
{ 	
RuleFor 
( 
x 
=> 
x 
. 
Name 
)  
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( C
)C D
. 
Length 
( 
$num 
, 
$num 
) 
.  
WithMessage  +
(+ ,
$str, `
)` a
;a b
RuleFor 
( 
x 
=> 
x 
. 
Description &
)& '
. 
MaximumLength 
( 
$num "
)" #
.# $
WithMessage$ /
(/ 0
$str0 Z
)Z [
;[ \
RuleFor 
( 
x 
=> 
x 
. 
ImageUrl #
)# $
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( D
)D E
;E F
} 	
} 
public   

class   &
UpdateCategoryDtoValidator   +
:  , -
AbstractValidator  . ?
<  ? @
UpdateCategoryDto  @ Q
>  Q R
{!! 
public%% &
UpdateCategoryDtoValidator%% )
(%%) *
)%%* +
{&& 	
RuleFor'' 
('' 
x'' 
=>'' 
x'' 
.'' 
Name'' 
)''  
.(( 
NotEmpty(( 
((( 
)(( 
.(( 
WithMessage(( '
(((' (
$str((( C
)((C D
.)) 
Length)) 
()) 
$num)) 
,)) 
$num)) 
))) 
.))  
WithMessage))  +
())+ ,
$str)), `
)))` a
;))a b
RuleFor++ 
(++ 
x++ 
=>++ 
x++ 
.++ 
Description++ &
)++& '
.,, 
MaximumLength,, 
(,, 
$num,, "
),," #
.,,# $
WithMessage,,$ /
(,,/ 0
$str,,0 Z
),,Z [
;,,[ \
RuleFor.. 
(.. 
x.. 
=>.. 
x.. 
... 
ImageUrl.. #
)..# $
.// 
NotEmpty// 
(// 
)// 
.// 
WithMessage// '
(//' (
$str//( D
)//D E
;//E F
}00 	
}11 
public66 

class66 $
CreateCourseDtoValidator66 )
:66* +
AbstractValidator66, =
<66= >
CreateCourseDto66> M
>66M N
{77 
public;; $
CreateCourseDtoValidator;; '
(;;' (
);;( )
{<< 	
RuleFor== 
(== 
x== 
=>== 
x== 
.== 
Name== 
)==  
.>> 
NotEmpty>> 
(>> 
)>> 
.>> 
WithMessage>> '
(>>' (
$str>>( A
)>>A B
.?? 
Length?? 
(?? 
$num?? 
,?? 
$num?? 
)?? 
.??  
WithMessage??  +
(??+ ,
$str??, ^
)??^ _
;??_ `
RuleForAA 
(AA 
xAA 
=>AA 
xAA 
.AA 
DescriptionAA &
)AA& '
.BB 
NotEmptyBB 
(BB 
)BB 
.BB 
WithMessageBB '
(BB' (
$strBB( A
)BBA B
.CC 
MaximumLengthCC 
(CC 
$numCC #
)CC# $
.CC$ %
WithMessageCC% 0
(CC0 1
$strCC1 \
)CC\ ]
;CC] ^
RuleForEE 
(EE 
xEE 
=>EE 
xEE 
.EE 
PriceEE  
)EE  !
.FF 
GreaterThanFF 
(FF 
$numFF 
)FF 
.FF  
WithMessageFF  +
(FF+ ,
$strFF, N
)FFN O
.GG 
LessThanOrEqualToGG "
(GG" #
$numGG# ,
)GG, -
.GG- .
WithMessageGG. 9
(GG9 :
$strGG: _
)GG_ `
;GG` a
RuleForII 
(II 
xII 
=>II 
xII 
.II 

CategoryIdII %
)II% &
.JJ 
GreaterThanJJ 
(JJ 
$numJJ 
)JJ 
.JJ  
WithMessageJJ  +
(JJ+ ,
$strJJ, H
)JJH I
;JJI J
RuleForLL 
(LL 
xLL 
=>LL 
xLL 
.LL 
ImageUrlLL #
)LL# $
.MM 
NotEmptyMM 
(MM 
)MM 
.MM 
WithMessageMM '
(MM' (
$strMM( B
)MMB C
;MMC D
}NN 	
}OO 
publicTT 

classTT $
UpdateCourseDtoValidatorTT )
:TT* +
AbstractValidatorTT, =
<TT= >
UpdateCourseDtoTT> M
>TTM N
{UU 
publicYY $
UpdateCourseDtoValidatorYY '
(YY' (
)YY( )
{ZZ 	
RuleFor[[ 
([[ 
x[[ 
=>[[ 
x[[ 
.[[ 
Name[[ 
)[[  
.\\ 
NotEmpty\\ 
(\\ 
)\\ 
.\\ 
WithMessage\\ '
(\\' (
$str\\( A
)\\A B
.]] 
Length]] 
(]] 
$num]] 
,]] 
$num]] 
)]] 
.]]  
WithMessage]]  +
(]]+ ,
$str]], ^
)]]^ _
;]]_ `
RuleFor__ 
(__ 
x__ 
=>__ 
x__ 
.__ 
Description__ &
)__& '
.`` 
NotEmpty`` 
(`` 
)`` 
.`` 
WithMessage`` '
(``' (
$str``( A
)``A B
.aa 
MaximumLengthaa 
(aa 
$numaa #
)aa# $
.aa$ %
WithMessageaa% 0
(aa0 1
$straa1 \
)aa\ ]
;aa] ^
RuleForcc 
(cc 
xcc 
=>cc 
xcc 
.cc 
Pricecc  
)cc  !
.dd 
GreaterThandd 
(dd 
$numdd 
)dd 
.dd  
WithMessagedd  +
(dd+ ,
$strdd, N
)ddN O
.ee 
LessThanOrEqualToee "
(ee" #
$numee# ,
)ee, -
.ee- .
WithMessageee. 9
(ee9 :
$stree: _
)ee_ `
;ee` a
RuleForgg 
(gg 
xgg 
=>gg 
xgg 
.gg 

CategoryIdgg %
)gg% &
.hh 
GreaterThanhh 
(hh 
$numhh 
)hh 
.hh  
WithMessagehh  +
(hh+ ,
$strhh, H
)hhH I
;hhI J
RuleForjj 
(jj 
xjj 
=>jj 
xjj 
.jj 
ImageUrljj #
)jj# $
.kk 
NotEmptykk 
(kk 
)kk 
.kk 
WithMessagekk '
(kk' (
$strkk( B
)kkB C
;kkC D
}ll 	
}mm 
publicpp 

classpp %
CreatePaymentDtoValidatorpp *
:pp+ ,
AbstractValidatorpp- >
<pp> ?
CreatePaymentDtopp? O
>ppO P
{qq 
publicuu %
CreatePaymentDtoValidatoruu (
(uu( )
)uu) *
{vv 	
RuleForww 
(ww 
xww 
=>ww 
xww 
.ww 
Nameww 
)ww  
.xx 
NotEmptyxx 
(xx 
)xx 
.xx 
WithMessagexx '
(xx' (
$strxx( B
)xxB C
.yy 
Lengthyy 
(yy 
$numyy 
,yy 
$numyy 
)yy 
.yy  
WithMessageyy  +
(yy+ ,
$stryy, _
)yy_ `
;yy` a
RuleFor{{ 
({{ 
x{{ 
=>{{ 
x{{ 
.{{ 
LogoUrl{{ "
){{" #
.|| 
NotEmpty|| 
(|| 
)|| 
.|| 
WithMessage|| '
(||' (
$str||( B
)||B C
;||C D
}}} 	
}~~ 
public
ÉÉ 

class
ÉÉ '
UpdatePaymentDtoValidator
ÉÉ *
:
ÉÉ+ ,
AbstractValidator
ÉÉ- >
<
ÉÉ> ?
UpdatePaymentDto
ÉÉ? O
>
ÉÉO P
{
ÑÑ 
public
àà '
UpdatePaymentDtoValidator
àà (
(
àà( )
)
àà) *
{
ââ 	
RuleFor
ää 
(
ää 
x
ää 
=>
ää 
x
ää 
.
ää 
Name
ää 
)
ää  
.
ãã 
NotEmpty
ãã 
(
ãã 
)
ãã 
.
ãã 
WithMessage
ãã '
(
ãã' (
$str
ãã( B
)
ããB C
.
åå 
Length
åå 
(
åå 
$num
åå 
,
åå 
$num
åå 
)
åå 
.
åå  
WithMessage
åå  +
(
åå+ ,
$str
åå, _
)
åå_ `
;
åå` a
RuleFor
éé 
(
éé 
x
éé 
=>
éé 
x
éé 
.
éé 
LogoUrl
éé "
)
éé" #
.
èè 
NotEmpty
èè 
(
èè 
)
èè 
.
èè 
WithMessage
èè '
(
èè' (
$str
èè( B
)
èèB C
;
èèC D
}
êê 	
}
ëë 
public
îî 

class
îî '
CreateMyClassDtoValidator
îî *
:
îî+ ,
AbstractValidator
îî- >
<
îî> ?
CreateMyClassDto
îî? O
>
îîO P
{
ïï 
public
ôô '
CreateMyClassDtoValidator
ôô (
(
ôô( )
)
ôô) *
{
öö 	
RuleFor
õõ 
(
õõ 
x
õõ 
=>
õõ 
x
õõ 
.
õõ 
UserId
õõ !
)
õõ! "
.
úú 
NotEmpty
úú 
(
úú 
)
úú 
.
úú 
WithMessage
úú '
(
úú' (
$str
úú( <
)
úú< =
;
úú= >
RuleFor
ûû 
(
ûû 
x
ûû 
=>
ûû 
x
ûû 
.
ûû 

ScheduleId
ûû %
)
ûû% &
.
üü 
NotEmpty
üü 
(
üü 
)
üü 
.
üü 
WithMessage
üü '
(
üü' (
$str
üü( @
)
üü@ A
;
üüA B
}
†† 	
}
°° 
public
¶¶ 

class
¶¶ '
UpdateMyClassDtoValidator
¶¶ *
:
¶¶+ ,
AbstractValidator
¶¶- >
<
¶¶> ?
UpdateMyClassDto
¶¶? O
>
¶¶O P
{
ßß 
public
´´ '
UpdateMyClassDtoValidator
´´ (
(
´´( )
)
´´) *
{
¨¨ 	
RuleFor
≠≠ 
(
≠≠ 
x
≠≠ 
=>
≠≠ 
x
≠≠ 
.
≠≠ 
UserId
≠≠ !
)
≠≠! "
.
ÆÆ 
NotEmpty
ÆÆ 
(
ÆÆ 
)
ÆÆ 
.
ÆÆ 
WithMessage
ÆÆ '
(
ÆÆ' (
$str
ÆÆ( <
)
ÆÆ< =
;
ÆÆ= >
RuleFor
∞∞ 
(
∞∞ 
x
∞∞ 
=>
∞∞ 
x
∞∞ 
.
∞∞ 

ScheduleId
∞∞ %
)
∞∞% &
.
±± 
NotEmpty
±± 
(
±± 
)
±± 
.
±± 
WithMessage
±± '
(
±±' (
$str
±±( @
)
±±@ A
;
±±A B
}
≤≤ 	
}
≥≥ 
public
∂∂ 

class
∂∂ (
CreateScheduleDtoValidator
∂∂ +
:
∂∂, -
AbstractValidator
∂∂. ?
<
∂∂? @
CreateScheduleDto
∂∂@ Q
>
∂∂Q R
{
∑∑ 
public
ªª (
CreateScheduleDtoValidator
ªª )
(
ªª) *
)
ªª* +
{
ºº 	
RuleFor
ΩΩ 
(
ΩΩ 
x
ΩΩ 
=>
ΩΩ 
x
ΩΩ 
.
ΩΩ 
Date
ΩΩ 
)
ΩΩ  
.
ææ 
NotEmpty
ææ 
(
ææ 
)
ææ 
.
ææ 
WithMessage
ææ '
(
ææ' (
$str
ææ( :
)
ææ: ;
;
ææ; <
RuleFor
¿¿ 
(
¿¿ 
x
¿¿ 
=>
¿¿ 
x
¿¿ 
.
¿¿ 
CourseId
¿¿ #
)
¿¿# $
.
¡¡ 
NotEmpty
¡¡ 
(
¡¡ 
)
¡¡ 
.
¡¡ 
WithMessage
¡¡ '
(
¡¡' (
$str
¡¡( >
)
¡¡> ?
;
¡¡? @
}
¬¬ 	
}
√√ 
public
»» 

class
»» (
UpdateScheduleDtoValidator
»» +
:
»», -
AbstractValidator
»». ?
<
»»? @
UpdateScheduleDto
»»@ Q
>
»»Q R
{
…… 
public
ÕÕ (
UpdateScheduleDtoValidator
ÕÕ )
(
ÕÕ) *
)
ÕÕ* +
{
ŒŒ 	
RuleFor
œœ 
(
œœ 
x
œœ 
=>
œœ 
x
œœ 
.
œœ 
Date
œœ 
)
œœ  
.
–– 
NotEmpty
–– 
(
–– 
)
–– 
.
–– 
WithMessage
–– '
(
––' (
$str
––( :
)
––: ;
;
––; <
RuleFor
““ 
(
““ 
x
““ 
=>
““ 
x
““ 
.
““ 
CourseId
““ #
)
““# $
.
”” 
NotEmpty
”” 
(
”” 
)
”” 
.
”” 
WithMessage
”” '
(
””' (
$str
””( >
)
””> ?
;
””? @
}
‘‘ 	
}
’’ 
}◊◊ °ü
\D:\BootcampProject\default-project-main\src\04.Application\Services\UserManagementService.cs
	namespace		 	
MyApp		
 
.		 
WebAPI		 
.		 
Services		 
;		  
public 
class !
UserManagementService "
:# $"
IUserManagementService% ;
{ 
private 
readonly 
AppleMusicDbContext (
_context) 1
;1 2
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
ILogger 
< !
UserManagementService 2
>2 3
_logger4 ;
;; <
public 
!
UserManagementService  
(  !
AppleMusicDbContext 
context #
,# $
IMapper 
mapper 
, 
ILogger 
< !
UserManagementService %
>% &
logger' -
)- .
{ 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
_logger 
= 
logger 
; 
} 
public   

async   
Task   
<   
UserDto   
>   
GetUserProfileAsync   2
(  2 3
int  3 6
userId  7 =
)  = >
{!! 
var"" 
user"" 
="" 
await"" 
_context"" !
.""! "
Users""" '
.## 
FirstOrDefaultAsync##  
(##  !
a##! "
=>### %
a##& '
.##' (
Id##( *
==##+ -
userId##. 4
)##4 5
;##5 6
if$$ 

($$ 
user$$ 
==$$ 
null$$ 
)$$ 
{%% 	
throw&& 
new&& 
NotFoundException&& '
(&&' (
$str&&( 1
,&&1 2
userId&&3 9
)&&9 :
;&&: ;
}'' 	
return(( 
_mapper(( 
.(( 
Map(( 
<(( 
UserDto(( "
>((" #
(((# $
user(($ (
)((( )
;(() *
})) 
public++ 

async++ 
Task++ 
<++ 
IEnumerable++ !
<++! "
UserDto++" )
>++) *
>++* +
GetAllUsersAsync++, <
(++< =
)++= >
{,, 
var44 
users44 
=44 
await44 
_context44 "
.44" #
Users44# (
.55 
Include55 
(55 
c55 
=>55 
c55 
.55 
	UserRoles55 %
)55% &
.66 
ThenInclude66 
(66 
s66 
=>66 !
s66" #
.66# $
Role66$ (
)66( )
.77 
Include77 
(77 
c77 
=>77 
c77 
.77 

UserClaims77 &
)77& '
.88 
ToListAsync88 
(88 
)88 
;88 
return:: 
_mapper:: 
.:: 
Map:: 
<:: 
IEnumerable:: &
<::& '
UserDto::' .
>::. /
>::/ 0
(::0 1
users::1 6
)::6 7
;::7 8
};; 
public<< 

async<< 
Task<< 
<<< 
IEnumerable<< !
<<<! "
RoleDto<<" )
><<) *
><<* +
GetAllRolesAsync<<, <
(<<< =
)<<= >
{== 
var>> 
roles>> 
=>> 
await>> 
_context>> "
.>>" #
Roles>># (
.?? 
ToListAsync?? 
(?? 
)?? 
;?? 
returnAA 
_mapperAA 
.AA 
MapAA 
<AA 
IEnumerableAA &
<AA& '
RoleDtoAA' .
>AA. /
>AA/ 0
(AA0 1
rolesAA1 6
)AA6 7
;AA7 8
}BB 
publicDD 

asyncDD 
TaskDD 
<DD 
boolDD 
>DD 
AddRoleToUserAsyncDD .
(DD. /
intDD/ 2
userIdDD3 9
,DD9 :
stringDD; A
roleNameDDB J
)DDJ K
{EE 
varFF 
userFF 
=FF 
awaitFF 
_contextFF !
.FF! "
UsersFF" '
.GG 
FirstOrDefaultAsyncGG  
(GG  !
aGG! "
=>GG# %
aGG& '
.GG' (
IdGG( *
==GG+ -
userIdGG. 4
)GG4 5
;GG5 6
ifHH 

(HH 
userHH 
==HH 
nullHH 
)HH 
{II 	
throwJJ 
newJJ 
NotFoundExceptionJJ '
(JJ' (
$strJJ( 1
,JJ1 2
userIdJJ3 9
)JJ9 :
;JJ: ;
}KK 	
varMM 
roleMM 
=MM 
awaitMM 
_contextMM !
.MM! "
RolesMM" '
.NN 
FirstOrDefaultAsyncNN  
(NN  !
aNN! "
=>NN# %
aNN& '
.NN' (
NameNN( ,
==NN- /
roleNameNN0 8
)NN8 9
;NN9 :
ifOO 

(OO 
roleOO 
==OO 
nullOO 
)OO 
{PP 	
_loggerQQ 
.QQ 

LogWarningQQ 
(QQ 
$strQQ R
,QQR S
roleNameQQT \
,QQ\ ]
userIdQQ^ d
)QQd e
;QQe f
throwRR 
newRR 
NotFoundExceptionRR '
(RR' (
$strRR( .
,RR. /
roleNameRR0 8
)RR8 9
;RR9 :
}SS 	
varUU 
userRoleUU 
=UU 
awaitUU 
_contextUU %
.UU% &
	UserRolesUU& /
.VV 
FirstOrDefaultAsyncVV  
(VV  !
aVV! "
=>VV# %
aVV& '
.VV' (
UserIdVV( .
==VV/ 1
userVV2 6
.VV6 7
IdVV7 9
&&VV: <
aVV= >
.VV> ?
RoleIdVV? E
==VVF H
roleVVI M
.VVM N
IdVVN P
)VVP Q
;VVQ R
ifWW 

(WW 
userRoleWW 
!=WW 
nullWW 
)WW 
{XX 	
_loggerYY 
.YY 

LogWarningYY 
(YY 
$strYY R
,YYR S
roleNameYYT \
,YY\ ]
userIdYY^ d
)YYd e
;YYe f
throwZZ 
newZZ 
ValidationExceptionZZ )
(ZZ) *
$"ZZ* ,
$strZZ, B
{ZZB C
roleNameZZC K
}ZZK L
"ZZL M
)ZZM N
;ZZN O
}[[ 	
_context]] 
.]] 
	UserRoles]] 
.]] 
Add]] 
(]] 
new]] "
UserRole]]# +
{^^ 	
UserId__ 
=__ 
user__ 
.__ 
Id__ 
,__ 
RoleId`` 
=`` 
role`` 
.`` 
Id`` 
,`` 
}aa 	
)aa	 

;aa
 
awaitbb 
_contextbb 
.bb 
SaveChangesAsyncbb '
(bb' (
)bb( )
;bb) *
_loggerdd 
.dd 
LogInformationdd 
(dd 
$strdd G
,ddG H
roleNameddI Q
,ddQ R
userIdddS Y
)ddY Z
;ddZ [
returnee 
trueee 
;ee 
}ff 
publichh 

asynchh 
Taskhh 
<hh 
boolhh 
>hh #
RemoveRoleFromUserAsynchh 3
(hh3 4
inthh4 7
userIdhh8 >
,hh> ?
stringhh@ F
roleNamehhG O
)hhO P
{ii 
varjj 
userjj 
=jj 
awaitjj 
_contextjj !
.jj! "
Usersjj" '
.kk 
FirstOrDefaultAsynckk  
(kk  !
akk! "
=>kk# %
akk& '
.kk' (
Idkk( *
==kk+ -
userIdkk. 4
)kk4 5
;kk5 6
ifll 

(ll 
userll 
==ll 
nullll 
)ll 
{mm 	
thrownn 
newnn 
NotFoundExceptionnn '
(nn' (
$strnn( 1
,nn1 2
userIdnn3 9
)nn9 :
;nn: ;
}oo 	
varqq 
roleqq 
=qq 
awaitqq 
_contextqq !
.qq! "
Rolesqq" '
.rr 
FirstOrDefaultAsyncrr  
(rr  !
arr! "
=>rr# %
arr& '
.rr' (
Namerr( ,
==rr- /
roleNamerr0 8
)rr8 9
;rr9 :
ifss 

(ss 
roless 
==ss 
nullss 
)ss 
{tt 	
_loggeruu 
.uu 

LogWarninguu 
(uu 
$struu T
,uuT U
roleNameuuV ^
,uu^ _
userIduu` f
)uuf g
;uug h
throwvv 
newvv 
ValidationExceptionvv )
(vv) *
$"vv* ,
$strvv, 9
{vv9 :
roleNamevv: B
}vvB C
"vvC D
)vvD E
;vvE F
}ww 	
varyy 
userRoleyy 
=yy 
awaityy 
_contextyy %
.yy% &
	UserRolesyy& /
.zz 
FirstOrDefaultAsynczz  
(zz  !
azz! "
=>zz# %
azz& '
.zz' (
UserIdzz( .
==zz/ 1
userzz2 6
.zz6 7
Idzz7 9
&&zz: <
azz= >
.zz> ?
RoleIdzz? E
==zzF H
rolezzI M
.zzM N
IdzzN P
)zzP Q
;zzQ R
if{{ 

({{ 
userRole{{ 
=={{ 
null{{ 
){{ 
{|| 	
_logger}} 
.}} 

LogWarning}} 
(}} 
$str}} T
,}}T U
roleName}}V ^
,}}^ _
userId}}` f
)}}f g
;}}g h
throw~~ 
new~~ 
NotFoundException~~ '
(~~' (
$str~~( .
,~~. /
roleName~~0 8
)~~8 9
;~~9 :
} 	
_context
ÅÅ 
.
ÅÅ 
	UserRoles
ÅÅ 
.
ÅÅ 
Remove
ÅÅ !
(
ÅÅ! "
userRole
ÅÅ" *
)
ÅÅ* +
;
ÅÅ+ ,
await
ÇÇ 
_context
ÇÇ 
.
ÇÇ 
SaveChangesAsync
ÇÇ '
(
ÇÇ' (
)
ÇÇ( )
;
ÇÇ) *
_logger
ÑÑ 
.
ÑÑ 
LogInformation
ÑÑ 
(
ÑÑ 
$str
ÑÑ K
,
ÑÑK L
roleName
ÑÑM U
,
ÑÑU V
userId
ÑÑW ]
)
ÑÑ] ^
;
ÑÑ^ _
return
ÖÖ 
true
ÖÖ 
;
ÖÖ 
}
ÜÜ 
public
àà 

async
àà 
Task
àà 
<
àà 
bool
àà 
>
àà "
SetClaimForUserAsync
àà 0
(
àà0 1
int
àà1 4
userId
àà5 ;
,
àà; <
string
àà= C
	claimType
ààD M
,
ààM N
string
ààO U

claimValue
ààV `
)
àà` a
{
ââ 
var
ää 
user
ää 
=
ää 
await
ää 
_context
ää !
.
ää! "
Users
ää" '
.
ãã !
FirstOrDefaultAsync
ãã  
(
ãã  !
a
ãã! "
=>
ãã# %
a
ãã& '
.
ãã' (
Id
ãã( *
==
ãã+ -
userId
ãã. 4
)
ãã4 5
;
ãã5 6
if
åå 

(
åå 
user
åå 
==
åå 
null
åå 
)
åå 
{
çç 	
throw
éé 
new
éé 
NotFoundException
éé '
(
éé' (
$str
éé( 1
,
éé1 2
userId
éé3 9
)
éé9 :
;
éé: ;
}
èè 	
var
ëë 
	userClaim
ëë 
=
ëë 
await
ëë 
_context
ëë &
.
ëë& '

UserClaims
ëë' 1
.
íí !
FirstOrDefaultAsync
íí  
(
íí  !
a
íí! "
=>
íí# %
a
íí& '
.
íí' (
UserId
íí( .
==
íí/ 1
user
íí2 6
.
íí6 7
Id
íí7 9
&&
íí: <
a
íí= >
.
íí> ?
	ClaimType
íí? H
==
ííI K
	claimType
ííL U
)
ííU V
;
ííV W
if
ìì 

(
ìì 
	userClaim
ìì 
!=
ìì 
null
ìì 
)
ìì 
{
îî 	
	userClaim
ïï 
.
ïï 

ClaimValue
ïï  
=
ïï! "

claimValue
ïï# -
;
ïï- .
}
ññ 	
else
óó 
{
òò 	
_context
ôô 
.
ôô 

UserClaims
ôô 
.
ôô  
Add
ôô  #
(
ôô# $
new
ôô$ '
	UserClaim
ôô( 1
{
öö 
UserId
õõ 
=
õõ 
user
õõ 
.
õõ 
Id
õõ  
,
õõ  !
	ClaimType
úú 
=
úú 
	claimType
úú %
,
úú% &

ClaimValue
ùù 
=
ùù 

claimValue
ùù '
}
ûû 
)
ûû 
;
ûû 
}
üü 	
await
†† 
_context
†† 
.
†† 
SaveChangesAsync
†† '
(
††' (
)
††( )
;
††) *
_logger
¢¢ 
.
¢¢ 
LogInformation
¢¢ 
(
¢¢ 
$str
¢¢ X
,
¢¢X Y
	claimType
¢¢Z c
,
¢¢c d

claimValue
¢¢e o
,
¢¢o p
userId
¢¢q w
)
¢¢w x
;
¢¢x y
return
££ 
true
££ 
;
££ 
}
¶¶ 
public
®® 

async
®® 
Task
®® 
<
®® 
bool
®® 
>
®® &
RemoveClaimFromUserAsync
®® 4
(
®®4 5
int
®®5 8
userId
®®9 ?
,
®®? @
string
®®A G
	claimType
®®H Q
)
®®Q R
{
©© 
var
™™ 
user
™™ 
=
™™ 
await
™™ 
_context
™™ !
.
™™! "
Users
™™" '
.
´´ !
FirstOrDefaultAsync
´´  
(
´´  !
a
´´! "
=>
´´# %
a
´´& '
.
´´' (
Id
´´( *
==
´´+ -
userId
´´. 4
)
´´4 5
;
´´5 6
if
¨¨ 

(
¨¨ 
user
¨¨ 
==
¨¨ 
null
¨¨ 
)
¨¨ 
{
≠≠ 	
throw
ÆÆ 
new
ÆÆ 
NotFoundException
ÆÆ '
(
ÆÆ' (
$str
ÆÆ( 1
,
ÆÆ1 2
userId
ÆÆ3 9
)
ÆÆ9 :
;
ÆÆ: ;
}
ØØ 	
var
±± 
	userClaim
±± 
=
±± 
await
±± 
_context
±± &
.
±±& '

UserClaims
±±' 1
.
≤≤ !
FirstOrDefaultAsync
≤≤  
(
≤≤  !
a
≤≤! "
=>
≤≤# %
a
≤≤& '
.
≤≤' (
UserId
≤≤( .
==
≤≤/ 1
user
≤≤2 6
.
≤≤6 7
Id
≤≤7 9
&&
≤≤: <
a
≤≤= >
.
≤≤> ?
	ClaimType
≤≤? H
==
≤≤I K
	claimType
≤≤L U
)
≤≤U V
;
≤≤V W
if
≥≥ 

(
≥≥ 
	userClaim
≥≥ 
==
≥≥ 
null
≥≥ 
)
≥≥ 
{
¥¥ 	
_logger
µµ 
.
µµ 

LogWarning
µµ 
(
µµ 
$str
µµ V
,
µµV W
	claimType
µµX a
,
µµa b
userId
µµc i
)
µµi j
;
µµj k
throw
∂∂ 
new
∂∂ 
NotFoundException
∂∂ '
(
∂∂' (
$str
∂∂( /
,
∂∂/ 0
	claimType
∂∂1 :
)
∂∂: ;
;
∂∂; <
}
∑∑ 	
_context
∏∏ 
.
∏∏ 

UserClaims
∏∏ 
.
∏∏ 
Remove
∏∏ "
(
∏∏" #
	userClaim
∏∏# ,
)
∏∏, -
;
∏∏- .
await
ππ 
_context
ππ 
.
ππ 
SaveChangesAsync
ππ '
(
ππ' (
)
ππ( )
;
ππ) *
_logger
ªª 
.
ªª 
LogInformation
ªª 
(
ªª 
$str
ªª M
,
ªªM N
	claimType
ªªO X
,
ªªX Y
userId
ªªZ `
)
ªª` a
;
ªªa b
return
ºº 
true
ºº 
;
ºº 
}
ΩΩ 
public
ææ 

async
ææ 
Task
ææ 
<
ææ 
bool
ææ 
>
ææ 
ActivateUserAsync
ææ -
(
ææ- .
int
ææ. 1
userId
ææ2 8
)
ææ8 9
{
øø 
var
¿¿ 
user
¿¿ 
=
¿¿ 
await
¿¿ 
_context
¿¿ !
.
¿¿! "
Users
¿¿" '
.
¡¡ !
FirstOrDefaultAsync
¡¡  
(
¡¡  !
a
¡¡! "
=>
¡¡# %
a
¡¡& '
.
¡¡' (
Id
¡¡( *
==
¡¡+ -
userId
¡¡. 4
)
¡¡4 5
;
¡¡5 6
if
¬¬ 

(
¬¬ 
user
¬¬ 
==
¬¬ 
null
¬¬ 
)
¬¬ 
{
√√ 	
_logger
ƒƒ 
.
ƒƒ 

LogWarning
ƒƒ 
(
ƒƒ 
$str
ƒƒ A
,
ƒƒA B
userId
ƒƒC I
)
ƒƒI J
;
ƒƒJ K
throw
≈≈ 
new
≈≈ 
NotFoundException
≈≈ '
(
≈≈' (
$str
≈≈( 1
,
≈≈1 2
userId
≈≈3 9
)
≈≈9 :
;
≈≈: ;
}
∆∆ 	
user
»» 
.
»» 
IsActive
»» 
=
»» 
true
»» 
;
»» 
await
   
_context
   
.
   
SaveChangesAsync
   '
(
  ' (
)
  ( )
;
  ) *
_logger
ÃÃ 
.
ÃÃ 
LogInformation
ÃÃ 
(
ÃÃ 
$str
ÃÃ 8
,
ÃÃ8 9
userId
ÃÃ: @
)
ÃÃ@ A
;
ÃÃA B
return
ÕÕ 
true
ÕÕ 
;
ÕÕ 
}
ŒŒ 
public
œœ 

async
œœ 
Task
œœ 
<
œœ 
bool
œœ 
>
œœ !
DeactivateUserAsync
œœ /
(
œœ/ 0
int
œœ0 3
userId
œœ4 :
)
œœ: ;
{
–– 
var
—— 
user
—— 
=
—— 
await
—— 
_context
—— !
.
——! "
Users
——" '
.
““ !
FirstOrDefaultAsync
““  
(
““  !
a
““! "
=>
““# %
a
““& '
.
““' (
Id
““( *
==
““+ -
userId
““. 4
)
““4 5
;
““5 6
if
”” 

(
”” 
user
”” 
==
”” 
null
”” 
)
”” 
{
‘‘ 	
_logger
’’ 
.
’’ 

LogWarning
’’ 
(
’’ 
$str
’’ C
,
’’C D
userId
’’E K
)
’’K L
;
’’L M
throw
÷÷ 
new
÷÷ 
NotFoundException
÷÷ '
(
÷÷' (
$str
÷÷( 1
,
÷÷1 2
userId
÷÷3 9
)
÷÷9 :
;
÷÷: ;
}
◊◊ 	
user
ŸŸ 
.
ŸŸ 
IsActive
ŸŸ 
=
ŸŸ 
false
ŸŸ 
;
ŸŸ 
user
⁄⁄ 
.
⁄⁄ 
RefreshToken
⁄⁄ 
=
⁄⁄ 
null
⁄⁄  
;
⁄⁄  !
user
€€ 
.
€€  
RefreshTokenExpiry
€€ 
=
€€  !
DateTime
€€" *
.
€€* +
UtcNow
€€+ 1
;
€€1 2
await
›› 
_context
›› 
.
›› 
SaveChangesAsync
›› '
(
››' (
)
››( )
;
››) *
_logger
ﬂﬂ 
.
ﬂﬂ 
LogInformation
ﬂﬂ 
(
ﬂﬂ 
$str
ﬂﬂ :
,
ﬂﬂ: ;
userId
ﬂﬂ< B
)
ﬂﬂB C
;
ﬂﬂC D
return
‡‡ 
true
‡‡ 
;
‡‡ 
}
·· 
}‚‚ Åz
SD:\BootcampProject\default-project-main\src\04.Application\Services\TokenService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
class 
TokenService 
: 
ITokenService )
{   
private!! 
readonly!! 
AppleMusicDbContext!! (
_context!!) 1
;!!1 2
private"" 
readonly"" 
JwtSettings""  
_jwtSettings""! -
;""- .
private## 
readonly## 
ILogger## 
<## 
TokenService## )
>##) *
_logger##+ 2
;##2 3
public%% 

TokenService%% 
(%% 
AppleMusicDbContext%% +
context%%, 3
,%%3 4
JwtSettings%%5 @
jwtSettings%%A L
,%%L M
ILogger%%N U
<%%U V
TokenService%%V b
>%%b c
logger%%d j
)%%j k
{&& 
_context'' 
='' 
context'' 
;'' 
_jwtSettings(( 
=(( 
jwtSettings(( "
;((" #
_logger)) 
=)) 
logger)) 
;)) 
}** 
public00 

async00 
Task00 
<00 
string00 
>00 $
GenerateAccessTokenAsync00 6
(006 7
User007 ;
user00< @
)00@ A
{11 
var22 
tokenHandler22 
=22 
new22 #
JwtSecurityTokenHandler22 6
(226 7
)227 8
;228 9
var33 
key33 
=33 
Encoding33 
.33 
UTF833 
.33  
GetBytes33  (
(33( )
_jwtSettings33) 5
.335 6
	SecretKey336 ?
)33? @
;33@ A
var66 
claims66 
=66 
await66 
BuildClaimsAsync66 +
(66+ ,
user66, 0
)660 1
;661 2
var88 
tokenDescriptor88 
=88 
new88 !#
SecurityTokenDescriptor88" 9
{99 	
Subject:: 
=:: 
new:: 
ClaimsIdentity:: (
(::( )
claims::) /
)::/ 0
,::0 1
Expires;; 
=;; 
DateTime;; 
.;; 
UtcNow;; %
.;;% &

AddMinutes;;& 0
(;;0 1
_jwtSettings;;1 =
.;;= >(
AccessTokenExpirationMinutes;;> Z
);;Z [
,;;[ \
Issuer<< 
=<< 
_jwtSettings<< !
.<<! "
Issuer<<" (
,<<( )
Audience== 
=== 
_jwtSettings== #
.==# $
Audience==$ ,
,==, -
SigningCredentials>> 
=>>  
new>>! $
SigningCredentials>>% 7
(>>7 8
new??  
SymmetricSecurityKey?? (
(??( )
key??) ,
)??, -
,??- .
SecurityAlgorithms@@ "
.@@" #
HmacSha256Signature@@# 6
)@@6 7
}AA 	
;AA	 

varCC 
tokenCC 
=CC 
tokenHandlerCC  
.CC  !
CreateTokenCC! ,
(CC, -
tokenDescriptorCC- <
)CC< =
;CC= >
returnDD 
tokenHandlerDD 
.DD 

WriteTokenDD &
(DD& '
tokenDD' ,
)DD, -
;DD- .
}EE 
publicKK 

ClaimsPrincipalKK 
?KK (
GetPrincipalFromExpiredTokenKK 8
(KK8 9
stringKK9 ?
tokenKK@ E
)KKE F
{LL 
varMM %
tokenValidationParametersMM %
=MM& '
newMM( +%
TokenValidationParametersMM, E
{NN 	
ValidateAudienceOO 
=OO 
_jwtSettingsOO +
.OO+ ,
ValidateAudienceOO, <
,OO< =
ValidateIssuerPP 
=PP 
_jwtSettingsPP )
.PP) *
ValidateIssuerPP* 8
,PP8 9$
ValidateIssuerSigningKeyQQ $
=QQ% &
_jwtSettingsQQ' 3
.QQ3 4$
ValidateIssuerSigningKeyQQ4 L
,QQL M
IssuerSigningKeyRR 
=RR 
newRR " 
SymmetricSecurityKeyRR# 7
(RR7 8
EncodingRR8 @
.RR@ A
UTF8RRA E
.RRE F
GetBytesRRF N
(RRN O
_jwtSettingsRRO [
.RR[ \
	SecretKeyRR\ e
)RRe f
)RRf g
,RRg h
ValidateLifetimeSS 
=SS 
falseSS $
,SS$ %
ValidIssuerTT 
=TT 
_jwtSettingsTT &
.TT& '
IssuerTT' -
,TT- .
ValidAudienceUU 
=UU 
_jwtSettingsUU (
.UU( )
AudienceUU) 1
}VV 	
;VV	 

varXX 
tokenHandlerXX 
=XX 
newXX #
JwtSecurityTokenHandlerXX 6
(XX6 7
)XX7 8
;XX8 9
tryZZ 
{[[ 	
var\\ 
	principal\\ 
=\\ 
tokenHandler\\ (
.\\( )
ValidateToken\\) 6
(\\6 7
token\\7 <
,\\< =%
tokenValidationParameters\\> W
,\\W X
out\\Y \
SecurityToken\\] j
securityToken\\k x
)\\x y
;\\y z
if^^ 
(^^ 
securityToken^^ 
is^^  
not^^! $
JwtSecurityToken^^% 5
jwtSecurityToken^^6 F
||^^G I
!__ 
jwtSecurityToken__ !
.__! "
Header__" (
.__( )
Alg__) ,
.__, -
Equals__- 3
(__3 4
SecurityAlgorithms__4 F
.__F G

HmacSha256__G Q
,__Q R
StringComparison__S c
.__c d&
InvariantCultureIgnoreCase__d ~
)__~ 
)	__ Ä
{`` 
throwaa 
newaa "
SecurityTokenExceptionaa 0
(aa0 1
$straa1 @
)aa@ A
;aaA B
}bb 
returndd 
	principaldd 
;dd 
}ee 	
catchff 
(ff 
	Exceptionff 
exff 
)ff 
{gg 	
_loggerhh 
.hh 

LogWarninghh 
(hh 
exhh !
,hh! "
$strhh# O
)hhO P
;hhP Q
returnii 
nullii 
;ii 
}jj 	
}kk 
publicqq 

asyncqq 
Taskqq 
<qq 
boolqq 
>qq 
IsTokenValidAsyncqq -
(qq- .
stringqq. 4
tokenqq5 :
)qq: ;
{rr 
tryss 
{tt 	
varuu 
tokenHandleruu 
=uu 
newuu "#
JwtSecurityTokenHandleruu# :
(uu: ;
)uu; <
;uu< =
varvv 
keyvv 
=vv 
Encodingvv 
.vv 
UTF8vv #
.vv# $
GetBytesvv$ ,
(vv, -
_jwtSettingsvv- 9
.vv9 :
	SecretKeyvv: C
)vvC D
;vvD E
varxx %
tokenValidationParametersxx )
=xx* +
newxx, /%
TokenValidationParametersxx0 I
{yy $
ValidateIssuerSigningKeyzz (
=zz) *
truezz+ /
,zz/ 0
IssuerSigningKey{{  
={{! "
new{{# & 
SymmetricSecurityKey{{' ;
({{; <
key{{< ?
){{? @
,{{@ A
ValidateIssuer|| 
=||  
_jwtSettings||! -
.||- .
ValidateIssuer||. <
,||< =
ValidIssuer}} 
=}} 
_jwtSettings}} *
.}}* +
Issuer}}+ 1
,}}1 2
ValidateAudience~~  
=~~! "
_jwtSettings~~# /
.~~/ 0
ValidateAudience~~0 @
,~~@ A
ValidAudience 
= 
_jwtSettings  ,
., -
Audience- 5
,5 6
ValidateLifetime
ÄÄ  
=
ÄÄ! "
true
ÄÄ# '
,
ÄÄ' (
	ClockSkew
ÅÅ 
=
ÅÅ 
TimeSpan
ÅÅ $
.
ÅÅ$ %
FromMinutes
ÅÅ% 0
(
ÅÅ0 1
_jwtSettings
ÅÅ1 =
.
ÅÅ= >
	ClockSkew
ÅÅ> G
)
ÅÅG H
}
ÇÇ 
;
ÇÇ 
tokenHandler
ÑÑ 
.
ÑÑ 
ValidateToken
ÑÑ &
(
ÑÑ& '
token
ÑÑ' ,
,
ÑÑ, -'
tokenValidationParameters
ÑÑ. G
,
ÑÑG H
out
ÑÑI L
SecurityToken
ÑÑM Z
validatedToken
ÑÑ[ i
)
ÑÑi j
;
ÑÑj k
return
ÖÖ 
await
ÖÖ 
Task
ÖÖ 
.
ÖÖ 

FromResult
ÖÖ (
(
ÖÖ( )
true
ÖÖ) -
)
ÖÖ- .
;
ÖÖ. /
}
ÜÜ 	
catch
áá 
(
áá 
	Exception
áá 
ex
áá 
)
áá 
{
àà 	
_logger
ââ 
.
ââ 

LogWarning
ââ 
(
ââ 
ex
ââ !
,
ââ! "
$str
ââ# <
)
ââ< =
;
ââ= >
return
ää 
await
ää 
Task
ää 
.
ää 

FromResult
ää (
(
ää( )
false
ää) .
)
ää. /
;
ää/ 0
}
ãã 	
}
åå 
private
íí 
async
íí 
Task
íí 
<
íí 
List
íí 
<
íí 
Claim
íí !
>
íí! "
>
íí" #
BuildClaimsAsync
íí$ 4
(
íí4 5
User
íí5 9
user
íí: >
)
íí> ?
{
ìì 
var
îî 
claims
îî 
=
îî 
new
îî 
List
îî 
<
îî 
Claim
îî #
>
îî# $
{
ïï 	
new
ññ 
(
ññ 

ClaimTypes
ññ 
.
ññ 
NameIdentifier
ññ )
,
ññ) *
user
ññ+ /
.
ññ/ 0
Id
ññ0 2
.
ññ2 3
ToString
ññ3 ;
(
ññ; <
)
ññ< =
)
ññ= >
,
ññ> ?
new
óó 
(
óó 

ClaimTypes
óó 
.
óó 
Email
óó  
,
óó  !
user
óó" &
.
óó& '
Email
óó' ,
??
óó- /
string
óó0 6
.
óó6 7
Empty
óó7 <
)
óó< =
,
óó= >
new
òò 
(
òò 

ClaimTypes
òò 
.
òò 
Name
òò 
,
òò  
user
òò! %
.
òò% &
Name
òò& *
??
òò+ -
string
òò. 4
.
òò4 5
Empty
òò5 :
)
òò: ;
,
òò; <
new
ôô 
(
ôô %
JwtRegisteredClaimNames
ôô '
.
ôô' (
Jti
ôô( +
,
ôô+ ,
Guid
ôô- 1
.
ôô1 2
NewGuid
ôô2 9
(
ôô9 :
)
ôô: ;
.
ôô; <
ToString
ôô< D
(
ôôD E
)
ôôE F
)
ôôF G
,
ôôG H
new
öö 
(
öö %
JwtRegisteredClaimNames
öö '
.
öö' (
Iat
öö( +
,
öö+ ,
DateTimeOffset
öö- ;
.
öö; <
UtcNow
öö< B
.
ööB C
ToUnixTimeSeconds
ööC T
(
ööT U
)
ööU V
.
ööV W
ToString
ööW _
(
öö_ `
)
öö` a
,
ööa b
ClaimValueTypes
ööc r
.
öör s
	Integer64
öös |
)
öö| }
}
õõ 	
;
õõ	 

var
üü 
roles
üü 
=
üü 
await
üü 
_context
üü "
.
üü" #
	UserRoles
üü# ,
.
†† 
Where
†† 
(
†† 
a
†† 
=>
†† 
a
†† 
.
†† 
UserId
††  
==
††! #
user
††$ (
.
††( )
Id
††) +
)
††+ ,
.
°° 
Include
°° 
(
°° 
a
°° 
=>
°° 
a
°° 
.
°° 
Role
°°  
)
°°  !
.
¢¢ 
Select
¢¢ 
(
¢¢ 
a
¢¢ 
=>
¢¢ 
a
¢¢ 
.
¢¢ 
Role
¢¢ 
.
¢¢  
Name
¢¢  $
)
¢¢$ %
.
££ 
ToListAsync
££ 
(
££ 
)
££ 
;
££ 
claims
§§ 
.
§§ 
AddRange
§§ 
(
§§ 
roles
§§ 
.
§§ 
Select
§§ $
(
§§$ %
role
§§% )
=>
§§* ,
new
§§- 0
Claim
§§1 6
(
§§6 7

ClaimTypes
§§7 A
.
§§A B
Role
§§B F
,
§§F G
role
§§H L
)
§§L M
)
§§M N
)
§§N O
;
§§O P
var
©© 

userClaims
©© 
=
©© 
await
©© 
_context
©© '
.
©©' (

UserClaims
©©( 2
.
™™ 
Where
™™ 
(
™™ 
a
™™ 
=>
™™ 
a
™™ 
.
™™ 
UserId
™™  
==
™™! #
user
™™$ (
.
™™( )
Id
™™) +
)
™™+ ,
.
´´ 
Select
´´ 
(
´´ 
a
´´ 
=>
´´ 
new
´´ 
Claim
´´ "
(
´´" #
a
´´# $
.
´´$ %
	ClaimType
´´% .
,
´´. /
a
´´0 1
.
´´1 2

ClaimValue
´´2 <
)
´´< =
)
´´= >
.
¨¨ 
ToListAsync
¨¨ 
(
¨¨ 
)
¨¨ 
;
¨¨ 
claims
≠≠ 
.
≠≠ 
AddRange
≠≠ 
(
≠≠ 

userClaims
≠≠ "
)
≠≠" #
;
≠≠# $
return
ØØ 
claims
ØØ 
;
ØØ 
}
∞∞ 
public
∂∂ 

Task
∂∂ 
<
∂∂ 
string
∂∂ 
>
∂∂ '
GenerateRefreshTokenAsync
∂∂ 1
(
∂∂1 2
)
∂∂2 3
{
∑∑ 
return
∏∏ 
Task
∏∏ 
.
∏∏ 

FromResult
∏∏ 
(
∏∏ 
Base64UrlEncoder
∏∏ /
.
∏∏/ 0
Encode
∏∏0 6
(
∏∏6 7#
RandomNumberGenerator
∏∏7 L
.
∏∏L M
GetBytes
∏∏M U
(
∏∏U V
$num
∏∏V X
)
∏∏X Y
)
∏∏Y Z
)
∏∏Z [
;
∏∏[ \
}
ππ 
public
∫∫ 

Task
∫∫ 
<
∫∫ 
string
∫∫ 
>
∫∫ 1
#GenerateEmailConfirmationTokenAsync
∫∫ ;
(
∫∫; <
)
∫∫< =
{
ªª 
return
ºº 
Task
ºº 
.
ºº 

FromResult
ºº 
(
ºº 
Base64UrlEncoder
ºº /
.
ºº/ 0
Encode
ºº0 6
(
ºº6 7#
RandomNumberGenerator
ºº7 L
.
ººL M
GetBytes
ººM U
(
ººU V
$num
ººV X
)
ººX Y
)
ººY Z
)
ººZ [
;
ºº[ \
}
ΩΩ 
public
øø 

Task
øø 
<
øø 
string
øø 
>
øø -
GeneratePasswordResetTokenAsync
øø 7
(
øø7 8
)
øø8 9
{
¿¿ 
return
¡¡ 
Task
¡¡ 
.
¡¡ 

FromResult
¡¡ 
(
¡¡ 
Base64UrlEncoder
¡¡ /
.
¡¡/ 0
Encode
¡¡0 6
(
¡¡6 7#
RandomNumberGenerator
¡¡7 L
.
¡¡L M
GetBytes
¡¡M U
(
¡¡U V
$num
¡¡V X
)
¡¡X Y
)
¡¡Y Z
)
¡¡Z [
;
¡¡[ \
}
¬¬ 
}√√ ˆR
VD:\BootcampProject\default-project-main\src\04.Application\Services\ScheduleService.cs
	namespace		 	
MyApp		
 
.		 
WebAPI		 
.		 
Services		 
;		  
public 
class 
ScheduleService 
: 
IScheduleService /
{ 
private 
readonly 
AppleMusicDbContext (
_context) 1
;1 2
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
ILogger 
< 
ScheduleService ,
>, -
_logger. 5
;5 6
public 

ScheduleService 
( 
AppleMusicDbContext .
context/ 6
,6 7
IMapper8 ?
mapper@ F
,F G
ILoggerH O
<O P
ScheduleServiceP _
>_ `
loggera g
)g h
{ 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
_logger 
= 
logger 
; 
} 
public 

async 
Task 
< 
IEnumerable !
<! "
ScheduleDto" -
>- .
>. /
GetAllScheduleAsync0 C
(C D
)D E
{ 
var 
schedule 
= 
await 
_context %
.% &
	Schedules& /
. 
Include 
( 
s 
=> 
s 
. 
Course "
)" #
.   
ToListAsync   
(   
)   
;   
return!! 
_mapper!! 
.!! 
Map!! 
<!! 
IEnumerable!! &
<!!& '
ScheduleDto!!' 2
>!!2 3
>!!3 4
(!!4 5
schedule!!5 =
)!!= >
;!!> ?
}"" 
public%% 

async%% 
Task%% 
<%% 
ScheduleDto%% !
>%%! " 
GetScheduleByIdAsync%%# 7
(%%7 8
int%%8 ;
id%%< >
)%%> ?
{&& 
var'' 
schedule'' 
='' 
await'' 
_context'' %
.''% &
	Schedules''& /
.(( 
Include(( 
((( 
s(( 
=>(( 
s(( 
.(( 
Course(( "
)((" #
.)) 
FirstOrDefaultAsync))  
())  !
s))! "
=>))# %
s))& '
.))' (
Id))( *
==))+ -
id)). 0
)))0 1
;))1 2
if** 

(** 
schedule** 
==** 
null** 
)** 
{++ 	
throw,, 
new,, 
NotFoundException,, '
(,,' (
$str,,( 5
,,,5 6
id,,7 9
),,9 :
;,,: ;
}-- 	
return.. 
_mapper.. 
... 
Map.. 
<.. 
ScheduleDto.. &
>..& '
(..' (
schedule..( 0
)..0 1
;..1 2
}// 
public22 

async22 
Task22 
<22 
ScheduleDto22 !
>22! "
CreateScheduleAsync22# 6
(226 7
CreateScheduleDto227 H
createScheduleDto22I Z
)22Z [
{33 
var55 
courseExists55 
=55 
await55  
_context55! )
.55) *
Courses55* 1
.551 2
AnyAsync552 :
(55: ;
c55; <
=>55= ?
c55@ A
.55A B
Id55B D
==55E G
createScheduleDto55H Y
.55Y Z
CourseId55Z b
)55b c
;55c d
if66 

(66 
!66 
courseExists66 
)66 
{77 	
throw88 
new88 
ValidationException88 )
(88) *
$"88* ,
$str88, ;
{88; <
createScheduleDto88< M
.88M N
CourseId88N V
}88V W
$str88W f
"88f g
)88g h
;88h i
}99 	
var;; 
schedule;; 
=;; 
_mapper;; 
.;; 
Map;; "
<;;" #
Schedule;;# +
>;;+ ,
(;;, -
createScheduleDto;;- >
);;> ?
;;;? @
_context== 
.== 
	Schedules== 
.== 
Add== 
(== 
schedule== '
)==' (
;==( )
await>> 
_context>> 
.>> 
SaveChangesAsync>> '
(>>' (
)>>( )
;>>) *
_logger@@ 
.@@ 
LogInformation@@ 
(@@ 
$str@@ G
,@@G H
scheduleAA 
.AA 
IdAA 
)AA 
;AA 
returnCC 
_mapperCC 
.CC 
MapCC 
<CC 
ScheduleDtoCC &
>CC& '
(CC' (
scheduleCC( 0
)CC0 1
;CC1 2
}DD 
publicGG 

asyncGG 
TaskGG 
<GG 
ScheduleDtoGG !
>GG! "
UpdateScheduleAsyncGG# 6
(GG6 7
intGG7 :
idGG; =
,GG= >
UpdateScheduleDtoGG? P
updateScheduleDtoGGQ b
)GGb c
{HH 
varII 
scheduleII 
=II 
awaitII 
_contextII %
.II% &
	SchedulesII& /
.JJ 
IncludeJJ 
(JJ 
pJJ 
=>JJ !
pJJ" #
.JJ# $
CourseJJ$ *
)JJ* +
.KK 
FirstOrDefaultAsyncKK (
(KK( )
pKK) *
=>KK+ -
pKK. /
.KK/ 0
IdKK0 2
==KK3 5
idKK6 8
)KK8 9
;KK9 :
ifMM 

(MM 
scheduleMM 
==MM 
nullMM 
)MM 
{NN 	
throwOO 
newOO 
NotFoundExceptionOO '
(OO' (
$strOO( 5
,OO5 6
idOO7 9
)OO9 :
;OO: ;
}PP 	
ifSS 

(SS 
updateScheduleDtoSS 
.SS 
CourseIdSS &
!=SS' )
scheduleSS* 2
.SS2 3
CourseIdSS3 ;
)SS; <
{TT 	
varUU 
courseExistsUU 
=UU 
awaitUU $
_contextUU% -
.UU- .
CoursesUU. 5
.UU5 6
AnyAsyncUU6 >
(UU> ?
cUU? @
=>UUA C
cUUD E
.UUE F
IdUUF H
==UUI K
updateScheduleDtoUUL ]
.UU] ^
CourseIdUU^ f
)UUf g
;UUg h
ifVV 
(VV 
!VV 
courseExistsVV 
)VV 
{WW 
throwYY 
newYY 
ValidationExceptionYY -
(YY- .
$"YY. 0
$strYY0 ?
{YY? @
updateScheduleDtoYY@ Q
.YYQ R
CourseIdYYR Z
}YYZ [
$strYY[ j
"YYj k
)YYk l
;YYl m
}ZZ 
}[[ 	
_mapper]] 
.]] 
Map]] 
(]] 
updateScheduleDto]] %
,]]% &
schedule]]' /
)]]/ 0
;]]0 1
schedule^^ 
.^^ 
	UpdatedAt^^ 
=^^ 
DateTime^^ %
.^^% &
UtcNow^^& ,
;^^, -
await`` 
_context`` 
.`` 
SaveChangesAsync`` '
(``' (
)``( )
;``) *
ifcc 

(cc 
updateScheduleDtocc 
.cc 
CourseIdcc &
!=cc' )
schedulecc* 2
.cc2 3
CourseIdcc3 ;
)cc; <
{dd 	
awaitee 
_contextee 
.ee 
Entryee  
(ee  !
scheduleee! )
)ee) *
.ee* +
	Referenceee+ 4
(ee4 5
pee5 6
=>ee7 9
pee: ;
.ee; <
Courseee< B
)eeB C
.eeC D
	LoadAsynceeD M
(eeM N
)eeN O
;eeO P
}ff 	
_loggerhh 
.hh 
LogInformationhh 
(hh 
$strhh ?
,hh? @
idhhA C
)hhC D
;hhD E
returnjj 
_mapperjj 
.jj 
Mapjj 
<jj 
ScheduleDtojj &
>jj& '
(jj' (
schedulejj( 0
)jj0 1
;jj1 2
}kk 
publicnn 

asyncnn 
Tasknn 
<nn 
boolnn 
>nn 
DeleteScheduleAsyncnn /
(nn/ 0
intnn0 3
idnn4 6
)nn6 7
{oo 
varpp 
schedulepp 
=pp 
awaitpp 
_contextpp %
.pp% &
	Schedulespp& /
.qq 
	FindAsyncqq 
(qq 
idqq 
)qq 
;qq 
ifrr 

(rr 
schedulerr 
==rr 
nullrr 
)rr 
{ss 	
throwtt 
newtt 
NotFoundExceptiontt '
(tt' (
$strtt( 5
,tt5 6
idtt7 9
)tt9 :
;tt: ;
}uu 	
_contextww 
.ww 
	Schedulesww 
.ww 
Removeww !
(ww! "
scheduleww" *
)ww* +
;ww+ ,
awaitxx 
_contextxx 
.xx 
SaveChangesAsyncxx '
(xx' (
)xx( )
;xx) *
_loggerzz 
.zz 
LogInformationzz 
(zz 
$strzz ?
,zz? @
idzzA C
)zzC D
;zzD E
return|| 
true|| 
;|| 
}}} 
public
ÄÄ 

async
ÄÄ 
Task
ÄÄ 
<
ÄÄ 
bool
ÄÄ 
>
ÄÄ !
ScheduleExistsAsync
ÄÄ /
(
ÄÄ/ 0
int
ÄÄ0 3
id
ÄÄ4 6
)
ÄÄ6 7
{
ÅÅ 
return
ÇÇ 
await
ÇÇ 
_context
ÇÇ 
.
ÇÇ 
	Schedules
ÇÇ '
.
ÇÇ' (
AnyAsync
ÇÇ( 0
(
ÇÇ0 1
c
ÇÇ1 2
=>
ÇÇ3 5
c
ÇÇ6 7
.
ÇÇ7 8
Id
ÇÇ8 :
==
ÇÇ; =
id
ÇÇ> @
)
ÇÇ@ A
;
ÇÇA B
}
ÉÉ 
}ÑÑ ŒO
UD:\BootcampProject\default-project-main\src\04.Application\Services\PaymentService.cs
	namespace		 	
MyApp		
 
.		 
WebAPI		 
.		 
Services		 
;		  
public 
class 
PaymentService 
: 
IPaymentService -
{ 
private 
readonly 
AppleMusicDbContext (
_context) 1
;1 2
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
ILogger 
< 
PaymentService +
>+ ,
_logger- 4
;4 5
public 

PaymentService 
( 
AppleMusicDbContext -
context. 5
,5 6
IMapper7 >
mapper? E
,E F
ILoggerG N
<N O
PaymentServiceO ]
>] ^
logger_ e
)e f
{ 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
_logger 
= 
logger 
; 
} 
public 

async 
Task 
< 
IEnumerable !
<! "

PaymentDto" ,
>, -
>- .
GetAllPaymentAsync/ A
(A B
)B C
{ 
var 
payments 
= 
await 
_context %
.% &
PaymentMethods& 4
. 
ToListAsync 
( 
) 
; 
return   
_mapper   
.   
Map   
<   
IEnumerable   &
<  & '

PaymentDto  ' 1
>  1 2
>  2 3
(  3 4
payments  4 <
)  < =
;  = >
}!! 
public$$ 

async$$ 
Task$$ 
<$$ 

PaymentDto$$  
>$$  !
GetPaymentByIdAsync$$" 5
($$5 6
int$$6 9
id$$: <
)$$< =
{%% 
var&& 
payment&& 
=&& 
await&& 
_context&& $
.&&$ %
PaymentMethods&&% 3
.'' 
FirstOrDefaultAsync''  
(''  !
c''! "
=>''# %
c''& '
.''' (
Id''( *
==''+ -
id''. 0
)''0 1
;''1 2
if(( 

((( 
payment(( 
==(( 
null(( 
)(( 
{)) 	
throw** 
new** 
NotFoundException** '
(**' (
$str**( :
,**: ;
id**< >
)**> ?
;**? @
}++ 	
return,, 
_mapper,, 
.,, 
Map,, 
<,, 

PaymentDto,, %
>,,% &
(,,& '
payment,,' .
),,. /
;,,/ 0
}-- 
public00 

async00 
Task00 
<00 

PaymentDto00  
>00  !
CreatePaymentAsync00" 4
(004 5
CreatePaymentDto005 E
createPaymentDto00F V
)00V W
{11 
var22 
payment22 
=22 
_mapper22 
.22 
Map22 !
<22! "
PaymentMethod22" /
>22/ 0
(220 1
createPaymentDto221 A
)22A B
;22B C
if55 

(55 
!55 
string55 
.55 
IsNullOrWhiteSpace55 &
(55& '
createPaymentDto55' 7
.557 8
LogoUrl558 ?
)55? @
&&55A C
createPaymentDto66 
.66 
LogoUrl66 $
.66$ %

StartsWith66% /
(66/ 0
$str660 <
)66< =
)66= >
{77 	
var99 

base64Data99 
=99 
createPaymentDto99 -
.99- .
LogoUrl99. 5
.995 6
	Substring996 ?
(99? @
createPaymentDto99@ P
.99P Q
LogoUrl99Q X
.99X Y
IndexOf99Y `
(99` a
$str99a d
)99d e
+99f g
$num99h i
)99i j
;99j k
var:: 
bytes:: 
=:: 
Convert:: 
.::  
FromBase64String::  0
(::0 1

base64Data::1 ;
)::; <
;::< =
var<< 
uploadsFolder<< 
=<< 
Path<<  $
.<<$ %
Combine<<% ,
(<<, -
	Directory<<- 6
.<<6 7
GetCurrentDirectory<<7 J
(<<J K
)<<K L
,<<L M
$str<<N W
,<<W X
$str<<Y ^
)<<^ _
;<<_ `
if== 
(== 
!== 
	Directory== 
.== 
Exists== !
(==! "
uploadsFolder==" /
)==/ 0
)==0 1
	Directory>> 
.>> 
CreateDirectory>> )
(>>) *
uploadsFolder>>* 7
)>>7 8
;>>8 9
var@@ 
fileName@@ 
=@@ 
$"@@ 
{@@ 
Guid@@ "
.@@" #
NewGuid@@# *
(@@* +
)@@+ ,
}@@, -
$str@@- 1
"@@1 2
;@@2 3
varAA 
filePathAA 
=AA 
PathAA 
.AA  
CombineAA  '
(AA' (
uploadsFolderAA( 5
,AA5 6
fileNameAA7 ?
)AA? @
;AA@ A
awaitBB 
FileBB 
.BB 
WriteAllBytesAsyncBB )
(BB) *
filePathBB* 2
,BB2 3
bytesBB4 9
)BB9 :
;BB: ;
paymentEE 
.EE 
LogoUrlEE 
=EE 
$"EE  
$strEE  %
{EE% &
fileNameEE& .
}EE. /
"EE/ 0
;EE0 1
}FF 	
_contextHH 
.HH 
PaymentMethodsHH 
.HH  
AddHH  #
(HH# $
paymentHH$ +
)HH+ ,
;HH, -
awaitII 
_contextII 
.II 
SaveChangesAsyncII '
(II' (
)II( )
;II) *
_loggerKK 
.KK 
LogInformationKK 
(KK 
$strKK T
,KKT U
paymentLL 
.LL 
NameLL 
,LL 
paymentLL !
.LL! "
IdLL" $
)LL$ %
;LL% &
returnNN 
_mapperNN 
.NN 
MapNN 
<NN 

PaymentDtoNN %
>NN% &
(NN& '
paymentNN' .
)NN. /
;NN/ 0
}OO 
publicRR 

asyncRR 
TaskRR 
<RR 

PaymentDtoRR  
>RR  !
UpdatePaymentAsyncRR" 4
(RR4 5
intRR5 8
idRR9 ;
,RR; <
UpdatePaymentDtoRR= M
updatePaymentDtoRRN ^
)RR^ _
{SS 
varTT 
paymentTT 
=TT 
awaitTT 
_contextTT $
.TT$ %
PaymentMethodsTT% 3
.UU 
	FindAsyncUU 
(UU 
idUU 
)UU 
;UU 
ifVV 

(VV 
paymentVV 
==VV 
nullVV 
)VV 
{WW 	
throwXX 
newXX 
NotFoundExceptionXX '
(XX' (
$strXX( :
,XX: ;
idXX< >
)XX> ?
;XX? @
}YY 	
_mapper[[ 
.[[ 
Map[[ 
([[ 
updatePaymentDto[[ $
,[[$ %
payment[[& -
)[[- .
;[[. /
payment\\ 
.\\ 
	UpdatedAt\\ 
=\\ 
DateTime\\ $
.\\$ %
UtcNow\\% +
;\\+ ,
await^^ 
_context^^ 
.^^ 
SaveChangesAsync^^ '
(^^' (
)^^( )
;^^) *
_logger`` 
.`` 
LogInformation`` 
(`` 
$str`` =
,``= >
id``? A
)``A B
;``B C
returnbb 
_mapperbb 
.bb 
Mapbb 
<bb 

PaymentDtobb %
>bb% &
(bb& '
paymentbb' .
)bb. /
;bb/ 0
}cc 
publicff 

asyncff 
Taskff 
<ff 
boolff 
>ff 
DeletePaymentAsyncff .
(ff. /
intff/ 2
idff3 5
)ff5 6
{gg 
varhh 
paymenthh 
=hh 
awaithh 
_contexthh $
.hh$ %
PaymentMethodshh% 3
.ii 
	FindAsyncii 
(ii 
idii 
)ii 
;ii 
ifjj 

(jj 
paymentjj 
==jj 
nulljj 
)jj 
{kk 	
throwll 
newll 
NotFoundExceptionll '
(ll' (
$strll( :
,ll: ;
idll< >
)ll> ?
;ll? @
}mm 	
_contextoo 
.oo 
PaymentMethodsoo 
.oo  
Removeoo  &
(oo& '
paymentoo' .
)oo. /
;oo/ 0
awaitpp 
_contextpp 
.pp 
SaveChangesAsyncpp '
(pp' (
)pp( )
;pp) *
_loggerrr 
.rr 
LogInformationrr 
(rr 
$strrr =
,rr= >
idrr? A
)rrA B
;rrB C
returntt 
truett 
;tt 
}uu 
publicxx 

asyncxx 
Taskxx 
<xx 
boolxx 
>xx 
PaymentExistsAsyncxx .
(xx. /
intxx/ 2
idxx3 5
)xx5 6
{yy 
returnzz 
awaitzz 
_contextzz 
.zz 
PaymentMethodszz ,
.zz, -
AnyAsynczz- 5
(zz5 6
czz6 7
=>zz8 :
czz; <
.zz< =
Idzz= ?
==zz@ B
idzzC E
)zzE F
;zzF G
}{{ 
}|| Ò
VD:\BootcampProject\default-project-main\src\04.Application\Services\PasswordService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
class 
PasswordService 
: 
IPasswordService /
{ 
public 

string 
HashPassword 
( 
string %
password& .
). /
{		 
return

 
BCrypt

 
.

 
Net

 
.

 
BCrypt

  
.

  !
HashPassword

! -
(

- .
password

. 6
)

6 7
;

7 8
} 
public 

bool 
VerifyPassword 
( 
string %
password& .
,. /
string0 6
hashedPassword7 E
)E F
{ 
try 
{ 	
return 
BCrypt 
. 
Net 
. 
BCrypt $
.$ %
Verify% +
(+ ,
password, 4
,4 5
hashedPassword6 D
)D E
;E F
} 	
catch 
{ 	
return 
false 
; 
} 	
} 
public 

bool 
IsPasswordStrong  
(  !
string! '
password( 0
)0 1
{ 
if 

( 
password 
. 
Length 
< 
$num 
)  
return! '
false( -
;- .
if&& 

(&& 
!&& 
Regex&& 
.&& 
IsMatch&& 
(&& 
password&& #
,&&# $
$str&&% -
)&&- .
)&&. /
return&&0 6
false&&7 <
;&&< =
if'' 

('' 
!'' 
Regex'' 
.'' 
IsMatch'' 
('' 
password'' #
,''# $
$str''% -
)''- .
)''. /
return''0 6
false''7 <
;''< =
if(( 

((( 
!(( 
Regex(( 
.(( 
IsMatch(( 
((( 
password(( #
,((# $
$str((% *
)((* +
)((+ ,
return((- 3
false((4 9
;((9 :
if)) 

()) 
!)) 
Regex)) 
.)) 
IsMatch)) 
()) 
password)) #
,))# $
$str))% 6
)))6 7
)))7 8
return))9 ?
false))@ E
;))E F
return,, 
true,, 
;,, 
}-- 
}.. œU
WD:\BootcampProject\default-project-main\src\04.Application\Validators\AuthValidators.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 

Validators !
{ 
public 

class $
RegisterRequestValidator )
:* +
AbstractValidator, =
<= >
RegisterRequestDto> P
>P Q
{		 
public

 $
RegisterRequestValidator

 '
(

' (
)

( )
{ 	
RuleFor 
( 
x 
=> 
x 
. 
Email  
)  !
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( ;
); <
. 
EmailAddress 
( 
) 
.  
WithMessage  +
(+ ,
$str, B
)B C
. 
MaximumLength 
( 
$num "
)" #
.# $
WithMessage$ /
(/ 0
$str0 T
)T U
;U V
RuleFor 
( 
x 
=> 
x 
. 
Name 
)  
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( :
): ;
. 
MinimumLength 
( 
$num  
)  !
.! "
WithMessage" -
(- .
$str. R
)R S
. 
MaximumLength 
( 
$num "
)" #
.# $
WithMessage$ /
(/ 0
$str0 S
)S T
;T U
RuleFor 
( 
x 
=> 
x 
. 
NewPassword &
)& '
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( >
)> ?
. 
MinimumLength 
( 
$num  
)  !
.! "
WithMessage" -
(- .
$str. V
)V W
. 
Matches 
( 
$str !
)! "
." #
WithMessage# .
(. /
$str/ d
)d e
. 
Matches 
( 
$str !
)! "
." #
WithMessage# .
(. /
$str/ d
)d e
. 
Matches 
( 
$str !
)! "
." #
WithMessage# .
(. /
$str/ Z
)Z [
. 
Matches 
( 
$str !
)! "
." #
WithMessage# .
(. /
$str/ e
)e f
;f g
RuleFor 
( 
x 
=> 
x 
. 
ConfirmNewPassword -
)- .
. 
NotEmpty 
( 
) 
. 
WithMessage '
(' (
$str( F
)F G
.   
Equal   
(   
x   
=>   
x   
.   
NewPassword   )
)  ) *
.  * +
WithMessage  + 6
(  6 7
$str  7 O
)  O P
;  P Q
}!! 	
}"" 
public%% 

class%% !
LoginRequestValidator%% &
:%%' (
AbstractValidator%%) :
<%%: ;
LoginRequestDto%%; J
>%%J K
{&& 
public'' !
LoginRequestValidator'' $
(''$ %
)''% &
{(( 	
RuleFor)) 
()) 
x)) 
=>)) 
x)) 
.)) 
Email))  
)))  !
.** 
NotEmpty** 
(** 
)** 
.** 
WithMessage** '
(**' (
$str**( ;
)**; <
.++ 
EmailAddress++ 
(++ 
)++ 
.++  
WithMessage++  +
(+++ ,
$str++, B
)++B C
;++C D
RuleFor-- 
(-- 
x-- 
=>-- 
x-- 
.-- 
Password-- #
)--# $
... 
NotEmpty.. 
(.. 
).. 
... 
WithMessage.. '
(..' (
$str..( >
)..> ?
;..? @
}// 	
}00 
public33 

class33 *
ChangePasswordRequestValidator33 /
:330 1
AbstractValidator332 C
<33C D$
ChangePasswordRequestDto33D \
>33\ ]
{44 
public55 *
ChangePasswordRequestValidator55 -
(55- .
)55. /
{66 	
RuleFor77 
(77 
x77 
=>77 
x77 
.77 
CurrentPassword77 *
)77* +
.88 
NotEmpty88 
(88 
)88 
.88 
WithMessage88 '
(88' (
$str88( F
)88F G
;88G H
RuleFor:: 
(:: 
x:: 
=>:: 
x:: 
.:: 
NewPassword:: &
)::& '
.;; 
NotEmpty;; 
(;; 
);; 
.;; 
WithMessage;; '
(;;' (
$str;;( B
);;B C
.<< 
MinimumLength<< 
(<< 
$num<<  
)<<  !
.<<! "
WithMessage<<" -
(<<- .
$str<<. V
)<<V W
.== 
Matches== 
(== 
$str== !
)==! "
.==" #
WithMessage==# .
(==. /
$str==/ d
)==d e
.>> 
Matches>> 
(>> 
$str>> !
)>>! "
.>>" #
WithMessage>># .
(>>. /
$str>>/ d
)>>d e
.?? 
Matches?? 
(?? 
$str?? !
)??! "
.??" #
WithMessage??# .
(??. /
$str??/ Z
)??Z [
.@@ 
Matches@@ 
(@@ 
$str@@ !
)@@! "
.@@" #
WithMessage@@# .
(@@. /
$str@@/ e
)@@e f
.AA 
NotEqualAA 
(AA 
xAA 
=>AA 
xAA  
.AA  !
CurrentPasswordAA! 0
)AA0 1
.AA1 2
WithMessageAA2 =
(AA= >
$strAA> t
)AAt u
;AAu v
RuleForCC 
(CC 
xCC 
=>CC 
xCC 
.CC 
ConfirmNewPasswordCC -
)CC- .
.DD 
NotEmptyDD 
(DD 
)DD 
.DD 
WithMessageDD '
(DD' (
$strDD( F
)DDF G
.EE 
EqualEE 
(EE 
xEE 
=>EE 
xEE 
.EE 
NewPasswordEE )
)EE) *
.EE* +
WithMessageEE+ 6
(EE6 7
$strEE7 O
)EEO P
;EEP Q
}FF 	
}GG 
publicJJ 

classJJ *
ForgotPasswordRequestValidatorJJ /
:JJ0 1
AbstractValidatorJJ2 C
<JJC D$
ForgotPasswordRequestDtoJJD \
>JJ\ ]
{KK 
publicLL *
ForgotPasswordRequestValidatorLL -
(LL- .
)LL. /
{MM 	
RuleForNN 
(NN 
xNN 
=>NN 
xNN 
.NN 
EmailNN  
)NN  !
.OO 
NotEmptyOO 
(OO 
)OO 
.OO 
WithMessageOO '
(OO' (
$strOO( ;
)OO; <
.PP 
EmailAddressPP 
(PP 
)PP 
.PP  
WithMessagePP  +
(PP+ ,
$strPP, B
)PPB C
;PPC D
}QQ 	
}RR 
publicUU 

classUU )
ResetPasswordRequestValidatorUU .
:UU/ 0
AbstractValidatorUU1 B
<UUB C#
ResetPasswordRequestDtoUUC Z
>UUZ [
{VV 
publicWW )
ResetPasswordRequestValidatorWW ,
(WW, -
)WW- .
{XX 	
RuleForYY 
(YY 
xYY 
=>YY 
xYY 
.YY 
EmailYY  
)YY  !
.ZZ 
NotEmptyZZ 
(ZZ 
)ZZ 
.ZZ 
WithMessageZZ '
(ZZ' (
$strZZ( ;
)ZZ; <
.[[ 
EmailAddress[[ 
([[ 
)[[ 
.[[  
WithMessage[[  +
([[+ ,
$str[[, B
)[[B C
;[[C D
RuleFor]] 
(]] 
x]] 
=>]] 
x]] 
.]] 
PasswordResetToken]] -
)]]- .
.^^ 
NotEmpty^^ 
(^^ 
)^^ 
.^^ 
WithMessage^^ '
(^^' (
$str^^( ;
)^^; <
;^^< =
RuleFor`` 
(`` 
x`` 
=>`` 
x`` 
.`` 
NewPassword`` &
)``& '
.aa 
NotEmptyaa 
(aa 
)aa 
.aa 
WithMessageaa '
(aa' (
$straa( B
)aaB C
.bb 
MinimumLengthbb 
(bb 
$numbb  
)bb  !
.bb! "
WithMessagebb" -
(bb- .
$strbb. V
)bbV W
.cc 
Matchescc 
(cc 
$strcc !
)cc! "
.cc" #
WithMessagecc# .
(cc. /
$strcc/ d
)ccd e
.dd 
Matchesdd 
(dd 
$strdd !
)dd! "
.dd" #
WithMessagedd# .
(dd. /
$strdd/ d
)ddd e
.ee 
Matchesee 
(ee 
$stree !
)ee! "
.ee" #
WithMessageee# .
(ee. /
$stree/ Z
)eeZ [
.ff 
Matchesff 
(ff 
$strff !
)ff! "
.ff" #
WithMessageff# .
(ff. /
$strff/ e
)ffe f
;fff g
RuleForhh 
(hh 
xhh 
=>hh 
xhh 
.hh 
ConfirmNewPasswordhh -
)hh- .
.ii 
NotEmptyii 
(ii 
)ii 
.ii 
WithMessageii '
(ii' (
$strii( F
)iiF G
.jj 
Equaljj 
(jj 
xjj 
=>jj 
xjj 
.jj 
NewPasswordjj )
)jj) *
.jj* +
WithMessagejj+ 6
(jj6 7
$strjj7 O
)jjO P
;jjP Q
}kk 	
}ll 
}mm óp
UD:\BootcampProject\default-project-main\src\04.Application\Services\MyClassService.cs
	namespace		 	
MyApp		
 
.		 
WebAPI		 
.		 
Services		 
;		  
public 
class 
MyClassService 
: 
IMyClassService -
{ 
private 
readonly 
AppleMusicDbContext (
_context) 1
;1 2
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
ILogger 
< 
MyClassService +
>+ ,
_logger- 4
;4 5
public 

MyClassService 
( 
AppleMusicDbContext -
context. 5
,5 6
IMapper7 >
mapper? E
,E F
ILoggerG N
<N O
MyClassServiceO ]
>] ^
logger_ e
)e f
{ 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
_logger 
= 
logger 
; 
} 
public 

async 
Task 
< 
IEnumerable !
<! "

MyClassDto" ,
>, -
>- .%
GetMyClassesByUserIdAsync/ H
(H I
intI L
userIdM S
)S T
{ 
var 
	myClasses 
= 
await 
_context &
.& '
	MyClasses' 0
. 
Where 
( 
m 
=> 
m 
. 
UserId  
==! #
userId$ *
)* +
.   
Include   
(   
m   
=>   
m   
.   
Schedule   $
)  $ %
.!! 
ThenInclude!! 
(!! 
s!! 
=>!! 
s!! 
.!!  
Course!!  &
)!!& '
."" 
ThenInclude"" 
("" 
c"" 
=>"" 
c"" 
.""  
Category""  (
)""( )
.## 
ToListAsync## 
(## 
)## 
;## 
return$$ 
_mapper$$ 
.$$ 
Map$$ 
<$$ 
IEnumerable$$ &
<$$& '

MyClassDto$$' 1
>$$1 2
>$$2 3
($$3 4
	myClasses$$4 =
)$$= >
;$$> ?
}%% 
public(( 

async(( 
Task(( 
<(( 

MyClassDto((  
>((  !
GetMyClassByIdAsync((" 5
(((5 6
int((6 9
id((: <
)((< =
{)) 
var** 
myclass** 
=** 
await** 
_context** $
.**$ %
	MyClasses**% .
.++ 
Include++ 
(++ 
m++ 
=>++ 
m++ 
.++ 
Schedule++ $
)++$ %
.,, 
ThenInclude,, 
(,, 
s,, 
=>,, 
s,, 
.,,  
Course,,  &
),,& '
.-- 
ThenInclude-- 
(-- 
c-- 
=>-- 
c-- 
.--  
Category--  (
)--( )
... 
FirstOrDefaultAsync..  
(..  !
c..! "
=>..# %
c..& '
...' (
Id..( *
==..+ -
id... 0
)..0 1
;..1 2
if// 

(// 
myclass// 
==// 
null// 
)// 
{00 	
throw11 
new11 
NotFoundException11 '
(11' (
$str11( 4
,114 5
id116 8
)118 9
;119 :
}22 	
return33 
_mapper33 
.33 
Map33 
<33 

MyClassDto33 %
>33% &
(33& '
myclass33' .
)33. /
;33/ 0
}44 
public77 

async77 
Task77 
<77 

MyClassDto77  
>77  !
CreateMyClassAsync77" 4
(774 5
CreateMyClassDto775 E
createMyClassDto77F V
)77V W
{88 
var:: 

userExists:: 
=:: 
await:: 
_context:: '
.::' (
Users::( -
.::- .
AnyAsync::. 6
(::6 7
c::7 8
=>::9 ;
c::< =
.::= >
Id::> @
==::A C
createMyClassDto::D T
.::T U
UserId::U [
)::[ \
;::\ ]
if;; 

(;; 
!;; 

userExists;; 
);; 
{<< 	
throw== 
new== 
ValidationException== )
(==) *
$"==* ,
$str==, 9
{==9 :
createMyClassDto==: J
.==J K
UserId==K Q
}==Q R
$str==R a
"==a b
)==b c
;==c d
}>> 	
varAA 
scheduleExistsAA 
=AA 
awaitAA "
_contextAA# +
.AA+ ,
	SchedulesAA, 5
.AA5 6
AnyAsyncAA6 >
(AA> ?
sAA? @
=>AAA C
sAAD E
.AAE F
IdAAF H
==AAI K
createMyClassDtoAAL \
.AA\ ]

ScheduleIdAA] g
)AAg h
;AAh i
ifBB 

(BB 
!BB 
scheduleExistsBB 
)BB 
{CC 	
throwDD 
newDD 
ValidationExceptionDD )
(DD) *
$"DD* ,
$strDD, =
{DD= >
createMyClassDtoDD> N
.DDN O

ScheduleIdDDO Y
}DDY Z
$strDDZ i
"DDi j
)DDj k
;DDk l
}EE 	
varGG 
myclassGG 
=GG 
_mapperGG 
.GG 
MapGG !
<GG! "
MyClassGG" )
>GG) *
(GG* +
createMyClassDtoGG+ ;
)GG; <
;GG< =
_contextII 
.II 
	MyClassesII 
.II 
AddII 
(II 
myclassII &
)II& '
;II' (
awaitJJ 
_contextJJ 
.JJ 
SaveChangesAsyncJJ '
(JJ' (
)JJ( )
;JJ) *
ifMM 

(MM 
createMyClassDtoMM 
.MM 
UserIdMM #
!=MM$ &
myclassMM' .
.MM. /
UserIdMM/ 5
)MM5 6
{NN 	
awaitOO 
_contextOO 
.OO 
EntryOO  
(OO  !
myclassOO! (
)OO( )
.OO) *
	ReferenceOO* 3
(OO3 4
pOO4 5
=>OO6 8
pOO9 :
.OO: ;
UserOO; ?
)OO? @
.OO@ A
	LoadAsyncOOA J
(OOJ K
)OOK L
;OOL M
}PP 	
ifRR 

(RR 
createMyClassDtoRR 
.RR 

ScheduleIdRR '
!=RR( *
myclassRR+ 2
.RR2 3

ScheduleIdRR3 =
)RR= >
{SS 	
awaitTT 
_contextTT 
.TT 
EntryTT  
(TT  !
myclassTT! (
)TT( )
.TT) *
	ReferenceTT* 3
(TT3 4
pTT4 5
=>TT6 8
pTT9 :
.TT: ;
ScheduleTT; C
)TTC D
.TTD E
	LoadAsyncTTE N
(TTN O
)TTO P
;TTP Q
}UU 	
_loggerXX 
.XX 
LogInformationXX 
(XX 
$strXX @
,XX@ A
myclassYY 
.YY 
IdYY 
)YY 
;YY 
return[[ 
_mapper[[ 
.[[ 
Map[[ 
<[[ 

MyClassDto[[ %
>[[% &
([[& '
myclass[[' .
)[[. /
;[[/ 0
}\\ 
public__ 

async__ 
Task__ 
<__ 

MyClassDto__  
>__  !
UpdateMyClassAsync__" 4
(__4 5
int__5 8
id__9 ;
,__; <
UpdateMyClassDto__= M
updateMyClassDto__N ^
)__^ _
{`` 
varaa 
myclassaa 
=aa 
awaitaa 
_contextaa $
.aa$ %
	MyClassesaa% .
.bb 
	FindAsyncbb 
(bb 
idbb 
)bb 
;bb 
ifcc 

(cc 
myclasscc 
==cc 
nullcc 
)cc 
{dd 	
throwee 
newee 
NotFoundExceptionee '
(ee' (
$stree( 4
,ee4 5
idee6 8
)ee8 9
;ee9 :
}ff 	
ifii 

(ii 
updateMyClassDtoii 
.ii 
UserIdii #
!=ii$ &
myclassii' .
.ii. /
UserIdii/ 5
)ii5 6
{jj 	
varkk 

userExistskk 
=kk 
awaitkk "
_contextkk# +
.kk+ ,
Userskk, 1
.kk1 2
AnyAsynckk2 :
(kk: ;
ckk; <
=>kk= ?
ckk@ A
.kkA B
IdkkB D
==kkE G
updateMyClassDtokkH X
.kkX Y
UserIdkkY _
)kk_ `
;kk` a
ifll 
(ll 
!ll 

userExistsll 
)ll 
{mm 
throwoo 
newoo 
ValidationExceptionoo -
(oo- .
$"oo. 0
$stroo0 =
{oo= >
updateMyClassDtooo> N
.ooN O
UserIdooO U
}ooU V
$strooV e
"ooe f
)oof g
;oog h
}pp 
}qq 	
vartt 
scheduleExiststt 
=tt 
awaittt "
_contexttt# +
.tt+ ,
	Schedulestt, 5
.tt5 6
AnyAsynctt6 >
(tt> ?
stt? @
=>ttA C
sttD E
.ttE F
IdttF H
==ttI K
updateMyClassDtottL \
.tt\ ]

ScheduleIdtt] g
)ttg h
;tth i
ifuu 

(uu 
!uu 
scheduleExistsuu 
)uu 
{vv 	
throwww 
newww 
ValidationExceptionww )
(ww) *
$"ww* ,
$strww, =
{ww= >
updateMyClassDtoww> N
.wwN O

ScheduleIdwwO Y
}wwY Z
$strwwZ i
"wwi j
)wwj k
;wwk l
}xx 	
awaitzz 
_contextzz 
.zz 
SaveChangesAsynczz '
(zz' (
)zz( )
;zz) *
if}} 

(}} 
updateMyClassDto}} 
.}} 
UserId}} #
!=}}$ &
myclass}}' .
.}}. /
UserId}}/ 5
)}}5 6
{~~ 	
await 
_context 
. 
Entry  
(  !
myclass! (
)( )
.) *
	Reference* 3
(3 4
p4 5
=>6 8
p9 :
.: ;
User; ?
)? @
.@ A
	LoadAsyncA J
(J K
)K L
;L M
}
ÄÄ 	
if
ÇÇ 

(
ÇÇ 
updateMyClassDto
ÇÇ 
.
ÇÇ 

ScheduleId
ÇÇ '
!=
ÇÇ( *
myclass
ÇÇ+ 2
.
ÇÇ2 3

ScheduleId
ÇÇ3 =
)
ÇÇ= >
{
ÉÉ 	
await
ÑÑ 
_context
ÑÑ 
.
ÑÑ 
Entry
ÑÑ  
(
ÑÑ  !
myclass
ÑÑ! (
)
ÑÑ( )
.
ÑÑ) *
	Reference
ÑÑ* 3
(
ÑÑ3 4
p
ÑÑ4 5
=>
ÑÑ6 8
p
ÑÑ9 :
.
ÑÑ: ;
Schedule
ÑÑ; C
)
ÑÑC D
.
ÑÑD E
	LoadAsync
ÑÑE N
(
ÑÑN O
)
ÑÑO P
;
ÑÑP Q
}
ÖÖ 	
_logger
áá 
.
áá 
LogInformation
áá 
(
áá 
$str
áá =
,
áá= >
id
áá? A
)
ááA B
;
ááB C
return
ââ 
_mapper
ââ 
.
ââ 
Map
ââ 
<
ââ 

MyClassDto
ââ %
>
ââ% &
(
ââ& '
myclass
ââ' .
)
ââ. /
;
ââ/ 0
}
ää 
public
çç 

async
çç 
Task
çç 
<
çç 
bool
çç 
>
çç  
DeleteMyClassAsync
çç .
(
çç. /
int
çç/ 2
id
çç3 5
)
çç5 6
{
éé 
var
èè 
myclass
èè 
=
èè 
await
èè 
_context
èè $
.
èè$ %
	MyClasses
èè% .
.
êê 
	FindAsync
êê 
(
êê 
id
êê 
)
êê 
;
êê 
if
ëë 

(
ëë 
myclass
ëë 
==
ëë 
null
ëë 
)
ëë 
{
íí 	
throw
ìì 
new
ìì 
NotFoundException
ìì '
(
ìì' (
$str
ìì( 4
,
ìì4 5
id
ìì6 8
)
ìì8 9
;
ìì9 :
}
îî 	
_context
ññ 
.
ññ 
	MyClasses
ññ 
.
ññ 
Remove
ññ !
(
ññ! "
myclass
ññ" )
)
ññ) *
;
ññ* +
await
óó 
_context
óó 
.
óó 
SaveChangesAsync
óó '
(
óó' (
)
óó( )
;
óó) *
_logger
ôô 
.
ôô 
LogInformation
ôô 
(
ôô 
$str
ôô =
,
ôô= >
id
ôô? A
)
ôôA B
;
ôôB C
return
õõ 
true
õõ 
;
õõ 
}
úú 
public
üü 

async
üü 
Task
üü 
<
üü 
bool
üü 
>
üü  
MyClassExistsAsync
üü .
(
üü. /
int
üü/ 2
id
üü3 5
)
üü5 6
{
†† 
return
°° 
await
°° 
_context
°° 
.
°° 
	MyClasses
°° '
.
°°' (
AnyAsync
°°( 0
(
°°0 1
c
°°1 2
=>
°°3 5
c
°°6 7
.
°°7 8
Id
°°8 :
==
°°; =
id
°°> @
)
°°@ A
;
°°A B
}
¢¢ 
}££ ˇ0
UD:\BootcampProject\default-project-main\src\04.Application\Services\InvoiceService.cs
	namespace		 	
MyApp		
 
.		 
WebAPI		 
.		 
Services		 
;		  
public 
class 
InvoiceService 
: 
IInvoiceService -
{ 
private 
readonly 
AppleMusicDbContext (
_context) 1
;1 2
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
ILogger 
< 
InvoiceService +
>+ ,
_logger- 4
;4 5
public 

InvoiceService 
( 
AppleMusicDbContext -
context. 5
,5 6
IMapper7 >
mapper? E
,E F
ILoggerG N
<N O
InvoiceServiceO ]
>] ^
logger_ e
)e f
{ 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
_logger 
= 
logger 
; 
} 
public 

async 
Task 
< 
IEnumerable !
<! "

InvoiceDto" ,
>, -
>- .'
GetAllInvoicesByUserIdAsync/ J
(J K
intK N
userIdO U
)U V
{   
var!! 
invoices!! 
=!! 
await!! 
_context!! %
.!!% &
Invoices!!& .
."" 
Where"" 
("" 
m"" 
=>"" 
m"" 
."" 
UserId""  
==""! #
userId""$ *
)""* +
.## 
Include## 
(## 
m## 
=>## 
m## 
.## 
InvoiceDetails## *
)##* +
.$$ 
ToListAsync$$ 
($$ 
)$$ 
;$$ 
return%% 
_mapper%% 
.%% 
Map%% 
<%% 
IEnumerable%% &
<%%& '

InvoiceDto%%' 1
>%%1 2
>%%2 3
(%%3 4
invoices%%4 <
)%%< =
;%%= >
}&& 
public** 

async** 
Task** 
<** 
IEnumerable** !
<**! "

InvoiceDto**" ,
>**, -
>**- .
GetAllInvoicesAsync**/ B
(**B C
)**C D
{++ 
var-- 
invoices-- 
=-- 
await-- 
_context-- %
.--% &
Invoices--& .
... 
Include.. 
(.. 
m.. 
=>.. 
m.. 
... 
User..  
)..  !
.// 
Include// 
(// 
m// 
=>// 
m// 
.// 
InvoiceDetails// *
)//* +
.00 
ToListAsync00 
(00 
)00 
;00 
return22 
_mapper22 
.22 
Map22 
<22 
IEnumerable22 &
<22& '

InvoiceDto22' 1
>221 2
>222 3
(223 4
invoices224 <
)22< =
;22= >
}33 
public77 

async77 
Task77 
<77 

InvoiceDto77  
>77  !
GetInvoiceByIdAsync77" 5
(775 6
int776 9
	invoiceId77: C
)77C D
{88 
var99 
invoice99 
=99 
await99 
_context99 $
.99$ %
Invoices99% -
.:: 
Include:: 
(:: 
m:: 
=>:: 
m:: 
.:: 
InvoiceDetails:: *
)::* +
.;; 
FirstOrDefaultAsync;;  
(;;  !
c;;! "
=>;;# %
c;;& '
.;;' (
Id;;( *
==;;+ -
	invoiceId;;. 7
);;7 8
;;;8 9
if<< 

(<< 
invoice<< 
==<< 
null<< 
)<< 
{== 	
throw>> 
new>> 
NotFoundException>> '
(>>' (
$str>>( 4
,>>4 5
	invoiceId>>6 ?
)>>? @
;>>@ A
}?? 	
return@@ 
_mapper@@ 
.@@ 
Map@@ 
<@@ 

InvoiceDto@@ %
>@@% &
(@@& '
invoice@@' .
)@@. /
;@@/ 0
}AA 
publicEE 

asyncEE 
TaskEE 
<EE 

InvoiceDtoEE  
>EE  !'
GetInvoiceByIdPersonalAsyncEE" =
(EE= >
intEE> A
userIdEEB H
,EEH I
intEEJ M
	invoiceIdEEN W
)EEW X
{FF 
varGG 
invoiceGG 
=GG 
awaitGG 
_contextGG $
.GG$ %
InvoicesGG% -
.HH 
IncludeHH 
(HH 
mHH 
=>HH 
mHH 
.HH 
InvoiceDetailsHH *
)HH* +
.II 
FirstOrDefaultAsyncII  
(II  !
cII! "
=>II# %
cII& '
.II' (
IdII( *
==II+ -
	invoiceIdII. 7
)II7 8
;II8 9
ifJJ 

(JJ 
invoiceJJ 
?JJ 
.JJ 
UserIdJJ 
!=JJ 
userIdJJ %
)JJ% &
{KK 	
throwLL 
newLL 
NotFoundExceptionLL '
(LL' (
$strLL( 4
,LL4 5
	invoiceIdLL6 ?
)LL? @
;LL@ A
}MM 	
ifNN 

(NN 
invoiceNN 
==NN 
nullNN 
)NN 
{OO 	
throwPP 
newPP 
NotFoundExceptionPP '
(PP' (
$strPP( 4
,PP4 5
	invoiceIdPP6 ?
)PP? @
;PP@ A
}QQ 	
returnRR 
_mapperRR 
.RR 
MapRR 
<RR 

InvoiceDtoRR %
>RR% &
(RR& '
invoiceRR' .
)RR. /
;RR/ 0
}SS 
}TT ¯&
[D:\BootcampProject\default-project-main\src\04.Application\Services\InvoiceDetailService.cs
	namespace		 	
MyApp		
 
.		 
WebAPI		 
.		 
Services		 
;		  
public 
class  
InvoiceDetailService !
:" #!
IInvoiceDetailService$ 9
{ 
private 
readonly 
AppleMusicDbContext (
_context) 1
;1 2
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
ILogger 
<  
InvoiceDetailService 1
>1 2
_logger3 :
;: ;
public 
 
InvoiceDetailService 
(  
AppleMusicDbContext  3
context4 ;
,; <
IMapper= D
mapperE K
,K L
ILoggerM T
<T U 
InvoiceDetailServiceU i
>i j
loggerk q
)q r
{ 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
_logger 
= 
logger 
; 
} 
public 

async 
Task 
< 
IEnumerable !
<! "
InvoiceDetailDto" 2
>2 3
>3 4-
!GetInvoiceDetailsByInvoiceIdAsync5 V
(V W
intW Z
	invoiceId[ d
)d e
{   
var!! 
invoice!! 
=!! 
await!! 
_context!! $
.!!$ %
Invoices!!% -
."" 
FirstOrDefaultAsync""  
(""  !
d""! "
=>""# %
d""& '
.""' (
Id""( *
==""+ -
	invoiceId"". 7
)""7 8
;""8 9
if## 

(## 
invoice## 
==## 
null## 
)## 
{$$ 	
throw%% 
new%% 
NotFoundException%% '
(%%' (
$str%%( 4
,%%4 5
	invoiceId%%6 ?
)%%? @
;%%@ A
}&& 	
var'' 
invoicesDetail'' 
='' 
await'' "
_context''# +
.''+ ,
InvoiceDetails'', :
.(( 
Where(( 
((( 
d(( 
=>(( 
d(( 
.(( 
	InvoiceId(( #
==(($ &
	invoiceId((' 0
)((0 1
.)) 
ToListAsync)) 
()) 
))) 
;)) 
return** 
_mapper** 
.** 
Map** 
<** 
IEnumerable** &
<**& '
InvoiceDetailDto**' 7
>**7 8
>**8 9
(**9 :
invoicesDetail**: H
)**H I
;**I J
}++ 
public// 

async// 
Task// 
<// 
IEnumerable// !
<//! "
InvoiceDetailDto//" 2
>//2 3
>//3 45
)GetInvoiceDetailsByInvoiceIdPersonalAsync//5 ^
(//^ _
int//_ b
userId//c i
,//i j
int//k n
	invoiceId//o x
)//x y
{00 
var11 
invoice11 
=11 
await11 
_context11 $
.11$ %
Invoices11% -
.22 
FirstOrDefaultAsync22  
(22  !
d22! "
=>22# %
d22& '
.22' (
Id22( *
==22+ -
	invoiceId22. 7
)227 8
;228 9
if33 

(33 
invoice33 
?33 
.33 
UserId33 
!=33 
userId33 %
)33% &
{44 	
throw55 
new55 
NotFoundException55 '
(55' (
$str55( 4
,554 5
	invoiceId556 ?
)55? @
;55@ A
}66 	
if77 

(77 
invoice77 
==77 
null77 
)77 
{88 	
throw99 
new99 
NotFoundException99 '
(99' (
$str99( 4
,994 5
	invoiceId996 ?
)99? @
;99@ A
}:: 	
var;; 
invoiceDetails;; 
=;; 
await;; "
_context;;# +
.;;+ ,
InvoiceDetails;;, :
.<< 
Where<< 
(<< 
d<< 
=><< 
d<< 
.<< 
	InvoiceId<< #
==<<$ &
	invoiceId<<' 0
)<<0 1
.== 
ToListAsync== 
(== 
)== 
;== 
return>> 
_mapper>> 
.>> 
Map>> 
<>> 
IEnumerable>> &
<>>& '
InvoiceDetailDto>>' 7
>>>7 8
>>>8 9
(>>9 :
invoiceDetails>>: H
)>>H I
;>>I J
}?? 
}@@ ˚
gD:\BootcampProject\default-project-main\src\04.Application\Services\Interface\IUserManagementService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
	interface "
IUserManagementService '
{ 
Task 
< 	
UserDto	 
> 
GetUserProfileAsync %
(% &
int& )
userId* 0
)0 1
;1 2
Task 
< 	
IEnumerable	 
< 
UserDto 
> 
> 
GetAllUsersAsync /
(/ 0
)0 1
;1 2
Task 
< 	
IEnumerable	 
< 
RoleDto 
> 
> 
GetAllRolesAsync /
(/ 0
)0 1
;1 2
Task		 
<		 	
bool			 
>		 
AddRoleToUserAsync		 !
(		! "
int		" %
userId		& ,
,		, -
string		. 4
roleName		5 =
)		= >
;		> ?
Task

 
<

 	
bool

	 
>

 #
RemoveRoleFromUserAsync

 &
(

& '
int

' *
userId

+ 1
,

1 2
string

3 9
roleName

: B
)

B C
;

C D
Task 
< 	
bool	 
>  
SetClaimForUserAsync #
(# $
int$ '
userId( .
,. /
string0 6
	claimType7 @
,@ A
stringB H

claimValueI S
)S T
;T U
Task 
< 	
bool	 
> $
RemoveClaimFromUserAsync '
(' (
int( +
userId, 2
,2 3
string4 :
	claimType; D
)D E
;E F
Task 
< 	
bool	 
> 
ActivateUserAsync  
(  !
int! $
userId% +
)+ ,
;, -
Task 
< 	
bool	 
> 
DeactivateUserAsync "
(" #
int# &
userId' -
)- .
;. /
} Ø

^D:\BootcampProject\default-project-main\src\04.Application\Services\Interface\ITokenService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public

 
	interface

 
ITokenService

 
{ 
Task 
< 	
string	 
> $
GenerateAccessTokenAsync )
() *
User* .
user/ 3
)3 4
;4 5
ClaimsPrincipal 
? (
GetPrincipalFromExpiredToken 1
(1 2
string2 8
token9 >
)> ?
;? @
Task 
< 	
bool	 
> 
IsTokenValidAsync  
(  !
string! '
token( -
)- .
;. /
Task 
< 	
string	 
> %
GenerateRefreshTokenAsync *
(* +
)+ ,
;, -
Task 
< 	
string	 
> /
#GenerateEmailConfirmationTokenAsync 4
(4 5
)5 6
;6 7
Task 
< 	
string	 
> +
GeneratePasswordResetTokenAsync 0
(0 1
)1 2
;2 3
} Ü
aD:\BootcampProject\default-project-main\src\04.Application\Services\Interface\IScheduleService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
	interface 
IScheduleService !
{ 
Task 
< 	
IEnumerable	 
< 
ScheduleDto  
>  !
>! "
GetAllScheduleAsync# 6
(6 7
)7 8
;8 9
Task 
< 	
ScheduleDto	 
>  
GetScheduleByIdAsync *
(* +
int+ .
id/ 1
)1 2
;2 3
Task 
< 	
ScheduleDto	 
> 
CreateScheduleAsync )
() *
CreateScheduleDto* ;
createScheduleDto< M
)M N
;N O
Task		 
<		 	
ScheduleDto			 
>		 
UpdateScheduleAsync		 )
(		) *
int		* -
id		. 0
,		0 1
UpdateScheduleDto		2 C
updateScheduleDto		D U
)		U V
;		V W
Task

 
<

 	
bool

	 
>

 
DeleteScheduleAsync

 "
(

" #
int

# &
id

' )
)

) *
;

* +
Task 
< 	
bool	 
> 
ScheduleExistsAsync "
(" #
int# &
id' )
)) *
;* +
} ˆ
`D:\BootcampProject\default-project-main\src\04.Application\Services\Interface\IPaymentService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
	interface 
IPaymentService  
{ 
Task 
< 	
IEnumerable	 
< 

PaymentDto 
>  
>  !
GetAllPaymentAsync" 4
(4 5
)5 6
;6 7
Task 
< 	

PaymentDto	 
> 
GetPaymentByIdAsync (
(( )
int) ,
id- /
)/ 0
;0 1
Task

 
<

 	

PaymentDto

	 
>

 
CreatePaymentAsync

 '
(

' (
CreatePaymentDto

( 8
createPaymentDto

9 I
)

I J
;

J K
Task 
< 	

PaymentDto	 
> 
UpdatePaymentAsync '
(' (
int( +
id, .
,. /
UpdatePaymentDto0 @
updatePaymentDtoA Q
)Q R
;R S
Task 
< 	
bool	 
> 
DeletePaymentAsync !
(! "
int" %
id& (
)( )
;) *
Task 
< 	
bool	 
> 
PaymentExistsAsync !
(! "
int" %
id& (
)( )
;) *
} ì
aD:\BootcampProject\default-project-main\src\04.Application\Services\Interface\IPasswordService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
	interface 
IPasswordService !
{ 
string 

HashPassword 
( 
string 
password '
)' (
;( )
bool 
VerifyPassword	 
( 
string 
password '
,' (
string) /
hashedPassword0 >
)> ?
;? @
bool 
IsPasswordStrong	 
( 
string  
password! )
)) *
;* +
} ¢
`D:\BootcampProject\default-project-main\src\04.Application\Services\Interface\IMyClassService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
	interface 
IMyClassService  
{ 
Task 
< 	
IEnumerable	 
< 

MyClassDto 
>  
>  !%
GetMyClassesByUserIdAsync" ;
(; <
int< ?
userId@ F
)F G
;G H
Task		 
<		 	

MyClassDto			 
>		 
GetMyClassByIdAsync		 (
(		( )
int		) ,
id		- /
)		/ 0
;		0 1
Task 
< 	

MyClassDto	 
> 
CreateMyClassAsync '
(' (
CreateMyClassDto( 8
createMyClassDto9 I
)I J
;J K
Task 
< 	

MyClassDto	 
> 
UpdateMyClassAsync '
(' (
int( +
id, .
,. /
UpdateMyClassDto0 @
updateMyClassDtoA Q
)Q R
;R S
Task 
< 	
bool	 
> 
DeleteMyClassAsync !
(! "
int" %
id& (
)( )
;) *
Task 
< 	
bool	 
> 
MyClassExistsAsync !
(! "
int" %
id& (
)( )
;) *
} ¿	
`D:\BootcampProject\default-project-main\src\04.Application\Services\Interface\IInvoiceService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
	interface 
IInvoiceService  
{		 
Task

 
<

 	
IEnumerable

	 
<

 

InvoiceDto

 
>

  
>

  !'
GetAllInvoicesByUserIdAsync

" =
(

= >
int

> A
userId

B H
)

H I
;

I J
Task 
< 	
IEnumerable	 
< 

InvoiceDto 
>  
>  !
GetAllInvoicesAsync" 5
(5 6
)6 7
;7 8
Task 
< 	

InvoiceDto	 
> 
GetInvoiceByIdAsync (
(( )
int) ,
	invoiceId- 6
)6 7
;7 8
Task 
< 	

InvoiceDto	 
> '
GetInvoiceByIdPersonalAsync 0
(0 1
int1 4
userId5 ;
,; <
int= @
	invoiceIdA J
)J K
;K L
} õ
fD:\BootcampProject\default-project-main\src\04.Application\Services\Interface\IInvoiceDetailService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
	interface !
IInvoiceDetailService &
{		 
Task

 
<

 	
IEnumerable

	 
<

 
InvoiceDetailDto

 %
>

% &
>

& '5
)GetInvoiceDetailsByInvoiceIdPersonalAsync

( Q
(

Q R
int

R U
userId

V \
,

\ ]
int

^ a
	invoiceId

b k
)

k l
;

l m
Task 
< 	
IEnumerable	 
< 
InvoiceDetailDto %
>% &
>& '-
!GetInvoiceDetailsByInvoiceIdAsync( I
(I J
intJ M
	invoiceIdN W
)W X
;X Y
} á
^D:\BootcampProject\default-project-main\src\04.Application\Services\Interface\IEmailService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
	interface 
IEmailService 
{ 
Task &
SendEmailConfirmationAsync	 #
(# $
string$ *
email+ 0
,0 1
string2 8
name9 =
,= >
string? E
confirmationLinkF V
)V W
;W X
Task "
SendPasswordResetAsync	 
(  
string  &
email' ,
,, -
string. 4
name5 9
,9 :
string; A
	resetLinkB K
)K L
;L M
Task 0
$SendPasswordChangedNotificationAsync	 -
(- .
string. 4
email5 :
,: ;
string< B
nameC G
)G H
;H I
} π
_D:\BootcampProject\default-project-main\src\04.Application\Services\Interface\ICourseService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
	interface 
ICourseService 
{		 
Task 
< 	
PaginatedResponse	 
< 
IEnumerable &
<& '
	CourseDto' 0
>0 1
>1 2
>2 3'
GetAllCoursesPaginatedAsync4 O
(O P!
CourseQueryParametersP e

parametersf p
)p q
;q r
Task 
< 	
	CourseDto	 
> 
GetCourseByIdAsync &
(& '
int' *
id+ -
)- .
;. /
Task 
< 	
	CourseDto	 
> 
CreateCourseAsync %
(% &
CreateCourseDto& 5
createCourseDto6 E
)E F
;F G
Task 
< 	
	CourseDto	 
> 
UpdateCourseAsync %
(% &
int& )
id* ,
,, -
UpdateCourseDto. =
updateCourseDto> M
)M N
;N O
Task!! 
<!! 	
bool!!	 
>!! 
DeleteCourseAsync!!  
(!!  !
int!!! $
id!!% '
)!!' (
;!!( )
}"" à
aD:\BootcampProject\default-project-main\src\04.Application\Services\Interface\ICategoryService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
	interface 
ICategoryService !
{		 
Task 
< 	
IEnumerable	 
< 
CategoryDto  
>  !
>! "!
GetAllCategoriesAsync# 8
(8 9
)9 :
;: ;
Task 
< 	
CategoryDto	 
>  
GetCategoryByIdAsync *
(* +
int+ .
id/ 1
)1 2
;2 3
Task 
< 	
CategoryDto	 
> 
CreateCategoryAsync )
() *
CreateCategoryDto* ;
createCategoryDto< M
)M N
;N O
Task 
< 	
CategoryDto	 
> 
UpdateCategoryAsync )
() *
int* -
id. 0
,0 1
UpdateCategoryDto2 C
updateCategoryDtoD U
)U V
;V W
Task!! 
<!! 	
bool!!	 
>!! 
DeleteCategoryAsync!! "
(!!" #
int!!# &
id!!' )
)!!) *
;!!* +
Task&& 
<&& 	
bool&&	 
>&& 
CategoryExistsAsync&& "
(&&" #
int&&# &
id&&' )
)&&) *
;&&* +
}'' ˇ
aD:\BootcampProject\default-project-main\src\04.Application\Services\Interface\ICartItemService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
	interface 
ICartItemService !
{ 
Task!! 
<!! 	
CheckoutResponseDto!!	 
>!! 
CheckoutItemsAsync!! 0
(!!0 1
int!!1 4
userId!!5 ;
,!!; <
CheckoutRequestDto!!= O
request!!P W
)!!W X
;!!X Y
Task"" 
<"" 	
IEnumerable""	 
<"" 
CartItemResponseDto"" (
>""( )
>"") * 
GetAllCartItemsAsync""+ ?
(""? @
)""@ A
;""A B
Task## 
<## 	
IEnumerable##	 
<## 
CartItemResponseDto## (
>##( )
>##) *%
GetCartItemsByUserIdAsync##+ D
(##D E
int##E H
userId##I O
)##O P
;##P Q
Task$$ 
<$$ 	
bool$$	 
>$$  
AddCourseToCartAsync$$ #
($$# $
int$$$ '
userId$$( .
,$$. /
int$$0 3

scheduleid$$4 >
)$$> ?
;$$? @
Task%% 
<%% 	
bool%%	 
>%% %
RemoveCourseFromCartAsync%% (
(%%( )
int%%) ,
userId%%- 3
,%%3 4
int%%5 8
cartid%%9 ?
)%%? @
;%%@ A
}&& ´
gD:\BootcampProject\default-project-main\src\04.Application\Services\Interface\IAuthenticationService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public		 
	interface		 "
IAuthenticationService		 '
{

 
Task 
< 	
bool	 
> 
RegisterAsync 
( 
RegisterRequestDto /
request0 7
)7 8
;8 9
Task 
< 	
AuthResponseDto	 
> 

LoginAsync $
($ %
LoginRequestDto% 4
request5 <
)< =
;= >
Task 
< 	
AuthResponseDto	 
> 
RefreshTokenAsync +
(+ ,"
RefreshTokenRequestDto, B
requestC J
)J K
;K L
Task 
< 	
bool	 
> 
LogoutAsync 
( 
int 
userId %
)% &
;& '
Task 
< 	
bool	 
> 
ChangePasswordAsync "
(" #
int# &
userId' -
,- .$
ChangePasswordRequestDto/ G
requestH O
)O P
;P Q
Task 
< 	
bool	 
> 
ForgotPasswordAsync "
(" #$
ForgotPasswordRequestDto# ;
request< C
)C D
;D E
Task 
< 	
bool	 
> 
ResetPasswordAsync !
(! "#
ResetPasswordRequestDto" 9
request: A
)A B
;B C
Task 
< 	
bool	 
> 
ConfirmEmailAsync  
(  !"
ConfirmEmailRequestDto! 7
request8 ?
)? @
;@ A
} ®K
SD:\BootcampProject\default-project-main\src\04.Application\Services\EmailService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
class 
EmailService 
: 
IEmailService )
{ 
private 
readonly 
ILogger 
< 
EmailService )
>) *
_logger+ 2
;2 3
private 
readonly 
IConfiguration #
_configuration$ 2
;2 3
private 
readonly 
string 
	_smtpHost %
;% &
private 
readonly 
int 
	_smtpPort "
;" #
private 
readonly 
string 
	_smtpUser %
;% &
private 
readonly 
string 
_smtpPassword )
;) *
private 
readonly 
string 

_fromEmail &
;& '
private 
readonly 
string 
	_fromName %
;% &
private 
readonly 
bool 

_enableSsl $
;$ %
public 

EmailService 
( 
ILogger 
<  
EmailService  ,
>, -
logger. 4
,4 5
IConfiguration6 D
configurationE R
)R S
{ 
_logger 
= 
logger 
; 
_configuration 
= 
configuration &
;& '
	_smtpHost 
= 
_configuration "
[" #
$str# ;
]; <
??= ?
$str@ P
;P Q
	_smtpPort 
= 
int 
. 
Parse 
( 
_configuration ,
[, -
$str- E
]E F
??G I
$strJ O
)O P
;P Q
	_smtpUser 
= 
_configuration "
[" #
$str# ;
]; <
??= ?
$str@ Y
;Y Z
_smtpPassword!! 
=!! 
_configuration!! &
[!!& '
$str!!' C
]!!C D
??!!E G
$str!!H ]
;!!] ^

_fromEmail"" 
="" 
_configuration"" #
[""# $
$str""$ =
]""= >
??""? A
	_smtpUser""B K
;""K L
	_fromName## 
=## 
_configuration## "
[##" #
$str### ;
]##; <
??##= ?
$str##@ T
;##T U

_enableSsl$$ 
=$$ 
bool$$ 
.$$ 
Parse$$ 
($$  
_configuration$$  .
[$$. /
$str$$/ H
]$$H I
??$$J L
$str$$M S
)$$S T
;$$T U
}%% 
private'' 
async'' 
Task'' 
SendEmailAsync'' %
(''% &
string''& ,
toEmail''- 4
,''4 5
string''6 <
toName''= C
,''C D
string''E K
subject''L S
,''S T
string''U [
htmlBody''\ d
)''d e
{(( 
try)) 
{** 	
if,, 
(,, 
string,, 
.,, 
IsNullOrEmpty,, $
(,,$ %
	_smtpUser,,% .
),,. /
||,,0 2
string,,3 9
.,,9 :
IsNullOrEmpty,,: G
(,,G H
_smtpPassword,,H U
),,U V
),,V W
{-- 
_logger.. 
... 

LogWarning.. "
(.." #
$str..# Y
,..Y Z
toEmail..[ b
)..b c
;..c d
_logger// 
.// 
LogInformation// &
(//& '
$str//' ;
,//; <
subject//= D
)//D E
;//E F
_logger00 
.00 
LogInformation00 &
(00& '
$str00' 5
,005 6
htmlBody007 ?
)00? @
;00@ A
return11 
;11 
}22 
var44 
message44 
=44 
new44 
MimeMessage44 )
(44) *
)44* +
;44+ ,
message55 
.55 
From55 
.55 
Add55 
(55 
new55  
MailboxAddress55! /
(55/ 0
	_fromName550 9
,559 :

_fromEmail55; E
)55E F
)55F G
;55G H
message66 
.66 
To66 
.66 
Add66 
(66 
new66 
MailboxAddress66 -
(66- .
toName66. 4
,664 5
toEmail666 =
)66= >
)66> ?
;66? @
message77 
.77 
Subject77 
=77 
subject77 %
;77% &
var99 
bodyBuilder99 
=99 
new99 !
BodyBuilder99" -
{:: 
HtmlBody;; 
=;; 
htmlBody;; #
}<< 
;<< 
message== 
.== 
Body== 
=== 
bodyBuilder== &
.==& '
ToMessageBody==' 4
(==4 5
)==5 6
;==6 7
using?? 
var?? 
client?? 
=?? 
new?? "

SmtpClient??# -
(??- .
)??. /
;??/ 0
awaitBB 
clientBB 
.BB 
ConnectAsyncBB %
(BB% &
	_smtpHostBB& /
,BB/ 0
	_smtpPortBB1 :
,BB: ;

_enableSslBB< F
?BBG H
SecureSocketOptionsBBI \
.BB\ ]
SslOnConnectBB] i
:BBj k
SecureSocketOptionsBBl 
.	BB Ä
None
BBÄ Ñ
)
BBÑ Ö
;
BBÖ Ü
awaitEE 
clientEE 
.EE 
AuthenticateAsyncEE *
(EE* +
	_smtpUserEE+ 4
,EE4 5
_smtpPasswordEE6 C
)EEC D
;EED E
awaitHH 
clientHH 
.HH 
	SendAsyncHH "
(HH" #
messageHH# *
)HH* +
;HH+ ,
awaitKK 
clientKK 
.KK 
DisconnectAsyncKK (
(KK( )
trueKK) -
)KK- .
;KK. /
_loggerMM 
.MM 
LogInformationMM "
(MM" #
$strMM# H
,MMH I
toEmailMMJ Q
)MMQ R
;MMR S
}NN 	
catchOO 
(OO 
	ExceptionOO 
exOO 
)OO 
{PP 	
_loggerQQ 
.QQ 
LogErrorQQ 
(QQ 
exQQ 
,QQ  
$strQQ! C
,QQC D
toEmailQQE L
)QQL M
;QQM N
throwRR 
;RR 
}SS 	
}TT 
publicVV 

asyncVV 
TaskVV &
SendEmailConfirmationAsyncVV 0
(VV0 1
stringVV1 7
emailVV8 =
,VV= >
stringVV? E
nameVVF J
,VVJ K
stringVVL R
confirmationLinkVVS c
)VVc d
{WW 
varXX 
subjectXX 
=XX 
$strXX 7
;XX7 8
varYY 
htmlBodyYY 
=YY 
$@"YY 
$strYa 7
{aa7 8
nameaa8 <
}aa< =
$strae= )
{ee) *
confirmationLinkee* :
}ee: ;
$strep; 
"pp 
;pp 
awaitrr 
SendEmailAsyncrr 
(rr 
emailrr "
,rr" #
namerr$ (
,rr( )
subjectrr* 1
,rr1 2
htmlBodyrr3 ;
)rr; <
;rr< =
}ss 
publicuu 

asyncuu 
Taskuu "
SendPasswordResetAsyncuu ,
(uu, -
stringuu- 3
emailuu4 9
,uu9 :
stringuu; A
nameuuB F
,uuF G
stringuuH N
	resetLinkuuO X
)uuX Y
{vv 
varww 
subjectww 
=ww 
$strww 8
;ww8 9
varxx 
htmlBodyxx 
=xx 
$@"xx 
$str	xÄ 7
{
ÄÄ7 8
name
ÄÄ8 <
}
ÄÄ< =
$str
ÄÑ= )
{
ÑÑ) *
	resetLink
ÑÑ* 3
}
ÑÑ3 4
$str
Ñê4 
"
êê 
;
êê 
await
íí 
SendEmailAsync
íí 
(
íí 
email
íí "
,
íí" #
name
íí$ (
,
íí( )
subject
íí* 1
,
íí1 2
htmlBody
íí3 ;
)
íí; <
;
íí< =
}
ìì 
public
ïï 

async
ïï 
Task
ïï 2
$SendPasswordChangedNotificationAsync
ïï :
(
ïï: ;
string
ïï; A
email
ïïB G
,
ïïG H
string
ïïI O
name
ïïP T
)
ïïT U
{
ññ 
var
óó 
subject
óó 
=
óó 
$str
óó B
;
óóB C
var
òò 
htmlBody
òò 
=
òò 
$@"
òò 
$str
ò† 7
{
††7 8
name
††8 <
}
††< =
$str
†Ø= 
"
ØØ 
;
ØØ 
await
∞∞ 
SendEmailAsync
∞∞ 
(
∞∞ 
email
∞∞ "
,
∞∞" #
name
∞∞$ (
,
∞∞( )
subject
∞∞* 1
,
∞∞1 2
htmlBody
∞∞3 ;
)
∞∞; <
;
∞∞< =
}
±± 
}≤≤ Úõ
TD:\BootcampProject\default-project-main\src\04.Application\Services\CourseService.cs
	namespace		 	
MyApp		
 
.		 
WebAPI		 
.		 
Services		 
;		  
public 
class 
CourseService 
: 
ICourseService +
{ 
private 
readonly 
AppleMusicDbContext (
_context) 1
;1 2
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
ILogger 
< 
CourseService *
>* +
_logger, 3
;3 4
public 

CourseService 
( 
AppleMusicDbContext ,
context- 4
,4 5
IMapper6 =
mapper> D
,D E
ILoggerF M
<M N
CourseServiceN [
>[ \
logger] c
)c d
{ 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
_logger   
=   
logger   
;   
}!! 
public)) 

async)) 
Task)) 
<)) 
PaginatedResponse)) '
<))' (
IEnumerable))( 3
<))3 4
	CourseDto))4 =
>))= >
>))> ?
>))? @'
GetAllCoursesPaginatedAsync))A \
())\ ]!
CourseQueryParameters))] r

parameters))s }
)))} ~
{** 
var-- 
query-- 
=-- 
_context-- 
.-- 
Courses-- $
... 
Include.. 
(.. 
p.. 
=>.. 
p.. 
... 
Category.. $
)..$ %
.// 
Include// 
(// 
p// 
=>// 
p// 
.// 
	Schedules// %
)//% &
.00 
AsQueryable00 
(00 
)00 
;00 
if55 

(55 
!55 
string55 
.55 
IsNullOrEmpty55 !
(55! "

parameters55" ,
.55, -
Search55- 3
)553 4
)554 5
{66 	
query88 
=88 
query88 
.88 
Where88 
(88  
p88  !
=>88" $
p88% &
.88& '
Name88' +
.88+ ,
Contains88, 4
(884 5

parameters885 ?
.88? @
Search88@ F
)88F G
||88H J
p99# $
.99$ %
Description99% 0
.990 1
Contains991 9
(999 :

parameters99: D
.99D E
Search99E K
)99K L
)99L M
;99M N
}:: 	
if== 

(== 

parameters== 
.== 

CategoryId== !
.==! "
HasValue==" *
)==* +
{>> 	
query@@ 
=@@ 
query@@ 
.@@ 
Where@@ 
(@@  
p@@  !
=>@@" $
p@@% &
.@@& '

CategoryId@@' 1
==@@2 4

parameters@@5 ?
.@@? @

CategoryId@@@ J
.@@J K
Value@@K P
)@@P Q
;@@Q R
}AA 	
ifDD 

(DD 

parametersDD 
.DD 
MinPriceDD 
.DD  
HasValueDD  (
)DD( )
{EE 	
queryGG 
=GG 
queryGG 
.GG 
WhereGG 
(GG  
pGG  !
=>GG" $
pGG% &
.GG& '
PriceGG' ,
>=GG- /

parametersGG0 :
.GG: ;
MinPriceGG; C
.GGC D
ValueGGD I
)GGI J
;GGJ K
}HH 	
ifKK 

(KK 

parametersKK 
.KK 
MaxPriceKK 
.KK  
HasValueKK  (
)KK( )
{LL 	
queryNN 
=NN 
queryNN 
.NN 
WhereNN 
(NN  
pNN  !
=>NN" $
pNN% &
.NN& '
PriceNN' ,
<=NN- /

parametersNN0 :
.NN: ;
MaxPriceNN; C
.NNC D
ValueNND I
)NNI J
;NNJ K
}OO 	
queryUU 
=UU 

parametersUU 
.UU 
SortByUU !
.UU! "
ToLowerUU" )
(UU) *
)UU* +
switchUU, 2
{VV 	
$strXX 
=>XX 

parametersXX !
.XX! "
SortDirectionXX" /
.XX/ 0
ToLowerXX0 7
(XX7 8
)XX8 9
==XX: <
$strXX= C
?YY 
queryYY 
.YY 
OrderByDescendingYY )
(YY) *
pYY* +
=>YY, .
pYY/ 0
.YY0 1
PriceYY1 6
)YY6 7
:ZZ 
queryZZ 
.ZZ 
OrderByZZ 
(ZZ  
pZZ  !
=>ZZ" $
pZZ% &
.ZZ& '
PriceZZ' ,
)ZZ, -
,ZZ- .
$str]] 
=>]] 

parameters]] %
.]]% &
SortDirection]]& 3
.]]3 4
ToLower]]4 ;
(]]; <
)]]< =
==]]> @
$str]]A G
?^^ 
query^^ 
.^^ 
OrderByDescending^^ )
(^^) *
p^^* +
=>^^, .
p^^/ 0
.^^0 1
	CreatedAt^^1 :
)^^: ;
:__ 
query__ 
.__ 
OrderBy__ 
(__  
p__  !
=>__" $
p__% &
.__& '
	CreatedAt__' 0
)__0 1
,__1 2
_bb 
=>bb 

parametersbb 
.bb 
SortDirectionbb )
.bb) *
ToLowerbb* 1
(bb1 2
)bb2 3
==bb4 6
$strbb7 =
?cc 
querycc 
.cc 
OrderByDescendingcc )
(cc) *
pcc* +
=>cc, .
pcc/ 0
.cc0 1
Namecc1 5
)cc5 6
:dd 
querydd 
.dd 
OrderBydd 
(dd  
pdd  !
=>dd" $
pdd% &
.dd& '
Namedd' +
)dd+ ,
}ee 	
;ee	 

varjj 
totalRecordsjj 
=jj 
awaitjj  
queryjj! &
.jj& '

CountAsyncjj' 1
(jj1 2
)jj2 3
;jj3 4
varmm 
coursemm 
=mm 
awaitmm 
querymm  
.nn 
Skipnn 
(nn 
(nn 

parametersnn 
.nn 

PageNumbernn (
-nn) *
$numnn+ ,
)nn, -
*nn. /

parametersnn0 :
.nn: ;
PageSizenn; C
)nnC D
.oo 
Takeoo 
(oo 

parametersoo 
.oo 
PageSizeoo %
)oo% &
.pp 
ToListAsyncpp 
(pp 
)pp 
;pp 
varvv 

courseDtosvv 
=vv 
_mappervv  
.vv  !
Mapvv! $
<vv$ %
IEnumerablevv% 0
<vv0 1
	CourseDtovv1 :
>vv: ;
>vv; <
(vv< =
coursevv= C
)vvC D
;vvD E
return{{ 
PaginatedResponse{{  
<{{  !
IEnumerable{{! ,
<{{, -
	CourseDto{{- 6
>{{6 7
>{{7 8
.{{8 9
Create{{9 ?
({{? @

courseDtos|| 
,|| 

parameters}} 
.}} 

PageNumber}} !
,}}! "

parameters~~ 
.~~ 
PageSize~~ 
,~~  
totalRecords 
) 
; 
}
ÄÄ 
public
ÖÖ 

async
ÖÖ 
Task
ÖÖ 
<
ÖÖ 
	CourseDto
ÖÖ 
>
ÖÖ   
GetCourseByIdAsync
ÖÖ! 3
(
ÖÖ3 4
int
ÖÖ4 7
id
ÖÖ8 :
)
ÖÖ: ;
{
ÜÜ 
var
áá 
course
áá 
=
áá 
await
áá 
_context
áá #
.
áá# $
Courses
áá$ +
.
àà 
Include
àà 
(
àà 
p
àà 
=>
àà 
p
àà 
.
àà 
Category
àà $
)
àà$ %
.
ââ 
Include
ââ 
(
ââ 
p
ââ 
=>
ââ 
p
ââ 
.
ââ 
	Schedules
ââ %
)
ââ% &
.
ää !
FirstOrDefaultAsync
ää  
(
ää  !
p
ää! "
=>
ää# %
p
ää& '
.
ää' (
Id
ää( *
==
ää+ -
id
ää. 0
)
ää0 1
;
ää1 2
if
ãã 

(
ãã 
course
ãã 
==
ãã 
null
ãã 
)
ãã 
{
åå 	
throw
çç 
new
çç 
NotFoundException
çç '
(
çç' (
$str
çç( 3
,
çç3 4
id
çç5 7
)
çç7 8
;
çç8 9
}
éé 	
return
èè 
_mapper
èè 
.
èè 
Map
èè 
<
èè 
	CourseDto
èè $
>
èè$ %
(
èè% &
course
èè& ,
)
èè, -
;
èè- .
}
êê 
public
ïï 

async
ïï 
Task
ïï 
<
ïï 
	CourseDto
ïï 
>
ïï  
CreateCourseAsync
ïï! 2
(
ïï2 3
CreateCourseDto
ïï3 B
createCourseDto
ïïC R
)
ïïR S
{
ññ 
var
òò 
categoryExists
òò 
=
òò 
await
òò "
_context
òò# +
.
òò+ ,

Categories
òò, 6
.
òò6 7
AnyAsync
òò7 ?
(
òò? @
c
òò@ A
=>
òòB D
c
òòE F
.
òòF G
Id
òòG I
==
òòJ L
createCourseDto
òòM \
.
òò\ ]

CategoryId
òò] g
)
òòg h
;
òòh i
if
ôô 

(
ôô 
!
ôô 
categoryExists
ôô 
)
ôô 
{
öö 	
throw
õõ 
new
õõ !
ValidationException
õõ )
(
õõ) *
$"
õõ* ,
$str
õõ, =
{
õõ= >
createCourseDto
õõ> M
.
õõM N

CategoryId
õõN X
}
õõX Y
$str
õõY h
"
õõh i
)
õõi j
;
õõj k
}
úú 	
var
ûû 
course
ûû 
=
ûû 
_mapper
ûû 
.
ûû 
Map
ûû  
<
ûû  !
Course
ûû! '
>
ûû' (
(
ûû( )
createCourseDto
ûû) 8
)
ûû8 9
;
ûû9 :
if
°° 

(
°° 
!
°° 
string
°° 
.
°°  
IsNullOrWhiteSpace
°° &
(
°°& '
createCourseDto
°°' 6
.
°°6 7
ImageUrl
°°7 ?
)
°°? @
&&
°°A C
createCourseDto
¢¢ 
.
¢¢ 
ImageUrl
¢¢ $
.
¢¢$ %

StartsWith
¢¢% /
(
¢¢/ 0
$str
¢¢0 <
)
¢¢< =
)
¢¢= >
{
££ 	
var
•• 

base64Data
•• 
=
•• 
createCourseDto
•• ,
.
••, -
ImageUrl
••- 5
.
••5 6
	Substring
••6 ?
(
••? @
createCourseDto
••@ O
.
••O P
ImageUrl
••P X
.
••X Y
IndexOf
••Y `
(
••` a
$str
••a d
)
••d e
+
••f g
$num
••h i
)
••i j
;
••j k
var
¶¶ 
bytes
¶¶ 
=
¶¶ 
Convert
¶¶ 
.
¶¶  
FromBase64String
¶¶  0
(
¶¶0 1

base64Data
¶¶1 ;
)
¶¶; <
;
¶¶< =
var
®® 
uploadsFolder
®® 
=
®® 
Path
®®  $
.
®®$ %
Combine
®®% ,
(
®®, -
	Directory
®®- 6
.
®®6 7!
GetCurrentDirectory
®®7 J
(
®®J K
)
®®K L
,
®®L M
$str
®®N W
,
®®W X
$str
®®Y ^
)
®®^ _
;
®®_ `
if
©© 
(
©© 
!
©© 
	Directory
©© 
.
©© 
Exists
©© !
(
©©! "
uploadsFolder
©©" /
)
©©/ 0
)
©©0 1
	Directory
™™ 
.
™™ 
CreateDirectory
™™ )
(
™™) *
uploadsFolder
™™* 7
)
™™7 8
;
™™8 9
var
¨¨ 
fileName
¨¨ 
=
¨¨ 
$"
¨¨ 
{
¨¨ 
Guid
¨¨ "
.
¨¨" #
NewGuid
¨¨# *
(
¨¨* +
)
¨¨+ ,
}
¨¨, -
$str
¨¨- 1
"
¨¨1 2
;
¨¨2 3
var
≠≠ 
filePath
≠≠ 
=
≠≠ 
Path
≠≠ 
.
≠≠  
Combine
≠≠  '
(
≠≠' (
uploadsFolder
≠≠( 5
,
≠≠5 6
fileName
≠≠7 ?
)
≠≠? @
;
≠≠@ A
await
ÆÆ 
File
ÆÆ 
.
ÆÆ  
WriteAllBytesAsync
ÆÆ )
(
ÆÆ) *
filePath
ÆÆ* 2
,
ÆÆ2 3
bytes
ÆÆ4 9
)
ÆÆ9 :
;
ÆÆ: ;
course
±± 
.
±± 
ImageUrl
±± 
=
±± 
$"
±±  
$str
±±  %
{
±±% &
fileName
±±& .
}
±±. /
"
±±/ 0
;
±±0 1
}
≤≤ 	
_context
¥¥ 
.
¥¥ 
Courses
¥¥ 
.
¥¥ 
Add
¥¥ 
(
¥¥ 
course
¥¥ #
)
¥¥# $
;
¥¥$ %
await
µµ 
_context
µµ 
.
µµ 
SaveChangesAsync
µµ '
(
µµ' (
)
µµ( )
;
µµ) *
await
∏∏ 
_context
∏∏ 
.
∏∏ 
Entry
∏∏ 
(
∏∏ 
course
∏∏ #
)
∏∏# $
.
∏∏$ %
	Reference
∏∏% .
(
∏∏. /
p
∏∏/ 0
=>
∏∏1 3
p
∏∏4 5
.
∏∏5 6
Category
∏∏6 >
)
∏∏> ?
.
∏∏? @
	LoadAsync
∏∏@ I
(
∏∏I J
)
∏∏J K
;
∏∏K L
_logger
∫∫ 
.
∫∫ 
LogInformation
∫∫ 
(
∫∫ 
$str
∫∫ Q
,
∫∫Q R
course
ªª 
.
ªª 
Name
ªª 
,
ªª 
course
ªª 
.
ªª  
Id
ªª  "
)
ªª" #
;
ªª# $
return
ΩΩ 
_mapper
ΩΩ 
.
ΩΩ 
Map
ΩΩ 
<
ΩΩ 
	CourseDto
ΩΩ $
>
ΩΩ$ %
(
ΩΩ% &
course
ΩΩ& ,
)
ΩΩ, -
;
ΩΩ- .
}
ææ 
public
√√ 

async
√√ 
Task
√√ 
<
√√ 
	CourseDto
√√ 
>
√√  
UpdateCourseAsync
√√! 2
(
√√2 3
int
√√3 6
id
√√7 9
,
√√9 :
UpdateCourseDto
√√; J
updateCourseDto
√√K Z
)
√√Z [
{
ƒƒ 
var
≈≈ 
course
≈≈ 
=
≈≈ 
await
≈≈ 
_context
≈≈ #
.
≈≈# $
Courses
≈≈$ +
.
∆∆ 
Include
∆∆ 
(
∆∆ 
p
∆∆ 
=>
∆∆ 
p
∆∆ 
.
∆∆ 
Category
∆∆ $
)
∆∆$ %
.
«« !
FirstOrDefaultAsync
««  
(
««  !
p
««! "
=>
««# %
p
««& '
.
««' (
Id
««( *
==
««+ -
id
««. 0
)
««0 1
;
««1 2
if
»» 

(
»» 
course
»» 
==
»» 
null
»» 
)
»» 
{
…… 	
throw
   
new
   
NotFoundException
   '
(
  ' (
$str
  ( 3
,
  3 4
id
  5 7
)
  7 8
;
  8 9
}
ÀÀ 	
if
ŒŒ 

(
ŒŒ 
updateCourseDto
ŒŒ 
.
ŒŒ 

CategoryId
ŒŒ &
!=
ŒŒ' )
course
ŒŒ* 0
.
ŒŒ0 1

CategoryId
ŒŒ1 ;
)
ŒŒ; <
{
œœ 	
var
–– 
categoryExists
–– 
=
––  
await
––! &
_context
––' /
.
––/ 0

Categories
––0 :
.
––: ;
AnyAsync
––; C
(
––C D
c
––D E
=>
––F H
c
––I J
.
––J K
Id
––K M
==
––N P
updateCourseDto
––Q `
.
––` a

CategoryId
––a k
)
––k l
;
––l m
if
—— 
(
—— 
!
—— 
categoryExists
—— 
)
——  
{
““ 
throw
”” 
new
”” !
ValidationException
”” -
(
””- .
$"
””. 0
$str
””0 A
{
””A B
updateCourseDto
””B Q
.
””Q R

CategoryId
””R \
}
””\ ]
$str
””] l
"
””l m
)
””m n
;
””n o
}
‘‘ 
}
’’ 	
_mapper
◊◊ 
.
◊◊ 
Map
◊◊ 
(
◊◊ 
updateCourseDto
◊◊ #
,
◊◊# $
course
◊◊% +
)
◊◊+ ,
;
◊◊, -
course
ÿÿ 
.
ÿÿ 
	UpdatedAt
ÿÿ 
=
ÿÿ 
DateTime
ÿÿ #
.
ÿÿ# $
UtcNow
ÿÿ$ *
;
ÿÿ* +
await
⁄⁄ 
_context
⁄⁄ 
.
⁄⁄ 
SaveChangesAsync
⁄⁄ '
(
⁄⁄' (
)
⁄⁄( )
;
⁄⁄) *
if
›› 

(
›› 
updateCourseDto
›› 
.
›› 

CategoryId
›› &
!=
››' )
course
››* 0
.
››0 1

CategoryId
››1 ;
)
››; <
{
ﬁﬁ 	
await
ﬂﬂ 
_context
ﬂﬂ 
.
ﬂﬂ 
Entry
ﬂﬂ  
(
ﬂﬂ  !
course
ﬂﬂ! '
)
ﬂﬂ' (
.
ﬂﬂ( )
	Reference
ﬂﬂ) 2
(
ﬂﬂ2 3
p
ﬂﬂ3 4
=>
ﬂﬂ5 7
p
ﬂﬂ8 9
.
ﬂﬂ9 :
Category
ﬂﬂ: B
)
ﬂﬂB C
.
ﬂﬂC D
	LoadAsync
ﬂﬂD M
(
ﬂﬂM N
)
ﬂﬂN O
;
ﬂﬂO P
}
‡‡ 	
_logger
‚‚ 
.
‚‚ 
LogInformation
‚‚ 
(
‚‚ 
$str
‚‚ ;
,
‚‚; <
id
‚‚= ?
)
‚‚? @
;
‚‚@ A
return
‰‰ 
_mapper
‰‰ 
.
‰‰ 
Map
‰‰ 
<
‰‰ 
	CourseDto
‰‰ $
>
‰‰$ %
(
‰‰% &
course
‰‰& ,
)
‰‰, -
;
‰‰- .
}
ÂÂ 
public
ÍÍ 

async
ÍÍ 
Task
ÍÍ 
<
ÍÍ 
bool
ÍÍ 
>
ÍÍ 
DeleteCourseAsync
ÍÍ -
(
ÍÍ- .
int
ÍÍ. 1
id
ÍÍ2 4
)
ÍÍ4 5
{
ÎÎ 
var
ÏÏ 
course
ÏÏ 
=
ÏÏ 
await
ÏÏ 
_context
ÏÏ #
.
ÏÏ# $
Courses
ÏÏ$ +
.
ÌÌ 
	FindAsync
ÌÌ 
(
ÌÌ 
id
ÌÌ 
)
ÌÌ 
;
ÌÌ 
if
ÓÓ 

(
ÓÓ 
course
ÓÓ 
==
ÓÓ 
null
ÓÓ 
)
ÓÓ 
{
ÔÔ 	
throw
 
new
 
NotFoundException
 '
(
' (
$str
( 3
,
3 4
id
5 7
)
7 8
;
8 9
}
ÒÒ 	
_context
ÛÛ 
.
ÛÛ 
Courses
ÛÛ 
.
ÛÛ 
Remove
ÛÛ 
(
ÛÛ  
course
ÛÛ  &
)
ÛÛ& '
;
ÛÛ' (
await
ÙÙ 
_context
ÙÙ 
.
ÙÙ 
SaveChangesAsync
ÙÙ '
(
ÙÙ' (
)
ÙÙ( )
;
ÙÙ) *
_logger
ˆˆ 
.
ˆˆ 
LogInformation
ˆˆ 
(
ˆˆ 
$str
ˆˆ ;
,
ˆˆ; <
id
ˆˆ= ?
)
ˆˆ? @
;
ˆˆ@ A
return
¯¯ 
true
¯¯ 
;
¯¯ 
}
˘˘ 
}˙˙ ˝W
VD:\BootcampProject\default-project-main\src\04.Application\Services\CategoryService.cs
	namespace		 	
MyApp		
 
.		 
WebAPI		 
.		 
Services		 
;		  
public 
class 
CategoryService 
: 
ICategoryService /
{ 
private 
readonly 
AppleMusicDbContext (
_context) 1
;1 2
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
ILogger 
< 
CategoryService ,
>, -
_logger. 5
;5 6
public 

CategoryService 
( 
AppleMusicDbContext .
context/ 6
,6 7
IMapper8 ?
mapper@ F
,F G
ILoggerH O
<O P
CategoryServiceP _
>_ `
loggera g
)g h
{ 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
_logger 
= 
logger 
; 
} 
public!! 

async!! 
Task!! 
<!! 
IEnumerable!! !
<!!! "
CategoryDto!!" -
>!!- .
>!!. /!
GetAllCategoriesAsync!!0 E
(!!E F
)!!F G
{"" 
var## 

categories## 
=## 
await## 
_context## '
.##' (

Categories##( 2
.$$ 
Include$$ 
($$ 
c$$ 
=>$$ 
c$$ 
.$$ 
Courses$$ #
)$$# $
.%% 
ToListAsync%% 
(%% 
)%% 
;%% 
return'' 
_mapper'' 
.'' 
Map'' 
<'' 
IEnumerable'' &
<''& '
CategoryDto''' 2
>''2 3
>''3 4
(''4 5

categories''5 ?
)''? @
;''@ A
}(( 
public-- 

async-- 
Task-- 
<-- 
CategoryDto-- !
>--! " 
GetCategoryByIdAsync--# 7
(--7 8
int--8 ;
id--< >
)--> ?
{.. 
var// 
category// 
=// 
await// 
_context// %
.//% &

Categories//& 0
.00 
Include00 
(00 
c00 
=>00 
c00 
.00 
Courses00 #
)00# $
.11 
FirstOrDefaultAsync11  
(11  !
c11! "
=>11# %
c11& '
.11' (
Id11( *
==11+ -
id11. 0
)110 1
;111 2
if22 

(22 
category22 
==22 
null22 
)22 
{33 	
throw44 
new44 
NotFoundException44 '
(44' (
$str44( 5
,445 6
id447 9
)449 :
;44: ;
}55 	
return66 
_mapper66 
.66 
Map66 
<66 
CategoryDto66 &
>66& '
(66' (
category66( 0
)660 1
;661 2
}77 
public<< 

async<< 
Task<< 
<<< 
CategoryDto<< !
><<! "
CreateCategoryAsync<<# 6
(<<6 7
CreateCategoryDto<<7 H
createCategoryDto<<I Z
)<<Z [
{== 
var>> 
category>> 
=>> 
_mapper>> 
.>> 
Map>> "
<>>" #
Category>># +
>>>+ ,
(>>, -
createCategoryDto>>- >
)>>> ?
;>>? @
ifAA 

(AA 
!AA 
stringAA 
.AA 
IsNullOrWhiteSpaceAA &
(AA& '
createCategoryDtoAA' 8
.AA8 9
ImageUrlAA9 A
)AAA B
&&AAC E
createCategoryDtoBB 
.BB 
ImageUrlBB &
.BB& '

StartsWithBB' 1
(BB1 2
$strBB2 >
)BB> ?
)BB? @
{CC 	
varEE 

base64DataEE 
=EE 
createCategoryDtoEE .
.EE. /
ImageUrlEE/ 7
.EE7 8
	SubstringEE8 A
(EEA B
createCategoryDtoEEB S
.EES T
ImageUrlEET \
.EE\ ]
IndexOfEE] d
(EEd e
$strEEe h
)EEh i
+EEj k
$numEEl m
)EEm n
;EEn o
varFF 
bytesFF 
=FF 
ConvertFF 
.FF  
FromBase64StringFF  0
(FF0 1

base64DataFF1 ;
)FF; <
;FF< =
varHH 
uploadsFolderHH 
=HH 
PathHH  $
.HH$ %
CombineHH% ,
(HH, -
	DirectoryHH- 6
.HH6 7
GetCurrentDirectoryHH7 J
(HHJ K
)HHK L
,HHL M
$strHHN W
,HHW X
$strHHY ^
)HH^ _
;HH_ `
ifII 
(II 
!II 
	DirectoryII 
.II 
ExistsII !
(II! "
uploadsFolderII" /
)II/ 0
)II0 1
	DirectoryJJ 
.JJ 
CreateDirectoryJJ )
(JJ) *
uploadsFolderJJ* 7
)JJ7 8
;JJ8 9
varLL 
fileNameLL 
=LL 
$"LL 
{LL 
GuidLL "
.LL" #
NewGuidLL# *
(LL* +
)LL+ ,
}LL, -
$strLL- 1
"LL1 2
;LL2 3
varMM 
filePathMM 
=MM 
PathMM 
.MM  
CombineMM  '
(MM' (
uploadsFolderMM( 5
,MM5 6
fileNameMM7 ?
)MM? @
;MM@ A
awaitNN 
FileNN 
.NN 
WriteAllBytesAsyncNN )
(NN) *
filePathNN* 2
,NN2 3
bytesNN4 9
)NN9 :
;NN: ;
categoryQQ 
.QQ 
ImageUrlQQ 
=QQ 
$"QQ  "
$strQQ" '
{QQ' (
fileNameQQ( 0
}QQ0 1
"QQ1 2
;QQ2 3
}RR 	
_contextTT 
.TT 

CategoriesTT 
.TT 
AddTT 
(TT  
categoryTT  (
)TT( )
;TT) *
awaitUU 
_contextUU 
.UU 
SaveChangesAsyncUU '
(UU' (
)UU( )
;UU) *
_loggerWW 
.WW 
LogInformationWW 
(WW 
$strWW W
,WWW X
categoryXX 
.XX 
NameXX 
,XX 
categoryXX #
.XX# $
IdXX$ &
)XX& '
;XX' (
returnZZ 
_mapperZZ 
.ZZ 
MapZZ 
<ZZ 
CategoryDtoZZ &
>ZZ& '
(ZZ' (
categoryZZ( 0
)ZZ0 1
;ZZ1 2
}[[ 
public`` 

async`` 
Task`` 
<`` 
CategoryDto`` !
>``! "
UpdateCategoryAsync``# 6
(``6 7
int``7 :
id``; =
,``= >
UpdateCategoryDto``? P
updateCategoryDto``Q b
)``b c
{aa 
varbb 
categorybb 
=bb 
awaitbb 
_contextbb %
.bb% &

Categoriesbb& 0
.cc 
	FindAsynccc 
(cc 
idcc 
)cc 
;cc 
ifdd 

(dd 
categorydd 
==dd 
nulldd 
)dd 
{ee 	
throwff 
newff 
NotFoundExceptionff '
(ff' (
$strff( 5
,ff5 6
idff7 9
)ff9 :
;ff: ;
}gg 	
_mapperii 
.ii 
Mapii 
(ii 
updateCategoryDtoii %
,ii% &
categoryii' /
)ii/ 0
;ii0 1
categoryjj 
.jj 
	UpdatedAtjj 
=jj 
DateTimejj %
.jj% &
UtcNowjj& ,
;jj, -
awaitll 
_contextll 
.ll 
SaveChangesAsyncll '
(ll' (
)ll( )
;ll) *
_loggernn 
.nn 
LogInformationnn 
(nn 
$strnn ?
,nn? @
idnnA C
)nnC D
;nnD E
returnpp 
_mapperpp 
.pp 
Mappp 
<pp 
CategoryDtopp &
>pp& '
(pp' (
categorypp( 0
)pp0 1
;pp1 2
}qq 
publicvv 

asyncvv 
Taskvv 
<vv 
boolvv 
>vv 
DeleteCategoryAsyncvv /
(vv/ 0
intvv0 3
idvv4 6
)vv6 7
{ww 
varxx 
categoryxx 
=xx 
awaitxx 
_contextxx %
.xx% &

Categoriesxx& 0
.yy 
	FindAsyncyy 
(yy 
idyy 
)yy 
;yy 
ifzz 

(zz 
categoryzz 
==zz 
nullzz 
)zz 
{{{ 	
throw|| 
new|| 
NotFoundException|| '
(||' (
$str||( 5
,||5 6
id||7 9
)||9 :
;||: ;
}}} 	
var
ÄÄ 
hasProducts
ÄÄ 
=
ÄÄ 
await
ÄÄ 
_context
ÄÄ  (
.
ÄÄ( )
Courses
ÄÄ) 0
.
ÄÄ0 1
AnyAsync
ÄÄ1 9
(
ÄÄ9 :
p
ÄÄ: ;
=>
ÄÄ< >
p
ÄÄ? @
.
ÄÄ@ A

CategoryId
ÄÄA K
==
ÄÄL N
id
ÄÄO Q
)
ÄÄQ R
;
ÄÄR S
if
ÅÅ 

(
ÅÅ 
hasProducts
ÅÅ 
)
ÅÅ 
{
ÇÇ 	
throw
ÉÉ 
new
ÉÉ !
ValidationException
ÉÉ )
(
ÉÉ) *
$str
ÉÉ* T
)
ÉÉT U
;
ÉÉU V
}
ÑÑ 	
_context
ÜÜ 
.
ÜÜ 

Categories
ÜÜ 
.
ÜÜ 
Remove
ÜÜ "
(
ÜÜ" #
category
ÜÜ# +
)
ÜÜ+ ,
;
ÜÜ, -
await
áá 
_context
áá 
.
áá 
SaveChangesAsync
áá '
(
áá' (
)
áá( )
;
áá) *
_logger
ââ 
.
ââ 
LogInformation
ââ 
(
ââ 
$str
ââ ?
,
ââ? @
id
ââA C
)
ââC D
;
ââD E
return
ãã 
true
ãã 
;
ãã 
}
åå 
public
ëë 

async
ëë 
Task
ëë 
<
ëë 
bool
ëë 
>
ëë !
CategoryExistsAsync
ëë /
(
ëë/ 0
int
ëë0 3
id
ëë4 6
)
ëë6 7
{
íí 
return
ìì 
await
ìì 
_context
ìì 
.
ìì 

Categories
ìì (
.
ìì( )
AnyAsync
ìì) 1
(
ìì1 2
c
ìì2 3
=>
ìì4 6
c
ìì7 8
.
ìì8 9
Id
ìì9 ;
==
ìì< >
id
ìì? A
)
ììA B
;
ììB C
}
îî 
}ïï ”£
VD:\BootcampProject\default-project-main\src\04.Application\Services\CartItemService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
class 
CartItemService 
: 
ICartItemService /
{ 
private 
readonly 
AppleMusicDbContext (
_context) 1
;1 2
private 
readonly 
IMapper 
_mapper $
;$ %
private   
readonly   
ILogger   
<   
CartItemService   ,
>  , -
_logger  . 5
;  5 6
public$$ 

CartItemService$$ 
($$ 
AppleMusicDbContext%% 
context%% #
,%%# $
IMapper&& 
mapper&& 
,&& 
ILogger'' 
<'' 
CartItemService'' 
>''  
logger''! '
)''' (
{(( 
_context)) 
=)) 
context)) 
;)) 
_mapper** 
=** 
mapper** 
;** 
_logger++ 
=++ 
logger++ 
;++ 
},, 
public?? 

async?? 
Task?? 
<?? 
CheckoutResponseDto?? )
>??) *
CheckoutItemsAsync??+ =
(??= >
int??> A
userId??B H
,??H I
CheckoutRequestDto??J \
request??] d
)??d e
{@@ 
_loggerAA 
.AA 
LogInformationAA 
(AA 
$strBB A
,BBA B
requestCC 
.CC 
ItemCartIdsCC 
.CC  
CountCC  %
,CC% &
userIdDD 
)DD 
;DD 
ifGG 

(GG 
requestGG 
.GG 
ItemCartIdsGG 
.GG  
CountGG  %
==GG& (
$numGG) *
)GG* +
{HH 	
throwII 
newII 
ValidationExceptionII )
(II) *
$strII* M
)IIM N
;IIN O
}JJ 	
varMM 
strategyMM 
=MM 
_contextMM 
.MM  
DatabaseMM  (
.MM( )#
CreateExecutionStrategyMM) @
(MM@ A
)MMA B
;MMB C
returnNN 
awaitNN 
strategyNN 
.NN 
ExecuteAsyncNN *
(NN* +
asyncNN+ 0
(NN1 2
)NN2 3
=>NN4 6
{OO 	
usingQQ 
varQQ 
transactionQQ !
=QQ" #
awaitQQ$ )
_contextQQ* 2
.QQ2 3
DatabaseQQ3 ;
.QQ; <!
BeginTransactionAsyncQQ< Q
(QQQ R
)QQR S
;QQS T
trySS 
{TT 
varVV 
userVV 
=VV 
awaitVV  
_contextVV! )
.VV) *
UsersVV* /
.WW 
FirstOrDefaultAsyncWW (
(WW( )
aWW) *
=>WW+ -
aWW. /
.WW/ 0
IdWW0 2
==WW3 5
userIdWW6 <
)WW< =
;WW= >
ifXX 
(XX 
userXX 
==XX 
nullXX  
)XX  !
{YY 
throwZZ 
newZZ 
ValidationExceptionZZ 1
(ZZ1 2
$"ZZ2 4
$strZZ4 C
{ZZC D
userIdZZD J
}ZZJ K
$strZZK L
"ZZL M
)ZZM N
;ZZN O
}[[ 
if]] 
(]] 
!]] 
user]] 
.]] 
EmailConfirmed]] (
)]]( )
{^^ 
throw__ 
new__ 
PermissionException__ 1
(__1 2
$"__2 4
$str__4 ;
{__; <
user__< @
.__@ A
Id__A C
}__C D
$str__D O
"__O P
)__P Q
;__Q R
}`` 
Listbb 
<bb 
CartItembb 
>bb 
itemsbb $
=bb% &
newbb' *
Listbb+ /
<bb/ 0
CartItembb0 8
>bb8 9
(bb9 :
)bb: ;
;bb; <
foreachdd 
(dd 
vardd 

itemcartiddd '
indd( *
requestdd+ 2
.dd2 3
ItemCartIdsdd3 >
)dd> ?
{ee 
varff 
itemff 
=ff 
awaitff $
_contextff% -
.ff- .
	CartItemsff. 7
.gg 
Includegg  
(gg  !
igg! "
=>gg# %
igg& '
.gg' (
Schedulegg( 0
)gg0 1
.hh 
ThenIncludehh (
(hh( )
shh) *
=>hh+ -
shh. /
.hh/ 0
Coursehh0 6
)hh6 7
.ii  !
ThenIncludeii! ,
(ii, -
sii- .
=>ii/ 1
sii2 3
.ii3 4
Categoryii4 <
)ii< =
.jj 
FirstOrDefaultAsyncjj ,
(jj, -
ajj- .
=>jj/ 1
ajj2 3
.jj3 4
UserIdjj4 :
==jj; =
userjj> B
.jjB C
IdjjC E
&&jjF H
ajjI J
.jjJ K
IdjjK M
==jjN P

itemcartidjjQ [
)jj[ \
;jj\ ]
ifkk 
(kk 
itemkk 
==kk 
nullkk  $
)kk$ %
{ll 
throwmm 
newmm !
ValidationExceptionmm" 5
(mm5 6
$"mm6 8
$strmm8 ?
{mm? @

itemcartidmm@ J
}mmJ K
$strmmK U
"mmU V
)mmV W
;mmW X
}nn 
itemsoo 
.oo 
Addoo 
(oo 
itemoo "
)oo" #
;oo# $
}pp 
varrr 
paymentmethodrr !
=rr" #
awaitrr$ )
_contextrr* 2
.rr2 3
PaymentMethodsrr3 A
.ss 
FirstOrDefaultAsyncss (
(ss( )
ass) *
=>ss+ -
ass. /
.ss/ 0
Idss0 2
==ss3 5
requestss6 =
.ss= >
PaymentMethodIdss> M
)ssM N
;ssN O
iftt 
(tt 
paymentmethodtt !
==tt" $
nulltt% )
)tt) *
{uu 
throwvv 
newvv 
ValidationExceptionvv 1
(vv1 2
$"vv2 4
$strvv4 D
{vvD E
requestvvE L
.vvL M
PaymentMethodIdvvM \
}vv\ ]
$strvv] g
"vvg h
)vvh i
;vvi j
}ww 
foreachyy 
(yy 
varyy 
itemyy !
inyy" $
itemsyy% *
)yy* +
{zz 
_context{{ 
.{{ 
	CartItems{{ &
.{{& '
Remove{{' -
({{- .
item{{. 2
){{2 3
;{{3 4
}|| 
var 
invoice 
= 
new !
Invoice" )
{
ÄÄ 
RefCode
ÅÅ 
=
ÅÅ 
GenerateInvoiceId
ÅÅ /
(
ÅÅ/ 0
)
ÅÅ0 1
,
ÅÅ1 2
	CreatedAt
ÇÇ 
=
ÇÇ 
DateTime
ÇÇ  (
.
ÇÇ( )
UtcNow
ÇÇ) /
,
ÇÇ/ 0
UserId
ÉÉ 
=
ÉÉ 
user
ÉÉ !
.
ÉÉ! "
Id
ÉÉ" $
,
ÉÉ$ %
PaymentMethodId
ÑÑ #
=
ÑÑ$ %
paymentmethod
ÑÑ& 3
.
ÑÑ3 4
Id
ÑÑ4 6
}
ÖÖ 
;
ÖÖ 
_context
ÜÜ 
.
ÜÜ 
Invoices
ÜÜ !
.
ÜÜ! "
Add
ÜÜ" %
(
ÜÜ% &
invoice
ÜÜ& -
)
ÜÜ- .
;
ÜÜ. /
await
áá 
_context
áá 
.
áá 
SaveChangesAsync
áá /
(
áá/ 0
)
áá0 1
;
áá1 2
foreach
àà 
(
àà 
CartItem
àà !
item
àà" &
in
àà' )
items
àà* /
)
àà/ 0
{
ââ 
_context
ää 
.
ää 
InvoiceDetails
ää +
.
ää+ ,
Add
ää, /
(
ää/ 0
new
ää0 3
InvoiceDetail
ää4 A
{
ãã 
	InvoiceId
åå !
=
åå" #
invoice
åå$ +
.
åå+ ,
Id
åå, .
,
åå. /

CourseName
çç "
=
çç# $
item
çç% )
.
çç) *
Schedule
çç* 2
.
çç2 3
Course
çç3 9
.
çç9 :
Name
çç: >
,
çç> ?
CategoryName
éé $
=
éé% &
item
éé' +
.
éé+ ,
Schedule
éé, 4
.
éé4 5
Course
éé5 ;
.
éé; <
Category
éé< D
.
ééD E
Name
ééE I
,
ééI J
Price
èè 
=
èè 
item
èè  $
.
èè$ %
Schedule
èè% -
.
èè- .
Course
èè. 4
.
èè4 5
Price
èè5 :
,
èè: ;
ScheduleDate
êê $
=
êê% &
item
êê' +
.
êê+ ,
Schedule
êê, 4
.
êê4 5
Date
êê5 9
}
ëë 
)
ëë 
;
ëë 
}
íí 
foreach
îî 
(
îî 
CartItem
îî !
item
îî" &
in
îî' )
items
îî* /
)
îî/ 0
{
ïï 
_context
ññ 
.
ññ 
	MyClasses
ññ &
.
ññ& '
Add
ññ' *
(
ññ* +
new
ññ+ .
MyClass
ññ/ 6
{
óó 
UserId
òò 
=
òò  
user
òò! %
.
òò% &
Id
òò& (
,
òò( )

ScheduleId
ôô "
=
ôô# $
item
ôô% )
.
ôô) *

ScheduleId
ôô* 4
}
öö 
)
öö 
;
öö 
}
õõ 
await
ûû 
_context
ûû 
.
ûû 
SaveChangesAsync
ûû /
(
ûû/ 0
)
ûû0 1
;
ûû1 2
await
üü 
transaction
üü !
.
üü! "
CommitAsync
üü" -
(
üü- .
)
üü. /
;
üü/ 0
_logger
°° 
.
°° 
LogInformation
°° &
(
°°& '
$str
¢¢ B
,
¢¢B C
invoice
££ 
.
££ 
Id
££ 
)
££ 
;
££  
return
¶¶ 
new
¶¶ !
CheckoutResponseDto
¶¶ .
{
ßß 
	InvoiceId
®® 
=
®® 
invoice
®®  '
.
®®' (
Id
®®( *
,
®®* +
	CreatedAt
©© 
=
©© 
DateTime
©©  (
.
©©( )
UtcNow
©©) /
}
™™ 
;
™™ 
}
´´ 
catch
¨¨ 
(
¨¨ 
	Exception
¨¨ 
)
¨¨ 
{
≠≠ 
await
∞∞ 
transaction
∞∞ !
.
∞∞! "
RollbackAsync
∞∞" /
(
∞∞/ 0
)
∞∞0 1
;
∞∞1 2
_logger
±± 
.
±± 
LogError
±±  
(
±±  !
$str
±±! O
)
±±O P
;
±±P Q
throw
≤≤ 
;
≤≤ 
}
≥≥ 
}
¥¥ 	
)
¥¥	 

;
¥¥
 
}
µµ 
[
ππ 
Obsolete
ππ 
]
ππ 
public
∫∫ 

async
∫∫ 
Task
∫∫ 
<
∫∫ 
IEnumerable
∫∫ !
<
∫∫! "!
CartItemResponseDto
∫∫" 5
>
∫∫5 6
>
∫∫6 7"
GetAllCartItemsAsync
∫∫8 L
(
∫∫L M
)
∫∫M N
{
ªª 
var
ºº 

categories
ºº 
=
ºº 
await
ºº 
_context
ºº '
.
ºº' (
	CartItems
ºº( 1
.
ΩΩ 
Include
ΩΩ 
(
ΩΩ 
c
ΩΩ 
=>
ΩΩ 
c
ΩΩ 
.
ΩΩ 
Schedule
ΩΩ $
)
ΩΩ$ %
.
ææ 
ThenInclude
ææ 
(
ææ 
s
ææ 
=>
ææ !
s
ææ" #
.
ææ# $
Course
ææ$ *
)
ææ* +
.
øø 
ToListAsync
øø 
(
øø 
)
øø 
;
øø 
return
¡¡ 
_mapper
¡¡ 
.
¡¡ 
Map
¡¡ 
<
¡¡ 
IEnumerable
¡¡ &
<
¡¡& '!
CartItemResponseDto
¡¡' :
>
¡¡: ;
>
¡¡; <
(
¡¡< =

categories
¡¡= G
)
¡¡G H
;
¡¡H I
}
¬¬ 
public
»» 

async
»» 
Task
»» 
<
»» 
IEnumerable
»» !
<
»»! "!
CartItemResponseDto
»»" 5
>
»»5 6
>
»»6 7'
GetCartItemsByUserIdAsync
»»8 Q
(
»»Q R
int
»»R U
userId
»»V \
)
»»\ ]
{
…… 
var
   

categories
   
=
   
await
   
_context
   '
.
  ' (
	CartItems
  ( 1
.
ÀÀ 
Where
ÀÀ 
(
ÀÀ 
c
ÀÀ 
=>
ÀÀ 
c
ÀÀ 
.
ÀÀ 
UserId
ÀÀ  
==
ÀÀ! #
userId
ÀÀ$ *
)
ÀÀ* +
.
ÃÃ 
Include
ÃÃ 
(
ÃÃ 
c
ÃÃ 
=>
ÃÃ 
c
ÃÃ 
.
ÃÃ 
Schedule
ÃÃ $
)
ÃÃ$ %
.
ÕÕ 
ThenInclude
ÕÕ 
(
ÕÕ 
s
ÕÕ 
=>
ÕÕ !
s
ÕÕ" #
.
ÕÕ# $
Course
ÕÕ$ *
)
ÕÕ* +
.
ŒŒ 
ThenInclude
ŒŒ 
(
ŒŒ 
c
ŒŒ 
=>
ŒŒ !
c
ŒŒ" #
.
ŒŒ# $
Category
ŒŒ$ ,
)
ŒŒ, -
.
œœ 
Include
œœ 
(
œœ 
c
œœ 
=>
œœ 
c
œœ 
.
œœ 
User
œœ  
)
œœ  !
.
–– 
ToListAsync
–– 
(
–– 
)
–– 
;
–– 
return
““ 
_mapper
““ 
.
““ 
Map
““ 
<
““ 
IEnumerable
““ &
<
““& '!
CartItemResponseDto
““' :
>
““: ;
>
““; <
(
““< =

categories
““= G
)
““G H
;
““H I
}
”” 
public
·· 

async
·· 
Task
·· 
<
·· 
bool
·· 
>
·· "
AddCourseToCartAsync
·· 0
(
··0 1
int
··1 4
userId
··5 ;
,
··; <
int
··= @

scheduleid
··A K
)
··K L
{
‚‚ 
var
‰‰ 
user
‰‰ 
=
‰‰ 
await
‰‰ 
_context
‰‰ !
.
‰‰! "
Users
‰‰" '
.
ÂÂ !
FirstOrDefaultAsync
ÂÂ  
(
ÂÂ  !
a
ÂÂ! "
=>
ÂÂ# %
a
ÂÂ& '
.
ÂÂ' (
Id
ÂÂ( *
==
ÂÂ+ -
userId
ÂÂ. 4
)
ÂÂ4 5
;
ÂÂ5 6
if
ÊÊ 

(
ÊÊ 
user
ÊÊ 
==
ÊÊ 
null
ÊÊ 
)
ÊÊ 
{
ÁÁ 	
throw
ËË 
new
ËË !
ValidationException
ËË )
(
ËË) *
$"
ËË* ,
$str
ËË, ;
{
ËË; <
userId
ËË< B
}
ËËB C
$str
ËËC D
"
ËËD E
)
ËËE F
;
ËËF G
}
ÈÈ 	
if
ÎÎ 

(
ÎÎ 
!
ÎÎ 
user
ÎÎ 
.
ÎÎ 
EmailConfirmed
ÎÎ  
)
ÎÎ  !
{
ÏÏ 	
throw
ÌÌ 
new
ÌÌ &
AccountInactiveException
ÌÌ .
(
ÌÌ. /
$str
ÌÌ/ M
)
ÌÌM N
;
ÌÌN O
}
ÓÓ 	
if
ÔÔ 

(
ÔÔ 
!
ÔÔ 
user
ÔÔ 
.
ÔÔ 
IsActive
ÔÔ 
)
ÔÔ 
{
 	
throw
ÒÒ 
new
ÒÒ &
AccountInactiveException
ÒÒ .
(
ÒÒ. /
$str
ÒÒ/ i
)
ÒÒi j
;
ÒÒj k
}
ÚÚ 	
var
ÙÙ 
schedule
ÙÙ 
=
ÙÙ 
await
ÙÙ 
_context
ÙÙ %
.
ÙÙ% &
	Schedules
ÙÙ& /
.
ıı !
FirstOrDefaultAsync
ıı  
(
ıı  !
a
ıı! "
=>
ıı# %
a
ıı& '
.
ıı' (
Id
ıı( *
==
ıı+ -

scheduleid
ıı. 8
)
ıı8 9
;
ıı9 :
if
ˆˆ 

(
ˆˆ 
schedule
ˆˆ 
==
ˆˆ 
null
ˆˆ 
)
ˆˆ 
{
˜˜ 	
throw
¯¯ 
new
¯¯ !
ValidationException
¯¯ )
(
¯¯) *
$"
¯¯* ,
$str
¯¯, 7
{
¯¯7 8

scheduleid
¯¯8 B
}
¯¯B C
$str
¯¯C M
"
¯¯M N
)
¯¯N O
;
¯¯O P
}
˘˘ 	
_context
˚˚ 
.
˚˚ 
	CartItems
˚˚ 
.
˚˚ 
Add
˚˚ 
(
˚˚ 
new
˚˚ "
CartItem
˚˚# +
{
¸¸ 	
UserId
˝˝ 
=
˝˝ 
user
˝˝ 
.
˝˝ 
Id
˝˝ 
,
˝˝ 

ScheduleId
˛˛ 
=
˛˛ 
schedule
˛˛ !
.
˛˛! "
Id
˛˛" $
}
ˇˇ 	
)
ˇˇ	 

;
ˇˇ
 
await
ÇÇ 
_context
ÇÇ 
.
ÇÇ 
SaveChangesAsync
ÇÇ '
(
ÇÇ' (
)
ÇÇ( )
;
ÇÇ) *
return
ÉÉ 
true
ÉÉ 
;
ÉÉ 
}
ÑÑ 
public
íí 

async
íí 
Task
íí 
<
íí 
bool
íí 
>
íí '
RemoveCourseFromCartAsync
íí 5
(
íí5 6
int
íí6 9
userId
íí: @
,
íí@ A
int
ííB E

cartItemId
ííF P
)
ííP Q
{
ìì 
var
ïï 
user
ïï 
=
ïï 
await
ïï 
_context
ïï !
.
ïï! "
Users
ïï" '
.
ññ !
FirstOrDefaultAsync
ññ  
(
ññ  !
a
ññ! "
=>
ññ# %
a
ññ& '
.
ññ' (
Id
ññ( *
==
ññ+ -
userId
ññ. 4
)
ññ4 5
;
ññ5 6
if
óó 

(
óó 
user
óó 
==
óó 
null
óó 
)
óó 
{
òò 	
throw
ôô 
new
ôô !
ValidationException
ôô )
(
ôô) *
$"
ôô* ,
$str
ôô, ;
{
ôô; <
userId
ôô< B
}
ôôB C
$str
ôôC D
"
ôôD E
)
ôôE F
;
ôôF G
}
öö 	
if
úú 

(
úú 
!
úú 
user
úú 
.
úú 
EmailConfirmed
úú  
)
úú  !
{
ùù 	
throw
ûû 
new
ûû &
AccountInactiveException
ûû .
(
ûû. /
$str
ûû/ M
)
ûûM N
;
ûûN O
}
üü 	
if
†† 

(
†† 
!
†† 
user
†† 
.
†† 
IsActive
†† 
)
†† 
{
°° 	
throw
¢¢ 
new
¢¢ &
AccountInactiveException
¢¢ .
(
¢¢. /
$str
¢¢/ i
)
¢¢i j
;
¢¢j k
}
££ 	
var
•• 
cartitem
•• 
=
•• 
await
•• 
_context
•• %
.
••% &
	CartItems
••& /
.
¶¶ !
FirstOrDefaultAsync
¶¶  
(
¶¶  !
a
¶¶! "
=>
¶¶# %
a
¶¶& '
.
¶¶' (
Id
¶¶( *
==
¶¶+ -

cartItemId
¶¶. 8
&&
¶¶9 ;
a
¶¶< =
.
¶¶= >
UserId
¶¶> D
==
¶¶E G
userId
¶¶H N
)
¶¶N O
;
¶¶O P
if
ßß 

(
ßß 
cartitem
ßß 
==
ßß 
null
ßß 
)
ßß 
{
®® 	
throw
©© 
new
©© !
ValidationException
©© )
(
©©) *
$"
©©* ,
$str
©©, 7
{
©©7 8

cartItemId
©©8 B
}
©©B C
$str
©©C M
"
©©M N
)
©©N O
;
©©O P
}
™™ 	
_context
¨¨ 
.
¨¨ 
	CartItems
¨¨ 
.
¨¨ 
Remove
¨¨ !
(
¨¨! "
cartitem
¨¨" *
)
¨¨* +
;
¨¨+ ,
await
ØØ 
_context
ØØ 
.
ØØ 
SaveChangesAsync
ØØ '
(
ØØ' (
)
ØØ( )
;
ØØ) *
return
∞∞ 
true
∞∞ 
;
∞∞ 
}
±± 
private
∑∑ 
string
∑∑ 
GenerateInvoiceId
∑∑ $
(
∑∑$ %
)
∑∑% &
{
∏∏ 
return
ππ 
$"
ππ 
$str
ππ 
{
ππ 
DateTime
ππ 
.
ππ 
UtcNow
ππ $
:
ππ$ %
$str
ππ% 1
}
ππ1 2
{
ππ2 3
Random
ππ3 9
.
ππ9 :
Shared
ππ: @
.
ππ@ A
Next
ππA E
(
ππE F
$num
ππF G
,
ππG H
$num
ππI O
)
ππO P
:
ππP Q
$str
ππQ S
}
ππS T
"
ππT U
;
ππU V
}
∫∫ 
}ºº Æ≥
\D:\BootcampProject\default-project-main\src\04.Application\Services\AuthenticationService.cs
	namespace 	
MyApp
 
. 
WebAPI 
. 
Services 
;  
public 
class !
AuthenticationService "
:# $"
IAuthenticationService% ;
{   
private!! 
readonly!! 
AppleMusicDbContext!! (
_context!!) 1
;!!1 2
private"" 
readonly"" 
ITokenService"" "
_tokenService""# 0
;""0 1
private## 
readonly## 
JwtSettings##  
_jwtSettings##! -
;##- .
private$$ 
readonly$$ 
ILogger$$ 
<$$ !
AuthenticationService$$ 2
>$$2 3
_logger$$4 ;
;$$; <
private%% 
readonly%% 
IEmailService%% "
_emailService%%# 0
;%%0 1
private&& 
readonly&& 
IPasswordService&& %
_passwordService&&& 6
;&&6 7
private(( 
const(( 
int(( 
MAX_FAILED_ATTEMPTS(( )
=((* +
$num((, -
;((- .
private)) 
const)) 
int))  
LOCKOUT_TIME_MINUTES)) *
=))+ ,
$num))- /
;))/ 0
public++ 
!
AuthenticationService++  
(++  !
AppleMusicDbContext,, 
context,, #
,,,# $
ITokenService-- 
tokenService-- "
,--" #
JwtSettings.. 
jwtSettings.. 
,..  
ILogger// 
<// !
AuthenticationService// %
>//% &
logger//' -
,//- .
IEmailService00 
emailService00 "
,00" #
IPasswordService11 
passwordService11 (
)22 
{44 
_context55 
=55 
context55 
;55 
_tokenService66 
=66 
tokenService66 $
;66$ %
_jwtSettings77 
=77 
jwtSettings77 "
;77" #
_logger88 
=88 
logger88 
;88 
_emailService99 
=99 
emailService99 $
;99$ %
_passwordService:: 
=:: 
passwordService:: *
;::* +
};; 
publicAA 

asyncAA 
TaskAA 
<AA 
boolAA 
>AA 
RegisterAsyncAA )
(AA) *
RegisterRequestDtoAA* <
requestAA= D
)AAD E
{BB 
varEE 
existingUserEE 
=EE 
awaitEE  
_contextEE! )
.EE) *
UsersEE* /
.FF 
FirstOrDefaultAsyncFF  
(FF  !
aFF! "
=>FF# %
aFF& '
.FF' (
EmailFF( -
==FF. 0
requestFF1 8
.FF8 9
EmailFF9 >
)FF> ?
;FF? @
ifGG 

(GG 
existingUserGG 
!=GG 
nullGG  
)GG  !
{HH 	
throwII 
newII 
ValidationExceptionII )
(II) *
$strII* O
)IIO P
;IIP Q
}JJ 	
_loggerLL 
.LL 
LogInformationLL 
(LL 
$strLL M
,LLM N
requestLLO V
.LLV W
EmailLLW \
)LL\ ]
;LL] ^
varMM 
strategyMM 
=MM 
_contextMM 
.MM  
DatabaseMM  (
.MM( )#
CreateExecutionStrategyMM) @
(MM@ A
)MMA B
;MMB C
returnNN 
awaitNN 
strategyNN 
.NN 
ExecuteAsyncNN *
(NN* +
asyncNN+ 0
(NN1 2
)NN2 3
=>NN4 6
{OO 	
usingPP 
varPP 
transactionPP !
=PP" #
awaitPP$ )
_contextPP* 2
.PP2 3
DatabasePP3 ;
.PP; <!
BeginTransactionAsyncPP< Q
(PPQ R
)PPR S
;PPS T
tryRR 
{SS 
varUU 
confirmationTokenUU %
=UU& '
awaitUU( -
_tokenServiceUU. ;
.UU; </
#GenerateEmailConfirmationTokenAsyncUU< _
(UU_ `
)UU` a
;UUa b
varXX 
userXX 
=XX 
newXX 
UserXX #
{YY 
IsActiveZZ 
=ZZ 
trueZZ #
,ZZ# $
Name[[ 
=[[ 
request[[ "
.[[" #
Name[[# '
,[[' (
Email\\ 
=\\ 
request\\ #
.\\# $
Email\\$ )
,\\) *
PasswordHash]]  
=]]! "
_passwordService]]# 3
.]]3 4
HashPassword]]4 @
(]]@ A
request]]A H
.]]H I
NewPassword]]I T
)]]T U
,]]U V
EmailConfirmed^^ "
=^^# $
false^^% *
,^^* +"
EmailConfirmationToken__ *
=__+ ,
confirmationToken__- >
,__> ?(
EmailConfirmationTokenExpiry`` 0
=``1 2
DateTime``3 ;
.``; <
UtcNow``< B
.``B C
AddHours``C K
(``K L
$num``L N
)``N O
,``O P
	CreatedAtaa 
=aa 
DateTimeaa  (
.aa( )
UtcNowaa) /
,aa/ 0
	CreatedBybb 
=bb 
$strbb  (
}cc 
;cc 
awaitee 
_contextee 
.ee 
Usersee $
.ee$ %
AddAsyncee% -
(ee- .
useree. 2
)ee2 3
;ee3 4
awaitff 
_contextff 
.ff 
SaveChangesAsyncff /
(ff/ 0
)ff0 1
;ff1 2
varjj 
userRolejj 
=jj 
newjj "
UserRolejj# +
{kk 
UserIdll 
=ll 
userll !
.ll! "
Idll" $
,ll$ %
RoleIdmm 
=mm 
$nummm 
,mm 
	CreatedAtnn 
=nn 
DateTimenn  (
.nn( )
UtcNownn) /
,nn/ 0
	CreatedByoo 
=oo 
$stroo  (
}pp 
;pp 
await}} 
_context}} 
.}} 
	UserRoles}} (
.}}( )
AddAsync}}) 1
(}}1 2
userRole}}2 :
)}}: ;
;}}; <
await 
_context 
. 
SaveChangesAsync /
(/ 0
)0 1
;1 2
var
ÇÇ 
confirmationLink
ÇÇ $
=
ÇÇ% &
$"
ÇÇ' )
$str
ÇÇ) T
{
ÇÇT U
Uri
ÇÇU X
.
ÇÇX Y
EscapeDataString
ÇÇY i
(
ÇÇi j
user
ÇÇj n
.
ÇÇn o
Email
ÇÇo t
)
ÇÇt u
}
ÇÇu v
$str
ÇÇv }
{
ÇÇ} ~
UriÇÇ~ Å
.ÇÇÅ Ç 
EscapeDataStringÇÇÇ í
(ÇÇí ì!
confirmationTokenÇÇì §
)ÇÇ§ •
}ÇÇ• ¶
"ÇÇ¶ ß
;ÇÇß ®
await
ÉÉ 
_emailService
ÉÉ #
.
ÉÉ# $(
SendEmailConfirmationAsync
ÉÉ$ >
(
ÉÉ> ?
user
ÉÉ? C
.
ÉÉC D
Email
ÉÉD I
,
ÉÉI J
user
ÉÉK O
.
ÉÉO P
Name
ÉÉP T
,
ÉÉT U
confirmationLink
ÉÉV f
)
ÉÉf g
;
ÉÉg h
_logger
ÖÖ 
.
ÖÖ 
LogInformation
ÖÖ &
(
ÖÖ& '
$str
ÖÖ' X
,
ÖÖX Y
request
ÖÖZ a
.
ÖÖa b
Email
ÖÖb g
)
ÖÖg h
;
ÖÖh i
await
ââ 
_context
ââ 
.
ââ 
SaveChangesAsync
ââ /
(
ââ/ 0
)
ââ0 1
;
ââ1 2
await
ää 
transaction
ää !
.
ää! "
CommitAsync
ää" -
(
ää- .
)
ää. /
;
ää/ 0
return
åå 
true
åå 
;
åå 
}
çç 
catch
éé 
(
éé 
	Exception
éé 
)
éé 
{
èè 
await
íí 
transaction
íí !
.
íí! "
RollbackAsync
íí" /
(
íí/ 0
)
íí0 1
;
íí1 2
_logger
ìì 
.
ìì 
LogError
ìì  
(
ìì  !
$str
ìì! h
,
ììh i
request
ììj q
.
ììq r
Email
ììr w
)
ììw x
;
ììx y
throw
îî 
;
îî 
}
ïï 
}
ññ 	
)
ññ	 

;
ññ
 
}
óó 
public
úú 

async
úú 
Task
úú 
<
úú 
AuthResponseDto
úú %
>
úú% &

LoginAsync
úú' 1
(
úú1 2
LoginRequestDto
úú2 A
request
úúB I
)
úúI J
{
ùù 
_logger
ûû 
.
ûû 
LogInformation
ûû 
(
ûû 
$str
ûû A
,
ûûA B
request
ûûC J
.
ûûJ K
Email
ûûK P
)
ûûP Q
;
ûûQ R
var
¢¢ 
user
¢¢ 
=
¢¢ 
await
¢¢ 
_context
¢¢ !
.
¢¢! "
Users
¢¢" '
.
££ !
FirstOrDefaultAsync
££  
(
££  !
a
££! "
=>
££# %
a
££& '
.
££' (
Email
££( -
==
££. 0
request
££1 8
.
££8 9
Email
££9 >
)
££> ?
;
££? @
if
§§ 

(
§§ 
user
§§ 
==
§§ 
null
§§ 
)
§§ 
{
•• 	
_logger
¶¶ 
.
¶¶ 

LogWarning
¶¶ 
(
¶¶ 
$str
¶¶ \
,
¶¶\ ]
request
¶¶^ e
.
¶¶e f
Email
¶¶f k
)
¶¶k l
;
¶¶l m
throw
ßß 
new
ßß !
ValidationException
ßß )
(
ßß) *
$str
ßß* F
)
ßßF G
;
ßßG H
}
®® 	
if
©© 

(
©© 
!
©© 
user
©© 
.
©© 
EmailConfirmed
©©  
)
©©  !
{
™™ 	
throw
´´ 
new
´´ !
ValidationException
´´ )
(
´´) *
$str
´´* F
)
´´F G
;
´´G H
}
¨¨ 	
if
ÆÆ 

(
ÆÆ 
!
ÆÆ 
user
ÆÆ 
.
ÆÆ 
IsActive
ÆÆ 
)
ÆÆ 
{
ØØ 	
throw
∞∞ 
new
∞∞ &
AccountInactiveException
∞∞ .
(
∞∞. /
$str
∞∞/ i
)
∞∞i j
;
∞∞j k
}
±± 	
if
≥≥ 

(
≥≥ 
user
≥≥ 
.
≥≥ 

LockoutEnd
≥≥ 
.
≥≥ 
HasValue
≥≥ $
&&
≥≥% '
user
≥≥( ,
.
≥≥, -

LockoutEnd
≥≥- 7
.
≥≥7 8
Value
≥≥8 =
>
≥≥> ?
DateTime
≥≥@ H
.
≥≥H I
UtcNow
≥≥I O
)
≥≥O P
{
¥¥ 	
var
µµ 
remainingTime
µµ 
=
µµ 
(
µµ  !
user
µµ! %
.
µµ% &

LockoutEnd
µµ& 0
.
µµ0 1
Value
µµ1 6
-
µµ7 8
DateTime
µµ9 A
.
µµA B
UtcNow
µµB H
)
µµH I
.
µµI J
TotalMinutes
µµJ V
;
µµV W
throw
∂∂ 
new
∂∂ $
AccountLockedException
∂∂ ,
(
∂∂, -
$"
∂∂- /
$str
∂∂/ V
{
∂∂V W
Math
∂∂W [
.
∂∂[ \
Ceiling
∂∂\ c
(
∂∂c d
remainingTime
∂∂d q
)
∂∂q r
}
∂∂r s
$str
∂∂s |
"
∂∂| }
)
∂∂} ~
;
∂∂~ 
}
∑∑ 	
if
∫∫ 

(
∫∫ 
!
∫∫ 
_passwordService
∫∫ 
.
∫∫ 
VerifyPassword
∫∫ ,
(
∫∫, -
request
∫∫- 4
.
∫∫4 5
Password
∫∫5 =
,
∫∫= >
user
∫∫? C
.
∫∫C D
PasswordHash
∫∫D P
)
∫∫P Q
)
∫∫Q R
{
ªª 	
user
ΩΩ 
.
ΩΩ !
FailedLoginAttempts
ΩΩ $
++
ΩΩ$ &
;
ΩΩ& '
if
¿¿ 
(
¿¿ 
user
¿¿ 
.
¿¿ !
FailedLoginAttempts
¿¿ (
>=
¿¿) +!
MAX_FAILED_ATTEMPTS
¿¿, ?
)
¿¿? @
{
¡¡ 
user
¬¬ 
.
¬¬ 

LockoutEnd
¬¬ 
=
¬¬  !
DateTime
¬¬" *
.
¬¬* +
UtcNow
¬¬+ 1
.
¬¬1 2

AddMinutes
¬¬2 <
(
¬¬< ="
LOCKOUT_TIME_MINUTES
¬¬= Q
)
¬¬Q R
;
¬¬R S
_logger
√√ 
.
√√ 

LogWarning
√√ "
(
√√" #
$"
√√# %
$str
√√% >
{
√√> ?
user
√√? C
.
√√C D
Email
√√D I
}
√√I J
"
√√J K
)
√√K L
;
√√L M
}
ƒƒ 
await
∆∆ 
_context
∆∆ 
.
∆∆ 
SaveChangesAsync
∆∆ +
(
∆∆+ ,
)
∆∆, -
;
∆∆- .
throw
»» 
new
»» !
ValidationException
»» )
(
»») *
$str
»»* E
)
»»E F
;
»»F G
}
…… 	
user
ÃÃ 
.
ÃÃ !
FailedLoginAttempts
ÃÃ  
=
ÃÃ! "
$num
ÃÃ# $
;
ÃÃ$ %
user
ŒŒ 
.
ŒŒ 
LastLoginAt
ŒŒ 
=
ŒŒ 
DateTime
ŒŒ #
.
ŒŒ# $
UtcNow
ŒŒ$ *
;
ŒŒ* +
var
—— 
accessToken
—— 
=
—— 
await
—— 
_tokenService
——  -
.
——- .&
GenerateAccessTokenAsync
——. F
(
——F G
user
——G K
)
——K L
;
——L M
var
““ 
refreshToken
““ 
=
““ 
await
““  
_tokenService
““! .
.
““. /'
GenerateRefreshTokenAsync
““/ H
(
““H I
)
““I J
;
““J K
user
’’ 
.
’’ 
RefreshToken
’’ 
=
’’ 
refreshToken
’’ (
;
’’( )
user
÷÷ 
.
÷÷  
RefreshTokenExpiry
÷÷ 
=
÷÷  !
request
÷÷" )
.
÷÷) *

RememberMe
÷÷* 4
?
◊◊ 
DateTime
◊◊ 
.
◊◊ 
UtcNow
◊◊ 
.
◊◊ 
AddDays
◊◊ %
(
◊◊% &
_jwtSettings
◊◊& 2
.
◊◊2 32
$RefreshTokenRememberMeExpirationDays
◊◊3 W
)
◊◊W X
:
ÿÿ 
DateTime
ÿÿ 
.
ÿÿ 
UtcNow
ÿÿ 
.
ÿÿ 
AddDays
ÿÿ %
(
ÿÿ% &
_jwtSettings
ÿÿ& 2
.
ÿÿ2 3(
RefreshTokenExpirationDays
ÿÿ3 M
)
ÿÿM N
;
ÿÿN O
await
ŸŸ 
_context
ŸŸ 
.
ŸŸ 
SaveChangesAsync
ŸŸ '
(
ŸŸ' (
)
ŸŸ( )
;
ŸŸ) *
_logger
€€ 
.
€€ 
LogInformation
€€ 
(
€€ 
$str
€€ D
,
€€D E
request
€€F M
.
€€M N
Email
€€N S
)
€€S T
;
€€T U
return
›› 
new
›› 
AuthResponseDto
›› "
{
ﬁﬁ 	
Message
ﬂﬂ 
=
ﬂﬂ 
$str
ﬂﬂ (
,
ﬂﬂ( )
AccessToken
‡‡ 
=
‡‡ 
accessToken
‡‡ %
,
‡‡% &
RefreshToken
·· 
=
·· 
refreshToken
·· '
,
··' (
AccessTokenExpiry
‚‚ 
=
‚‚ 
DateTime
‚‚  (
.
‚‚( )
UtcNow
‚‚) /
.
‚‚/ 0

AddMinutes
‚‚0 :
(
‚‚: ;
_jwtSettings
‚‚; G
.
‚‚G H*
AccessTokenExpirationMinutes
‚‚H d
)
‚‚d e
,
‚‚e f
User
„„ 
=
„„ 
await
„„ 
MapToUserDto
„„ %
(
„„% &
user
„„& *
)
„„* +
}
‰‰ 	
;
‰‰	 

}
ÂÂ 
public
ÎÎ 

async
ÎÎ 
Task
ÎÎ 
<
ÎÎ 
AuthResponseDto
ÎÎ %
>
ÎÎ% &
RefreshTokenAsync
ÎÎ' 8
(
ÎÎ8 9$
RefreshTokenRequestDto
ÎÎ9 O
request
ÎÎP W
)
ÎÎW X
{
ÏÏ 
var
ÓÓ 
	principal
ÓÓ 
=
ÓÓ 
_tokenService
ÓÓ %
.
ÓÓ% &*
GetPrincipalFromExpiredToken
ÓÓ& B
(
ÓÓB C
request
ÓÓC J
.
ÓÓJ K
AccessToken
ÓÓK V
)
ÓÓV W
;
ÓÓW X
if
ÔÔ 

(
ÔÔ 
	principal
ÔÔ 
==
ÔÔ 
null
ÔÔ 
)
ÔÔ 
{
 	
throw
ÒÒ 
new
ÒÒ !
ValidationException
ÒÒ )
(
ÒÒ) *
$str
ÒÒ* @
)
ÒÒ@ A
;
ÒÒA B
}
ÚÚ 	
var
ÙÙ 
userIdClaim
ÙÙ 
=
ÙÙ 
	principal
ÙÙ #
.
ÙÙ# $
	FindFirst
ÙÙ$ -
(
ÙÙ- .
System
ÙÙ. 4
.
ÙÙ4 5
Security
ÙÙ5 =
.
ÙÙ= >
Claims
ÙÙ> D
.
ÙÙD E

ClaimTypes
ÙÙE O
.
ÙÙO P
NameIdentifier
ÙÙP ^
)
ÙÙ^ _
;
ÙÙ_ `
if
ıı 

(
ıı 
userIdClaim
ıı 
==
ıı 
null
ıı 
||
ıı  "
!
ıı# $
int
ıı$ '
.
ıı' (
TryParse
ıı( 0
(
ıı0 1
userIdClaim
ıı1 <
.
ıı< =
Value
ıı= B
,
ııB C
out
ııD G
int
ııH K
userId
ııL R
)
ııR S
)
ııS T
{
ˆˆ 	
throw
˜˜ 
new
˜˜ !
ValidationException
˜˜ )
(
˜˜) *
$str
˜˜* @
)
˜˜@ A
;
˜˜A B
}
¯¯ 	
var
¸¸ 
user
¸¸ 
=
¸¸ 
await
¸¸ 
_context
¸¸ !
.
¸¸! "
Users
¸¸" '
.
˝˝ !
FirstOrDefaultAsync
˝˝  
(
˝˝  !
a
˝˝! "
=>
˝˝# %
a
˝˝& '
.
˝˝' (
Id
˝˝( *
==
˝˝+ -
userId
˝˝. 4
)
˝˝4 5
;
˝˝5 6
if
˛˛ 

(
˛˛ 
user
˛˛ 
==
˛˛ 
null
˛˛ 
)
˛˛ 
{
ˇˇ 	
throw
ÖÖ 
new
ÖÖ !
ValidationException
ÖÖ )
(
ÖÖ) *
$str
ÖÖ* ;
)
ÖÖ; <
;
ÖÖ< =
}
ÜÜ 	
if
áá 

(
áá 
!
áá 
user
áá 
.
áá 
EmailConfirmed
áá  
)
áá  !
{
àà 	
throw
ââ 
new
ââ &
AccountInactiveException
ââ .
(
ââ. /
$str
ââ/ M
)
ââM N
;
ââN O
}
ää 	
if
ãã 

(
ãã 
!
ãã 
user
ãã 
.
ãã 
IsActive
ãã 
)
ãã 
{
åå 	
throw
çç 
new
çç &
AccountInactiveException
çç .
(
çç. /
$str
çç/ i
)
ççi j
;
ççj k
}
éé 	
if
èè 

(
èè 
user
èè 
.
èè 
RefreshToken
èè 
!=
èè  
request
èè! (
.
èè( )
RefreshToken
èè) 5
)
èè5 6
{
êê 	
throw
ëë 
new
ëë !
ValidationException
ëë )
(
ëë) *
$str
ëë* D
)
ëëD E
;
ëëE F
}
íí 	
if
ìì 

(
ìì 
user
ìì 
.
ìì  
RefreshTokenExpiry
ìì #
<=
ìì$ &
DateTime
ìì' /
.
ìì/ 0
UtcNow
ìì0 6
)
ìì6 7
{
îî 	
throw
ïï 
new
ïï !
ValidationException
ïï )
(
ïï) *
$str
ïï* E
)
ïïE F
;
ïïF G
}
ññ 	
var
òò 
accessToken
òò 
=
òò 
await
òò 
_tokenService
òò  -
.
òò- .&
GenerateAccessTokenAsync
òò. F
(
òòF G
user
òòG K
)
òòK L
;
òòL M
var
ôô 
refreshToken
ôô 
=
ôô 
await
ôô  
_tokenService
ôô! .
.
ôô. /'
GenerateRefreshTokenAsync
ôô/ H
(
ôôH I
)
ôôI J
;
ôôJ K
user
úú 
.
úú 
RefreshToken
úú 
=
úú 
refreshToken
úú (
;
úú( )
user
ùù 
.
ùù  
RefreshTokenExpiry
ùù 
=
ùù  !
DateTime
ùù" *
.
ùù* +
UtcNow
ùù+ 1
.
ùù1 2
AddDays
ùù2 9
(
ùù9 :
_jwtSettings
ùù: F
.
ùùF G(
RefreshTokenExpirationDays
ùùG a
)
ùùa b
;
ùùb c
await
ûû 
_context
ûû 
.
ûû 
SaveChangesAsync
ûû '
(
ûû' (
)
ûû( )
;
ûû) *
return
†† 
new
†† 
AuthResponseDto
†† "
{
°° 	
Message
¢¢ 
=
¢¢ 
$str
¢¢ 4
,
¢¢4 5
AccessToken
££ 
=
££ 
accessToken
££ %
,
££% &
RefreshToken
§§ 
=
§§ 
refreshToken
§§ '
,
§§' (
AccessTokenExpiry
•• 
=
•• 
DateTime
••  (
.
••( )
UtcNow
••) /
.
••/ 0

AddMinutes
••0 :
(
••: ;
_jwtSettings
••; G
.
••G H*
AccessTokenExpirationMinutes
••H d
)
••d e
,
••e f
User
¶¶ 
=
¶¶ 
await
¶¶ 
MapToUserDto
¶¶ %
(
¶¶% &
user
¶¶& *
)
¶¶* +
}
ßß 	
;
ßß	 

}
®® 
public
ÆÆ 

async
ÆÆ 
Task
ÆÆ 
<
ÆÆ 
bool
ÆÆ 
>
ÆÆ 
LogoutAsync
ÆÆ '
(
ÆÆ' (
int
ÆÆ( +
userId
ÆÆ, 2
)
ÆÆ2 3
{
ØØ 
var
∞∞ 
user
∞∞ 
=
∞∞ 
await
∞∞ 
_context
∞∞ !
.
∞∞! "
Users
∞∞" '
.
±± !
FirstOrDefaultAsync
±±  
(
±±  !
a
±±! "
=>
±±# %
a
±±& '
.
±±' (
Id
±±( *
==
±±+ -
userId
±±. 4
)
±±4 5
;
±±5 6
if
≤≤ 

(
≤≤ 
user
≤≤ 
==
≤≤ 
null
≤≤ 
)
≤≤ 
{
≥≥ 	
throw
¥¥ 
new
¥¥ !
ValidationException
¥¥ )
(
¥¥) *
$str
¥¥* ;
)
¥¥; <
;
¥¥< =
}
µµ 	
user
∑∑ 
.
∑∑ 
RefreshToken
∑∑ 
=
∑∑ 
null
∑∑  
;
∑∑  !
user
∏∏ 
.
∏∏  
RefreshTokenExpiry
∏∏ 
=
∏∏  !
DateTime
∏∏" *
.
∏∏* +
UtcNow
∏∏+ 1
;
∏∏1 2
await
ππ 
_context
ππ 
.
ππ 
SaveChangesAsync
ππ '
(
ππ' (
)
ππ( )
;
ππ) *
_logger
ªª 
.
ªª 
LogInformation
ªª 
(
ªª 
$str
ªª :
,
ªª: ;
userId
ªª< B
)
ªªB C
;
ªªC D
return
ºº 
true
ºº 
;
ºº 
}
ΩΩ 
public
√√ 

async
√√ 
Task
√√ 
<
√√ 
bool
√√ 
>
√√ 
ConfirmEmailAsync
√√ -
(
√√- .$
ConfirmEmailRequestDto
√√. D
request
√√E L
)
√√L M
{
ƒƒ 
var
≈≈ 
user
≈≈ 
=
≈≈ 
await
≈≈ 
_context
≈≈ !
.
≈≈! "
Users
≈≈" '
.
∆∆ !
FirstOrDefaultAsync
∆∆  
(
∆∆  !
a
∆∆! "
=>
∆∆# %
a
∆∆& '
.
∆∆' (
Email
∆∆( -
==
∆∆. 0
request
∆∆1 8
.
∆∆8 9
Email
∆∆9 >
)
∆∆> ?
;
∆∆? @
if
«« 

(
«« 
user
«« 
==
«« 
null
«« 
)
«« 
{
»» 	
_logger
…… 
.
…… 

LogWarning
…… 
(
…… 
$str
…… d
,
……d e
request
……f m
.
……m n
Email
……n s
)
……s t
;
……t u
throw
   
new
   !
ValidationException
   )
(
  ) *
$str
  * 9
)
  9 :
;
  : ;
}
ÀÀ 	
if
”” 

(
”” 
user
”” 
.
”” $
EmailConfirmationToken
”” '
!=
””( *
request
””+ 2
.
””2 3
AccessToken
””3 >
||
””? A
user
””B F
.
””F G*
EmailConfirmationTokenExpiry
””G c
<
””d e
DateTime
””f n
.
””n o
UtcNow
””o u
)
””u v
{
‘‘ 	
throw
’’ 
new
’’ !
ValidationException
’’ )
(
’’) *
$str
’’* Q
)
’’Q R
;
’’R S
}
÷÷ 	
user
ÿÿ 
.
ÿÿ 
EmailConfirmed
ÿÿ 
=
ÿÿ 
true
ÿÿ "
;
ÿÿ" #
user
ŸŸ 
.
ŸŸ $
EmailConfirmationToken
ŸŸ #
=
ŸŸ$ %
null
ŸŸ& *
;
ŸŸ* +
user
⁄⁄ 
.
⁄⁄ *
EmailConfirmationTokenExpiry
⁄⁄ )
=
⁄⁄* +
DateTime
⁄⁄, 4
.
⁄⁄4 5
UtcNow
⁄⁄5 ;
;
⁄⁄; <
await
‹‹ 
_context
‹‹ 
.
‹‹ 
SaveChangesAsync
‹‹ '
(
‹‹' (
)
‹‹( )
;
‹‹) *
_logger
ﬁﬁ 
.
ﬁﬁ 
LogInformation
ﬁﬁ 
(
ﬁﬁ 
$str
ﬁﬁ C
,
ﬁﬁC D
request
ﬁﬁE L
.
ﬁﬁL M
Email
ﬁﬁM R
)
ﬁﬁR S
;
ﬁﬁS T
return
ﬂﬂ 
true
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 
public
ÊÊ 

async
ÊÊ 
Task
ÊÊ 
<
ÊÊ 
bool
ÊÊ 
>
ÊÊ !
ChangePasswordAsync
ÊÊ /
(
ÊÊ/ 0
int
ÊÊ0 3
userId
ÊÊ4 :
,
ÊÊ: ;&
ChangePasswordRequestDto
ÊÊ< T
request
ÊÊU \
)
ÊÊ\ ]
{
ÁÁ 
var
ËË 
user
ËË 
=
ËË 
await
ËË 
_context
ËË !
.
ËË! "
Users
ËË" '
.
ÈÈ !
FirstOrDefaultAsync
ÈÈ  
(
ÈÈ  !
a
ÈÈ! "
=>
ÈÈ# %
a
ÈÈ& '
.
ÈÈ' (
Id
ÈÈ( *
==
ÈÈ+ -
userId
ÈÈ. 4
)
ÈÈ4 5
;
ÈÈ5 6
if
ÍÍ 

(
ÍÍ 
user
ÍÍ 
==
ÍÍ 
null
ÍÍ 
)
ÍÍ 
{
ÎÎ 	
throw
ÏÏ 
new
ÏÏ !
ValidationException
ÏÏ )
(
ÏÏ) *
$str
ÏÏ* ;
)
ÏÏ; <
;
ÏÏ< =
}
ÌÌ 	
if
˜˜ 

(
˜˜ 
!
˜˜ 
_passwordService
˜˜ 
.
˜˜ 
VerifyPassword
˜˜ ,
(
˜˜, -
request
˜˜- 4
.
˜˜4 5
CurrentPassword
˜˜5 D
,
˜˜D E
user
˜˜F J
.
˜˜J K
PasswordHash
˜˜K W
)
˜˜W X
)
˜˜X Y
{
¯¯ 	
_logger
˘˘ 
.
˘˘ 

LogWarning
˘˘ 
(
˘˘ 
$str
˘˘ J
,
˘˘J K
userId
˘˘L R
)
˘˘R S
;
˘˘S T
throw
˙˙ 
new
˙˙ !
ValidationException
˙˙ )
(
˙˙) *
$str
˙˙* =
)
˙˙= >
;
˙˙> ?
}
˚˚ 	
user
˛˛ 
.
˛˛ 
PasswordHash
˛˛ 
=
˛˛ 
_passwordService
˛˛ ,
.
˛˛, -
HashPassword
˛˛- 9
(
˛˛9 :
request
˛˛: A
.
˛˛A B
NewPassword
˛˛B M
)
˛˛M N
;
˛˛N O
user
ˇˇ 
.
ˇˇ 
	UpdatedAt
ˇˇ 
=
ˇˇ 
DateTime
ˇˇ !
.
ˇˇ! "
UtcNow
ˇˇ" (
;
ˇˇ( )
user
ÄÄ 
.
ÄÄ 
	UpdatedBy
ÄÄ 
=
ÄÄ 
user
ÄÄ 
.
ÄÄ 
Name
ÄÄ "
;
ÄÄ" #
_logger
ÇÇ 
.
ÇÇ 
LogInformation
ÇÇ 
(
ÇÇ 
$str
ÇÇ Q
,
ÇÇQ R
userId
ÇÇS Y
)
ÇÇY Z
;
ÇÇZ [
return
ÉÉ 
true
ÉÉ 
;
ÉÉ 
}
ÑÑ 
public
àà 

async
àà 
Task
àà 
<
àà 
bool
àà 
>
àà !
ForgotPasswordAsync
àà /
(
àà/ 0&
ForgotPasswordRequestDto
àà0 H
request
ààI P
)
ààP Q
{
ââ 
_logger
ää 
.
ää 
LogInformation
ää 
(
ää 
$str
ää M
,
ääM N
request
ääO V
.
ääV W
Email
ääW \
)
ää\ ]
;
ää] ^
var
åå 
user
åå 
=
åå 
await
åå 
_context
åå !
.
åå! "
Users
åå" '
.
çç !
FirstOrDefaultAsync
çç  
(
çç  !
a
çç! "
=>
çç# %
a
çç& '
.
çç' (
Email
çç( -
==
çç. 0
request
çç1 8
.
çç8 9
Email
çç9 >
)
çç> ?
;
çç? @
if
êê 

(
êê 
user
êê 
==
êê 
null
êê 
)
êê 
{
ëë 	
_logger
íí 
.
íí 

LogWarning
íí 
(
íí 
$str
íí Z
,
ííZ [
request
íí\ c
.
ííc d
Email
ííd i
)
ííi j
;
ííj k
return
îî 
true
îî 
;
îî 
}
ïï 	
var
òò 
token
òò 
=
òò 
await
òò 
_tokenService
òò '
.
òò' (-
GeneratePasswordResetTokenAsync
òò( G
(
òòG H
)
òòH I
;
òòI J
user
ôô 
.
ôô  
PasswordResetToken
ôô 
=
ôô  !
token
ôô" '
;
ôô' (
user
öö 
.
öö &
PasswordResetTokenExpiry
öö %
=
öö& '
DateTime
öö( 0
.
öö0 1
UtcNow
öö1 7
.
öö7 8
AddHours
öö8 @
(
öö@ A
$num
ööA B
)
ööB C
;
ööC D
;
ööE F
await
úú 
_context
úú 
.
úú 
SaveChangesAsync
úú '
(
úú' (
)
úú( )
;
úú) *
var
üü 
	resetLink
üü 
=
üü 
$"
üü 
$str
üü F
{
üüF G
Uri
üüG J
.
üüJ K
EscapeDataString
üüK [
(
üü[ \
user
üü\ `
.
üü` a
Email
üüa f
)
üüf g
}
üüg h
$str
üüh o
{
üüo p
Uri
üüp s
.
üüs t
EscapeDataStringüüt Ñ
(üüÑ Ö
tokenüüÖ ä
)üüä ã
}üüã å
"üüå ç
;üüç é
await
££ 
_emailService
££ 
.
££ $
SendPasswordResetAsync
££ 2
(
££2 3
user
££3 7
.
££7 8
Email
££8 =
,
££= >
user
££? C
.
££C D
Name
££D H
??
££I K
string
££L R
.
££R S
Empty
££S X
,
££X Y
	resetLink
££Z c
)
££c d
;
££d e
_logger
•• 
.
•• 
LogInformation
•• 
(
•• 
$str
•• E
,
••E F
user
••G K
.
••K L
Email
••L Q
)
••Q R
;
••R S
return
ßß 
true
ßß 
;
ßß 
}
®® 
public
≠≠ 

async
≠≠ 
Task
≠≠ 
<
≠≠ 
bool
≠≠ 
>
≠≠  
ResetPasswordAsync
≠≠ .
(
≠≠. /%
ResetPasswordRequestDto
≠≠/ F
request
≠≠G N
)
≠≠N O
{
ÆÆ 
_logger
ØØ 
.
ØØ 
LogInformation
ØØ 
(
ØØ 
$str
ØØ J
,
ØØJ K
request
ØØL S
.
ØØS T
Email
ØØT Y
)
ØØY Z
;
ØØZ [
var
∏∏ 
user
∏∏ 
=
∏∏ 
await
∏∏ 
_context
∏∏ !
.
∏∏! "
Users
∏∏" '
.
ππ !
FirstOrDefaultAsync
ππ  
(
ππ  !
a
ππ! "
=>
ππ# %
a
ππ& '
.
ππ' (
Email
ππ( -
==
ππ. 0
request
ππ1 8
.
ππ8 9
Email
ππ9 >
)
ππ> ?
;
ππ? @
if
∫∫ 

(
∫∫ 
user
∫∫ 
==
∫∫ 
null
∫∫ 
)
∫∫ 
{
ªª 	
_logger
ºº 
.
ºº 

LogWarning
ºº 
(
ºº 
$str
ºº Z
,
ººZ [
request
ºº\ c
.
ººc d
Email
ººd i
)
ººi j
;
ººj k
throw
ΩΩ 
new
ΩΩ !
ValidationException
ΩΩ )
(
ΩΩ) *
$str
ΩΩ* B
)
ΩΩB C
;
ΩΩC D
}
ææ 	
if
¡¡ 

(
¡¡ 
user
¡¡ 
.
¡¡  
PasswordResetToken
¡¡ #
!=
¡¡$ &
request
¡¡' .
.
¡¡. / 
PasswordResetToken
¡¡/ A
||
¡¡B D
user
¬¬ 
.
¬¬ &
PasswordResetTokenExpiry
¬¬ )
<
¬¬* +
DateTime
¬¬, 4
.
¬¬4 5
UtcNow
¬¬5 ;
)
¬¬; <
{
√√ 	
_logger
ƒƒ 
.
ƒƒ 

LogWarning
ƒƒ 
(
ƒƒ 
$str
ƒƒ E
,
ƒƒE F
request
ƒƒG N
.
ƒƒN O
Email
ƒƒO T
)
ƒƒT U
;
ƒƒU V
throw
≈≈ 
new
≈≈ !
ValidationException
≈≈ )
(
≈≈) *
$str
≈≈* K
)
≈≈K L
;
≈≈L M
}
∆∆ 	
user
…… 
.
…… 
PasswordHash
…… 
=
…… 
_passwordService
…… ,
.
……, -
HashPassword
……- 9
(
……9 :
request
……: A
.
……A B
NewPassword
……B M
)
……M N
;
……N O
user
   
.
   
	UpdatedAt
   
=
   
DateTime
   !
.
  ! "
UtcNow
  " (
;
  ( )
user
ÀÀ 
.
ÀÀ 
	UpdatedBy
ÀÀ 
=
ÀÀ 
user
ÀÀ 
.
ÀÀ 
Name
ÀÀ "
;
ÀÀ" #
user
ŒŒ 
.
ŒŒ  
PasswordResetToken
ŒŒ 
=
ŒŒ  !
null
ŒŒ" &
;
ŒŒ& '
user
œœ 
.
œœ &
PasswordResetTokenExpiry
œœ %
=
œœ& '
DateTime
œœ( 0
.
œœ0 1
UtcNow
œœ1 7
;
œœ7 8
user
–– 
.
–– 
	UpdatedAt
–– 
=
–– 
DateTime
–– !
.
––! "
UtcNow
––" (
;
––( )
await
““ 
_context
““ 
.
““ 
SaveChangesAsync
““ '
(
““' (
)
““( )
;
““) *
await
’’ 
_emailService
’’ 
.
’’ 2
$SendPasswordChangedNotificationAsync
’’ @
(
’’@ A
user
’’A E
.
’’E F
Email
’’F K
,
’’K L
user
’’M Q
.
’’Q R
Name
’’R V
??
’’W Y
$str
’’Z `
)
’’` a
;
’’a b
_logger
◊◊ 
.
◊◊ 
LogInformation
◊◊ 
(
◊◊ 
$str
◊◊ F
,
◊◊F G
request
◊◊H O
.
◊◊O P
Email
◊◊P U
)
◊◊U V
;
◊◊V W
return
ŸŸ 
true
ŸŸ 
;
ŸŸ 
}
⁄⁄ 
private
‡‡ 
async
‡‡ 
Task
‡‡ 
<
‡‡ 
UserDto
‡‡ 
>
‡‡ 
MapToUserDto
‡‡  ,
(
‡‡, -
User
‡‡- 1
user
‡‡2 6
)
‡‡6 7
{
·· 
var
‚‚ 
usera
‚‚ 
=
‚‚ 
await
‚‚ 
_context
‚‚ "
.
‚‚" #
Users
‚‚# (
.
„„ !
FirstOrDefaultAsync
„„  
(
„„  !
a
„„! "
=>
„„# %
a
„„& '
.
„„' (
Email
„„( -
==
„„. 0
user
„„1 5
.
„„5 6
Email
„„6 ;
)
„„; <
;
„„< =
var
ÂÂ 
roles
ÂÂ 
=
ÂÂ 
await
ÂÂ 
_context
ÂÂ "
.
ÂÂ" #
	UserRoles
ÂÂ# ,
.
ÊÊ 
Where
ÊÊ 
(
ÊÊ 
a
ÊÊ 
=>
ÊÊ 
a
ÊÊ 
.
ÊÊ 
UserId
ÊÊ  
==
ÊÊ! #
user
ÊÊ$ (
.
ÊÊ( )
Id
ÊÊ) +
)
ÊÊ+ ,
.
ÁÁ 
Include
ÁÁ 
(
ÁÁ 
a
ÁÁ 
=>
ÁÁ 
a
ÁÁ 
.
ÁÁ 
Role
ÁÁ  
)
ÁÁ  !
.
ËË 
Select
ËË 
(
ËË 
a
ËË 
=>
ËË 
a
ËË 
.
ËË 
Role
ËË 
.
ËË  
Name
ËË  $
)
ËË$ %
.
ÈÈ 
ToListAsync
ÈÈ 
(
ÈÈ 
)
ÈÈ 
;
ÈÈ 
var
ÎÎ 
claims
ÎÎ 
=
ÎÎ 
await
ÎÎ 
_context
ÎÎ #
.
ÎÎ# $

UserClaims
ÎÎ$ .
.
ÏÏ 
Where
ÏÏ 
(
ÏÏ 
a
ÏÏ 
=>
ÏÏ 
a
ÏÏ 
.
ÏÏ 
UserId
ÏÏ  
==
ÏÏ! #
user
ÏÏ$ (
.
ÏÏ( )
Id
ÏÏ) +
)
ÏÏ+ ,
.
ÌÌ 
Select
ÌÌ 
(
ÌÌ 
a
ÌÌ 
=>
ÌÌ 
new
ÌÌ 
ClaimDto
ÌÌ %
{
ÌÌ& '
Type
ÌÌ( ,
=
ÌÌ- .
a
ÌÌ/ 0
.
ÌÌ0 1
	ClaimType
ÌÌ1 :
,
ÌÌ: ;
Value
ÌÌ< A
=
ÌÌB C
a
ÌÌD E
.
ÌÌE F

ClaimValue
ÌÌF P
}
ÌÌQ R
)
ÌÌR S
.
ÓÓ 
ToListAsync
ÓÓ 
(
ÓÓ 
)
ÓÓ 
;
ÓÓ 
return
 
new
 
UserDto
 
{
ÒÒ 	
Id
ÚÚ 
=
ÚÚ 
user
ÚÚ 
.
ÚÚ 
Id
ÚÚ 
,
ÚÚ 
Name
ÛÛ 
=
ÛÛ 
user
ÛÛ 
.
ÛÛ 
Name
ÛÛ 
,
ÛÛ 
Email
ÙÙ 
=
ÙÙ 
user
ÙÙ 
.
ÙÙ 
Email
ÙÙ 
??
ÙÙ !
string
ÙÙ" (
.
ÙÙ( )
Empty
ÙÙ) .
,
ÙÙ. /
EmailConfirmed
ıı 
=
ıı 
user
ıı !
.
ıı! "
EmailConfirmed
ıı" 0
,
ıı0 1
	CreatedAt
ˆˆ 
=
ˆˆ 
user
ˆˆ 
.
ˆˆ 
	CreatedAt
ˆˆ &
,
ˆˆ& '
	UpdatedAt
˜˜ 
=
˜˜ 
user
˜˜ 
.
˜˜ 
	UpdatedAt
˜˜ &
??
˜˜' )
DateTime
˜˜* 2
.
˜˜2 3
MinValue
˜˜3 ;
,
˜˜; <
Roles
¯¯ 
=
¯¯ 
roles
¯¯ 
,
¯¯ 
Claims
˘˘ 
=
˘˘ 
claims
˘˘ 
}
˙˙ 	
;
˙˙	 

}
˚˚ 
}¸¸ ¡a
UD:\BootcampProject\default-project-main\src\04.Application\Mappings\MappingProfile.cs
	namespace 	
MyApp
 
. 
Application 
. 
Mappings $
{ 
public

 

class

 
MappingProfile

 
:

  !
Profile

" )
{ 
public 
MappingProfile 
( 
) 
{ 	
	CreateMap 
< 
Category 
, 
CategoryDto  +
>+ ,
(, -
)- .
;. /
	CreateMap 
< 
CreateCategoryDto '
,' (
Category) 1
>1 2
(2 3
)3 4
;4 5
	CreateMap 
< 
UpdateCategoryDto '
,' (
Category) 1
>1 2
(2 3
)3 4
;4 5
	CreateMap 
< 
Course 
, 
	CourseDto '
>' (
(( )
)) *
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
CategoryName( 4
,4 5
opt 
=> 
opt 
. 
MapFrom &
(& '
src' *
=>+ -
src. 1
.1 2
Category2 :
.: ;
Name; ?
)? @
)@ A
. 
	ForMember 
( 
dest 
=>  "
dest# '
.' (
ScheduleDates( 5
,5 6
opt 
=> 
opt 
. 
MapFrom &
(& '
src' *
=>+ -
src. 1
.1 2
	Schedules2 ;
.; <
Select< B
(B C
sC D
=>E G
sH I
.I J
DateJ N
)N O
.O P
ToListP V
(V W
)W X
)X Y
)Y Z
;Z [
	CreateMap 
< 
CreateCourseDto %
,% &
Course' -
>- .
(. /
)/ 0
;0 1
	CreateMap 
< 
UpdateCourseDto %
,% &
Course' -
>- .
(. /
)/ 0
;0 1
	CreateMap!! 
<!! 
PaymentMethod!! #
,!!# $

PaymentDto!!% /
>!!/ 0
(!!0 1
)!!1 2
;!!2 3
	CreateMap"" 
<"" 
CreatePaymentDto"" &
,""& '
PaymentMethod""( 5
>""5 6
(""6 7
)""7 8
;""8 9
	CreateMap## 
<## 
UpdatePaymentDto## &
,##& '
PaymentMethod##( 5
>##5 6
(##6 7
)##7 8
;##8 9
	CreateMap&& 
<&& 
User&& 
,&& 
UserDto&& #
>&&# $
(&&$ %
)&&% &
.'' 
	ForMember'' 
('' 
dest'' 
=>''  "
dest''# '
.''' (
Roles''( -
,''- .
opt(( 
=>(( !
opt((" %
.((% &
MapFrom((& -
(((- .
src((. 1
=>((2 4
src((5 8
.((8 9
	UserRoles((9 B
.((B C
Select((C I
(((I J
s((J K
=>((L N
s((O P
.((P Q
Role((Q U
.((U V
Name((V Z
)((Z [
.(([ \
ToList((\ b
(((b c
)((c d
)((d e
)((e f
.)) 
	ForMember)) 
()) 
dest)) 
=>))  "
dest))# '
.))' (
Claims))( .
,)). /
opt** 
=>** !
opt**" %
.**% &
MapFrom**& -
(**- .
src**. 1
=>**2 4
src**5 8
.**8 9

UserClaims**9 C
.**C D
Select**D J
(**J K
s**K L
=>**M O
new**P S
ClaimDto**T \
{**] ^
Type**_ c
=**d e
s**f g
.**g h
	ClaimType**h q
,**q r
Value**s x
=**y z
s**{ |
.**| }

ClaimValue	**} á
}
**à â
)
**â ä
.
**ä ã
ToList
**ã ë
(
**ë í
)
**í ì
)
**ì î
)
**î ï
;
**ï ñ
	CreateMap++ 
<++ 
Role++ 
,++ 
RoleDto++ #
>++# $
(++$ %
)++% &
;++& '
	CreateMap.. 
<.. 
CartItem.. 
,.. 
CartItemResponseDto..  3
>..3 4
(..4 5
)..5 6
.// 
	ForMember// 
(// 
dest// 
=>//  "
dest//# '
.//' (
UserName//( 0
,//0 1
opt//2 5
=>//6 8
opt//9 <
.//< =
MapFrom//= D
(//D E
src//E H
=>//I K
src//L O
.//O P
User//P T
.//T U
Name//U Y
)//Y Z
)//Z [
.00 
	ForMember00 
(00 
dest00 
=>00  "
dest00# '
.00' (

CourseName00( 2
,002 3
opt11 
=>11 !
opt11" %
.11% &
MapFrom11& -
(11- .
src11. 1
=>112 4
src115 8
.118 9
Schedule119 A
.11A B
Course11B H
.11H I
Name11I M
)11M N
)11N O
.22 
	ForMember22 
(22 
dest22 
=>22  "
dest22# '
.22' (
Date22( ,
,22, -
opt33 
=>33 !
opt33" %
.33% &
MapFrom33& -
(33- .
src33. 1
=>332 4
src335 8
.338 9
Schedule339 A
.33A B
Date33B F
)33F G
)33G H
.44 
	ForMember44 
(44 
dest44 
=>44  "
dest44# '
.44' (
CategoryName44( 4
,444 5
opt446 9
=>44: <
opt44= @
.44@ A
MapFrom44A H
(44H I
src44I L
=>44M O
src44P S
.44S T
Schedule44T \
.44\ ]
Course44] c
.44c d
Category44d l
.44l m
Name44m q
)44q r
)44r s
.55 
	ForMember55 
(55 
dest55 
=>55  "
dest55# '
.55' (
Price55( -
,55- .
opt55/ 2
=>553 5
opt556 9
.559 :
MapFrom55: A
(55A B
src55B E
=>55F H
src55I L
.55L M
Schedule55M U
.55U V
Course55V \
.55\ ]
Price55] b
)55b c
)55c d
.66 
	ForMember66 
(66 
dest66 
=>66  "
dest66# '
.66' (
ImageUrl66( 0
,660 1
opt662 5
=>666 8
opt669 <
.66< =
MapFrom66= D
(66D E
src66E H
=>66I K
src66L O
.66O P
Schedule66P X
.66X Y
Course66Y _
.66_ `
ImageUrl66` h
)66h i
)66i j
;66j k
	CreateMap99 
<99 
Invoice99 
,99 

InvoiceDto99 )
>99) *
(99* +
)99+ ,
.:: 
	ForMember:: 
(:: 
dest:: 
=>::  "
dest::# '
.::' (
Email::( -
,::- .
opt::/ 2
=>::3 5
opt::6 9
.::9 :
MapFrom::: A
(::A B
src::B E
=>::F H
src::I L
.::L M
User::M Q
==::R T
null::U Y
?::Z [
string::\ b
.::b c
Empty::c h
:::i j
src::k n
.::n o
User::o s
.::s t
Email::t y
)::y z
)::z {
.;; 
	ForMember;; 
(;; 
dest;; 
=>;;  "
dest;;# '
.;;' (

TotalPrice;;( 2
,;;2 3
opt;;4 7
=>;;8 :
opt;;; >
.;;> ?
MapFrom;;? F
(;;F G
src;;G J
=>;;K M
src;;N Q
.;;Q R
InvoiceDetails;;R `
.;;` a
Sum;;a d
(;;d e
s;;e f
=>;;g i
s;;j k
.;;k l
Price;;l q
);;q r
);;r s
);;s t
.<< 
	ForMember<< 
(<< 
dest<< 
=><<  "
dest<<# '
.<<' (
TotalCourse<<( 3
,<<3 4
opt<<5 8
=><<9 ;
opt<<< ?
.<<? @
MapFrom<<@ G
(<<G H
src<<H K
=><<L N
src<<O R
.<<R S
InvoiceDetails<<S a
.<<a b
Count<<b g
)<<g h
)<<h i
;<<i j
	CreateMap?? 
<?? 
InvoiceDetail?? #
,??# $
InvoiceDetailDto??% 5
>??5 6
(??6 7
)??7 8
;??8 9
	CreateMapBB 
<BB 
MyClassBB 
,BB 

MyClassDtoBB )
>BB) *
(BB* +
)BB+ ,
.CC 
	ForMemberCC 
(CC 
destCC 
=>CC  "
destCC# '
.CC' (
CategoryNameCC( 4
,CC4 5
optCC6 9
=>CC: <
optCC= @
.CC@ A
MapFromCCA H
(CCH I
srcCCI L
=>CCM O
srcCCP S
.CCS T
ScheduleCCT \
.CC\ ]
CourseCC] c
.CCc d
CategoryCCd l
.CCl m
NameCCm q
)CCq r
)CCr s
.DD 
	ForMemberDD 
(DD 
destDD 
=>DD  "
destDD# '
.DD' (

CourseNameDD( 2
,DD2 3
optDD4 7
=>DD8 :
optDD; >
.DD> ?
MapFromDD? F
(DDF G
srcDDG J
=>DDK M
srcDDN Q
.DDQ R
ScheduleDDR Z
.DDZ [
CourseDD[ a
.DDa b
NameDDb f
)DDf g
)DDg h
.EE 
	ForMemberEE 
(EE 
destEE 
=>EE  "
destEE# '
.EE' (
ImageUrlEE( 0
,EE0 1
optEE2 5
=>EE6 8
optEE9 <
.EE< =
MapFromEE= D
(EED E
srcEEE H
=>EEI K
srcEEL O
.EEO P
ScheduleEEP X
.EEX Y
CourseEEY _
.EE_ `
ImageUrlEE` h
)EEh i
)EEi j
.FF 
	ForMemberFF 
(FF 
destFF 
=>FF  "
destFF# '
.FF' (
DateFF( ,
,FF, -
optFF. 1
=>FF2 4
optFF5 8
.FF8 9
MapFromFF9 @
(FF@ A
srcFFA D
=>FFE G
srcFFH K
.FFK L
ScheduleFFL T
.FFT U
DateFFU Y
)FFY Z
)FFZ [
;FF[ \
	CreateMapHH 
<HH 
CreateMyClassDtoHH &
,HH& '
MyClassHH( /
>HH/ 0
(HH0 1
)HH1 2
;HH2 3
	CreateMapII 
<II 
UpdateMyClassDtoII &
,II& '
MyClassII( /
>II/ 0
(II0 1
)II1 2
;II2 3
	CreateMapLL 
<LL 
ScheduleLL 
,LL 
ScheduleDtoLL  +
>LL+ ,
(LL, -
)LL- .
.MM 
	ForMemberMM 
(MM 
destMM 
=>MM  "
destMM# '
.MM' (

CourseNameMM( 2
,MM2 3
optMM4 7
=>MM8 :
optMM; >
.MM> ?
MapFromMM? F
(MMF G
srcMMG J
=>MMK M
srcMMN Q
.MMQ R
CourseMMR X
.MMX Y
NameMMY ]
)MM] ^
)MM^ _
;MM_ `
	CreateMapOO 
<OO 
CreateScheduleDtoOO '
,OO' (
ScheduleOO) 1
>OO1 2
(OO2 3
)OO3 4
;OO4 5
	CreateMapPP 
<PP 
UpdateScheduleDtoPP '
,PP' (
SchedulePP) 1
>PP1 2
(PP2 3
)PP3 4
;PP4 5
}QQ 	
}RR 
}SS ¬
WD:\BootcampProject\default-project-main\src\04.Application\Configuration\JwtSettings.cs
	namespace 	
MyApp
 
. 
Infrastructure 
. 
Configuration ,
{ 
public 

class 
JwtSettings 
{ 
public		 
string		 
	SecretKey		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
=		. /
string		0 6
.		6 7
Empty		7 <
;		< =
public

 
string

 
Issuer

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
=

+ ,
string

- 3
.

3 4
Empty

4 9
;

9 :
public 
string 
Audience 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
int (
AccessTokenExpirationMinutes /
{0 1
get2 5
;5 6
set7 :
;: ;
}< =
public 
int &
RefreshTokenExpirationDays -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
public 
int 0
$RefreshTokenRememberMeExpirationDays 7
{8 9
get: =
;= >
set? B
;B C
}D E
public 
bool 
ValidateIssuer "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
true3 7
;7 8
public 
bool 
ValidateAudience $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
true5 9
;9 :
public 
bool 
ValidateLifetime $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
true5 9
;9 :
public 
bool $
ValidateIssuerSigningKey ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
=; <
true= A
;A B
public 
int 
	ClockSkew 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
$num- .
;. /
} 
} ø
aD:\BootcampProject\default-project-main\src\04.Application\Configuration\AuthorizationPolicies.cs
	namespace 	
MyApp
 
. 
Infrastructure 
. 
Configuration ,
{ 
public 

static 
class !
AuthorizationPolicies -
{ 
public 
const 
string 
RequireAdminRole ,
=- .
$str/ A
;A B
public 
const 
string 
RequireUserRole +
=, -
$str. ?
;? @
public 
const 
string (
RequireManageUsersPermission 8
=9 :
$str; Y
;Y Z
public 
static 
void 
ConfigurePolicies ,
(, - 
AuthorizationOptions- A
optionsB I
)I J
{ 	
options 
. 
	AddPolicy 
( 
RequireAdminRole .
,. /
policy0 6
=>7 9
policy 
. 
RequireRole "
(" #
$str# *
,* +
$str, 8
)8 9
)9 :
;: ;
options"" 
."" 
	AddPolicy"" 
("" 
RequireUserRole"" -
,""- .
policy""/ 5
=>""6 8
policy## 
.## 
RequireRole## "
(##" #
$str### )
,##) *
$str##+ 2
,##2 3
$str##4 @
)##@ A
)##A B
;##B C
options(( 
.(( 
	AddPolicy(( 
((( (
RequireManageUsersPermission(( :
,((: ;
policy((< B
=>((C E
policy)) 
.)) 
RequireAssertion)) '
())' (
context))( /
=>))0 2
context** 
.** 
User**  
.**  !
IsInRole**! )
(**) *
$str*** 1
)**1 2
||**3 5
context++ 
.++ 
User++  
.++  !
IsInRole++! )
(++) *
$str++* 6
)++6 7
||++8 :
context,, 
.,, 
User,,  
.,,  !
HasClaim,,! )
(,,) *
$str,,* 6
,,,6 7
$str,,8 J
),,J K
),,K L
),,L M
;,,M N
}.. 	
}// 
}00 ¯
DD:\BootcampProject\default-project-main\src\04.Application\Class1.cs
	namespace 	
MyApp
 
. 
Application 
; 
public 
class 
Class1 
{ 
} 